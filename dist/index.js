module.exports=function(e,t){"use strict";var n={};function __webpack_require__(t){if(n[t]){return n[t].exports}var r=n[t]={i:t,l:false,exports:{}};var i=true;try{e[t].call(r.exports,r,r.exports,__webpack_require__);i=false}finally{if(i)delete n[t]}r.l=true;return r.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(566)}t(__webpack_require__);return startup()}({0:function(e,t,n){"use strict";var r=n(531);var i=0;if(!r.isMaster&&r.worker){i=r.worker.id}e.exports=parseInt(process.env.NODE_UNIQUE_ID||i,10)},1:function(e,t,n){"use strict";var r=n(808);var i=n(720);var o=1567752802062;var a=7;var s;var f;function build(e){var t="";var n=Math.floor((Date.now()-o)*.001);if(n===f){s++}else{s=0;f=n}t=t+r(a);t=t+r(e);if(s>0){t=t+r(s)}t=t+r(n);return t}e.exports=build},2:function(e){var t={EVENT:{TYPE_RECURRING:"recurring",TYPE_TERMINATING:"terminating",ACTION:{TYPE_AUTORENEW:"autorenew",TYPE_CONFIRM:"confirm",TYPE_PROTOCOL:"protocol"}},PROPERTY:{TYPE_SHORTTEXT:"shortText",TYPE_LONGTEXT:"longText",TYPE_INDEXEDTEXT:"indexedText",TYPE_NUMBER:"number",TYPE_DATE:"date",TYPE_SHORTID:"shortId",TYPE_REF_OBJ:"objectRef",TYPE_REF_USR:"userRef",TYPE_REF_FILE:"fileRef",TYPE_PROPERTY_BAG:"bag",TYPE_BOOLEAN:"boolean",TYPE_ARRAY:"array",TYPE_EVENT:"event",TYPE_ACTION:"action",TYPE_JSON:"json"},MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"},TEMPLATEMODES:{STRICT:"strict"}};e.exports=t},181:function(e,t,n){"use strict";e.exports=n(798)},261:function(e,t,n){var r=n(181);e.exports=function(e){return{serialize:function(e){return e},deserialize:function(e){return e},tenant:function(e){return this.client(e)},client:function(e){if(!e)throw new Error("No client specified");this.activeTenant=e;return this},useUser:function(e){this.activeUser=e;return this},app:function(e){this.activeApp=e;return this},getPropsObject:function(e,t){if(e.hasOwnProperty("role"))if(t.hasOwnProperty("propsObject"))if(!e.hasOwnProperty(t.propsObject))e[t.propsObject]={};return e[t.propsObject]||e},serializePropsObject:function(e,t,n,r,i){},deSerializePropsObject:function(t,n){return t;if(!n.propsObject)return t;if(!t.hasOwnProperty(n.propsObject))t[n.propsObject]={};Object.keys(t).forEach(r=>{if(!e.predefinedProperties.includes(r)&&typeof t[r]!=="function"){t[n.propsObject][r]=t[r];delete t[r]}});return t},deSerializePropsObjectMulti:function(e,t){return e},chainCommand:function(e,t,n,r){t.commandSequence.push({name:n,value:r})},ConditionsChecker:function(e,t){if(e.hasOwnProperty("conditions")){}},execProcessorAction:function(t,n,r,i,o,a,s){e.Logger.log("triggering dsl");this.processors[n.role].execute(t,n,r,i,o,a,this.instance.activeUser,s)},ID:function(){var e="";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,;-_";for(var n=0;n<25;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},RANDOM:function(e){return r.generate()},checkConstraints:function(e,t){var n=this;var r=true;var i=[];if(!e.hasOwnProperty("_constraints"))return false;e._constraints.forEach(t=>{if(e[t.key]){if(typeof t.validate==="function"){var n=t.validate(e[t.key]);if(!n)i.push(t.key)}}else if(t.key.indexOf(".")!=-1){function getValue(e,n){if(typeof n=="string"){n=n.split(".")}if(n.length>1){getValue(e[n.shift()],n)}else if(e){propertyToReturn=e[n[0]];if(typeof t.validate==="function"){var r=t.validate(propertyToReturn);if(!r&&!i.includes(t.key))i.push(t.key)}}}getValue(e,t.key)}});if(!i.length)return true;else return i}}}},269:function(e,t,n){"use strict";var r=n(720);function isShortId(e){if(!e||typeof e!=="string"||e.length<6){return false}var t=new RegExp("[^"+r.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!t.test(e)}e.exports=isShortId},272:function(e,t,n){var r=n(458);e.exports=function(e){return{checkPermissions:function(e,t,n,r,i){var o=false;if(!e)return true;if(e.spooAdmin)return true;if(e._id==n._id&&r=="r")return true;var a=e.privileges;var s=n.permissions;if(!s)return true;if(Object.keys(s||{}).length==0)return true;if(!a&&s){if(!i)return false;else return false}var f=false;if(Array.isArray(s)){var u={};s.forEach(function(e){u[e.name]={value:e.value}});s=u}if(t){if(a["*"]){Object.keys(s).forEach(function(e){a["*"].forEach(function(e){if(s[e.name]){if(((s[e.name]||{}).value||"").indexOf(r)!=-1||(s[e.name]||{}).value=="*")f=true}if(s["*"]){if(((s["*"]||{}).value||"").indexOf(r)!=-1||(s["*"]||{}).value=="*")f=true}})});if(f)return true}else if(a[t]){a[t].forEach(function(e){if(s[e.name]){if(((s[e.name]||{}).value||"").indexOf(r)!=-1||(s[e.name]||{}).value=="*")f=true}if(s["*"]){if(((s["*"]||{}).value||"").indexOf(r)!=-1||(s["*"]||{}).value=="*")f=true}});if(!f)return false;else return true}else return false}else return false},checkAuthroisations:function(e,t,n,i){var o;if(!t)return;function throwError(){throw new Error("Lack of permissions")}if(Object.keys(t.authorisations||{}).length==0)return;if(!i&&!t.authorisations["*"]){console.warn("app, !authorisationsapp");throwError()}if(t.authorisations["*"])o=t.authorisations["*"];else if(i&&!t.authorisations[i]){console.warn("app, !authorisationsapp");throwError()}else o=t.authorisations[i];var a=[e];var s={$or:[]};o.forEach(function(e){console.warn("_a",e,n);if(e.perm.indexOf(n)!=-1||e.perm.indexOf("*")!=-1)s.$or.push(e.query)});if(s.$or.length==0)throwError();if(r.query(a,s,r.undot).length==0)throw new Error("Lack of permissions")},buildPermissionQuery:function(e,t,n){if(e.$query){e=JSON.parse(JSON.stringify(e.$query));delete e.$query}if(!t.spooAdmin){if(!t.privileges)return e;if(n&&t.privileges[n]){var r=[];t.privileges[n].forEach(function(e){var t={};t["permissions."+e.name+".value"]={$regex:"r"};r.push(t);t={};t["permissions."+e.name+".value"]="*";r.push(t);t={};t["permissions.name"]=e.name;r.push(t)});var i={};i["permissions.*"+".value"]={$regex:"r"};r.push(i);i={};i["permissions.*"]={$regex:"r"};r.push(i);i={};i["permissions.*"+".value"]="*";r.push(i);if(Object.keys(e).length>0){return{$and:[e,{$or:r}]}}else{return{$or:r}}}else if(!n){return e}}else{return e}},buildAuthroisationQuery:function(e,t,n,r){var i;if(!t)return e;function throwError(){throw new Error("Lack of permissions")}if(Object.keys(t.authorisations||{}).length==0)return e;if(!r&&!t.authorisations["*"]){console.warn("app, !authorisationsapp");throwError()}if(t.authorisations["*"])i=t.authorisations["*"];else if(r&&!t.authorisations[r]){console.warn("app, !authorisationsapp");throwError()}else i=t.authorisations[r];var o=[e];var a=[];var s=false;i.forEach(function(t){console.warn("_a",t,n);if(t.perm.indexOf(n)!=-1||t.perm.indexOf("*")!=-1){if(Object.keys(t.query).length==0)s=true;else{a.push({$and:[t.query,e]})}}});if(a.length==0&&!s)throw new Error("Lack of permissions");a={$or:a};return a},chainPermission:function(t,n,r,i,o){if(["c","r","u","d","x"].includes(r)){}else r="u";if(t.permissions){if(Object.keys(t.permissions).length>0){if(!n.permissionSequence[t._id])n.permissionSequence[t._id]=[];if(!e.checkPermissions(n.activeUser,n.activeApp,t,r,true))n.permissionSequence[t._id].push({name:i,key:o})}}},getElementPermisson:function(e){if(!e)return{};else if(!e.permissions)return{};else return e.permissions}}}},279:function(e){e.exports=function(e,t,n){var r=(2<<31-Math.clz32(t.length-1|1))-1;var i=Math.ceil(1.6*r*n/t.length);var o="";while(true){var a=e(i);var s=i;while(s--){o+=t[a[s]&r]||"";if(o.length===+n)return o}}}},325:function(e,t,n){var r=n(458);var i=function(e,t){return Object.assign(new e.StorageTemplate(e,t),{database:{},index:{},createClient:function(e,t,n){if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){if(this.database[e])n("Client already exists");this.database[e]=[];this.index[e]={};t()}},getDBByMultitenancy:function(e){if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED){if(!Array.isArray(this.database))this.database=[];return this.database}else if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){if(!this.database[e])throw new Error("no database for client "+e);return this.database[e]}},listClients:function(e,t){if(!this.database)return t("no database");if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED)e(Object.keys(this.database));else e(Object.keys(this.database))},getById:function(e,t,n,r,i){var o=this.getDBByMultitenancy(i);if(this.index[i][e]===undefined)return n("object not found: "+e);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[i][e].tenantId!=i)return n("object not found: "+_id);t(o[this.index[i][e]])},getByCriteria:function(e,t,n,i,o,a){var s=this.getDBByMultitenancy(o);if(i)Object.assign(e,{applications:{$in:[i]}});if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)Object.assign(e,{tenantId:o});t(r.query(s,e,r.undot))},count:function(e,t,n,i,o,a){var s=this.getDBByMultitenancy(o);if(i)Object.assign(e,{applications:{$in:[i]}});if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)Object.assign(e,{tenantId:o});t(r.query(s,e,r.undot).length)},update:function(e,t,n,r,i){var o=this.getDBByMultitenancy(i);if(this.index[i][e._id]===undefined)return n("object not found: "+e._id);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[i][e._id].tenantId!=i)return n("object not found: "+_id);o[this.index[i][e._id]]=e;t(o[this.index[i][e._id]])},add:function(e,t,n,r,i){if(!this.database[i])this.database[i]=[];if(!this.index[i])this.index[i]={};if(this.index[i][e._id]!==undefined)return n("object with taht id already exists: "+e._id);if(!this.index[i])this.index[i]={};var o=this.getDBByMultitenancy(i);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED){e.tenantId=i}this.index[i][e._id]=o.push(e)-1;t(e)},remove:function(e,t,n,r,i){var o=this.getDBByMultitenancy(i);if(this.index[i][e._id]===undefined)return n("object not found: "+e._id);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[i][e._id].tenantId!=i)return n("object not found: "+e._id);o.splice(this.index[i][e._id],1);delete this.index[i][e._id];t(e)}})};e.exports=i},335:function(e,t,n){var r=n(417);if(r.randomFillSync){var i={};e.exports=function(e){var t=i[e];if(!t){t=Buffer.allocUnsafe(e);if(e<=255)i[e]=t}return r.randomFillSync(t)}}else{e.exports=r.randomBytes}},373:function(e){const t={NoOnChangeException:function(e){this.message="onChange not found";this.name="NoOnChangeException"},NoMetaException:function(e){this.message="meta not found";this.name="NoMetaException"},NoOnDeleteException:function(e){this.message="onDelete not found";this.name="NoOnDeleteException"},NoEventIdException:function(e){this.message="No Event ID provided";this.name="NoEventIdException"},InvalidTypeException:function(e){this.message=e+" is not a valid type";this.name="InvalidTypeException"},InvalidValueException:function(e,t){this.message=e+" is not valid. Type must be: "+t;this.name="InvalidValueException"},InvalidFormatException:function(){this.message="Invlid format";this.name="InvalidFormatException"},DuplicatePropertyException:function(e){this.message="Property "+e+" already exists in this object";this.name="DuplicatePropertyException"},DuplicateActionException:function(e){this.message="Action "+e+" already exists in this object";this.name="DuplicateActionException"},DuplicateApplicationException:function(e){this.message="Application "+e+" already exists in this object";this.name="DuplicateApplicationException"},NoSuchApplicationException:function(e){this.message="Application "+e+" does not exist in this object";this.name="NoSuchApplicationException"},NoSuchReminderException:function(e){this.message="Reminder "+e+" does not exist in this event";this.name="NoSuchReminderException"},DuplicateEventException:function(e){this.message="Event "+e+" already exists in this object";this.name="DuplicateEventException"},NoSuchTemplateException:function(e){this.message="Template id "+e+" does not exist";this.name="NoSuchTemplateException"},NotAnEventException:function(e){this.message="Property "+e+" is not an event";this.name="NotAnEventException"},NoSuchObjectException:function(e){this.message="Object id "+e+" does not exist";this.name="NoSuchObjectException"},NoSuchPropertyException:function(e){this.message="Property "+e+" does not exist in this object";this.name="NoSuchPropertyException"},NoSuchEventException:function(e){this.message="Event "+e+" does not exist in this object";this.name="NoSuchEventException"},PropertyNotFoundException:function(e){this.message="Property "+e+" does not exist in this object";this.name="PropertyNotFoundException"},MissingAttributeException:function(e){this.message="Missing attibute "+e+" in this object";this.name="MissingAttributeException"},CallbackErrorException:function(e){this.message=e;this.name="CallbackErrorException"},InvalidDateException:function(e){this.message=e+" is not a valid date";this.name="InvalidDateException"},InvalidActionException:function(e){this.message=e+" is not a valid event action";this.name="InvalidActionException"},InvalidDataTypeException:function(e,t){this.message=e+" is not of type "+t;this.name="InvalidDataTypeException"},NotATemplateExteptopn:function(e){this.message=e+" is not a template";this.name="NotATemplateExteptopn"},InvalidPrivilegeException:function(e){this.message="Invalid privileges format";this.name="InvalidPrivilegeException"},NoSuchPrivilegeException:function(e){this.message="Privilege does not exist";this.name="NoSuchPrivilegeException"},NoSuchPermissionException:function(e){this.message="Permission "+e+" does not exist";this.name="NoSuchPermissionException"},InvalidPermissionException:function(e){this.message="Permission format invalid";this.name="InvalidPermissionException"},InvalidEventIdException:function(e){this.message="Event ID format not valid: "+e;this.name="InvalidEventIdException"},NoHandlerProvidedException:function(e){this.message="No handler provided "+e;this.name="NoHandlerProvidedException"},HandlerExistsException:function(e){this.message="Handler "+e+" already exists";this.name="HandlerExistsException"},HandlerNotFoundException:function(e){this.message="Handler "+e+" not found";this.name="HandlerNotFoundException"},InvalidArgumentException:function(e){this.message="Invalid argument";this.name="InvalidArgumentException"},InvalidHandlerException:function(e){this.message="Invalid handler";this.name="InvalidHandlerException"},LackOfPermissionsException:function(e){if(Array.isArray(e)){var t="No permissions to perform these operations: ";e.forEach(function(e){t+="("+e.name+": "+e.key+") "});this.message=t;this.name="LackOfPermissionsException"}else{this.message="No permissions to perform this operation";this.name="LackOfPermissionsException"}}};e.exports=t},414:function(e,t,n){var r=n(373);e.exports=function(e){return{updateInheritedObjs:function(e,t,n,r,i,o,a){},removeInheritedObjs:function(e,t,n,r,i){var o=` \n            OBJY['${t}']({inherits: {$in: ["${e._id}"]}}).get(function(data){\n                data.forEach(function(d){\n                    d.removeInherit(${e._id})\n                    d.update();\n                })\n            })`;this.execProcessorAction(o,e,null,null,function(e){},i,{})},prepareObjectDelta:function(e,t,n,r){var i=["name","type"];i.forEach(function(n){if(t[n]!=e[n])e[n]=t[n]});var o=["onCreate","onChange","onDelete"];o.forEach(function(n){if(t[n]){Object.keys(t[n]).forEach(function(r){if(t[n][r]){if(t[n][r].value!=e[n][r].value)e[n][r].value=t[n][r].value;e[n][r].overwritten=true}})}});function doTheProps(t){var r=obj[n.propsObject]||obj;Object.keys(r).forEach(function(t){if(r[t].type=="bag"){doTheProps(r[t])}if(r[t]){if(r[t].template&&e[t]){if(r[t].value!=e[t].value){e[t].value=r[t].value;e[t].overwritten=true}if(r[t].action!=e[t].action){e[t].action=r[t].action;e[t].overwritten=true}if(r[t].date!=e[t].date){e[t].date=r[t].date;e[t].overwritten=true}if(r[t].interval!=e[t].interval){e[t].interval=r[t].interval;e[t].overwritten=true}if(JSON.stringify(r[t].meta)!=JSON.stringify(e[t].interval)){e[t].meta=r[t].meta;e[t].overwritten=true}}}if(!e[t])e[t]=r[t];if(r.permissions){Object.keys(r.permissions).forEach(function(t){if(r.permissions[t]){if(JSON.stringify(r.permissions[t])!=JSON.stringify(e.permissions[t]))e.permissions[t]=r.permissions[t];e.permissions[t].overwritten=true}})}if(r[t]){o.forEach(function(n){if(r[t][n]){Object.keys(r[t][n]).forEach(function(i){if(r[t][n][i]){if(r[t][n][i].value!=e[t][n][i].value)e[t][n][i].value=r[t][n][i].value;e[t][n][i].overwritten=true}})}})}})}doTheProps(t);if(t.permissions){Object.keys(t.permissions).forEach(function(n){if(t.permissions[n]){if(t.permissions[n].value!=e.permissions[n].value)e.permissions[n].value=t.permissions[n].value;e.permissions[n].overwritten=true}})}return e},getTemplateFieldsForObject:function(t,n,r,i,o,a,s,f,u){var h=this;var l=function(e){return!!e&&e.constructor===Object};function run(i){if(!i){}if(i.name){if(!t.name)t.name=i.name}if(i.type){if(!t.type)t.type=i.type}["onCreate","onChange","onDelete"].forEach(function(e){if(i[e]){Object.keys(i[e]).forEach(function(r){if(!i[e][r]||!l(i[e][r]))return;if(!t[e])t[e]={};if(!t[e][r]){t[e][r]=i[e][r];t[e][r].template=n}})}});function doTheProps(t,r){if(!r)r={};if(!t)t={};if(f.propsObject&&!r.hasOwnProperty(f.propsObject))r[f.propsObject]={};var i=r[f.propsObject]||r;var o=t[f.propsObject]||t;Object.keys(o).forEach(function(t){if(!f.propsObject&&(e.predefinedProperties.includes(t)||(l(o[t])||Array.isArray(o[t]))))return;if(!o[t])return;var r=JSON.parse(JSON.stringify(o[t]));if(!i[t]){i[t]=r;i[t].template=n;delete i[t].overwritten}else{if(r.meta){if(!i[t].meta){i[t].meta=r.meta;i[t].meta.overwritten=true}else{if(!i[t].meta.overwritten){i[t].meta=r.meta;i[t].meta.overwritten=true}}}if(!i[t].type)i[t].type=r.type;i[t].template=n;i[t].overwritten=true}if(o.permissions){if(!i.permissions)i.permissions={};Object.keys(o.permissions).forEach(function(e){if(!i.permissions[e]){i.permissions[e]=o.permissions[e];i.permissions[e].template=n}else{i.permissions[e].template=n;i.permissions[e].overwritten=true}})}["onCreate","onChange","onDelete"].forEach(function(e){if(o[t][e]){if(!i[t][e])i[t][e]={};Object.keys(o[t][e]).forEach(function(r){if(!i[t][e][r]){i[t][e][r]=o[t][e][r];if(i[t][e][r])i[t][e][r].template=n}})}});if(o[t].type=="bag"){doTheProps(r,i[t])}})}doTheProps(i,t);if(i.applications){i.applications.forEach(function(e){if(t.applications)if(t.applications.indexOf(e)==-1)t.applications.push(e)})}if(i.authorisations){var o=Object.keys(i.authorisations);if(o.length>0){if(!t.authorisations)t.authorisations={}}o.forEach(function(e){if(!t.authorisations[e]){t.authorisations[e]=i.authorisations[e];t.authorisations[e].forEach(function(e){e.template=i._id})}else{i.authorisations[e].forEach(function(n){var r=false;t.authorisations[e].forEach(function(e){if(JSON.stringify(e.query)==JSON.stringify(n.query))r=true});if(r){n.overwritten=true}else{n.template=i._id;n.test="has";t.authorisations[e].push(n)}})}})}if(i.permissions){if(!t.permissions)t.permissions={};Object.keys(i.permissions).forEach(function(e){if(!t.permissions[e]){t.permissions[e]=i.permissions[e];t.permissions[e].template=n}else{t.permissions[e].template=n;t.permissions[e].overwritten=true}})}if(i.privileges){if(!t.privileges)t.privileges={};Object.keys(i.privileges).forEach(function(e){if(!t.privileges[e])t.privileges[e]=[];i.privileges[e].forEach(function(r){var i=false;t.privileges[e].forEach(function(e){if(e.name==r.name)i=true});if(!i){23;t.privileges[e].push({name:r.name,template:n})}})})}r(t)}if(h.caches[a||t.role].get(n)){}else{e.getObjectById(a||t.role,n,function(n){var r=0;if((n.inherits||[]).length==0)run(n);else{n.inherits.forEach(function(i){e.getTemplateFieldsForObject(n,i,function(){r++;if(r==n.inherits.length)run(n)},function(e){r++;if(r==n.inherits.length)run(n)},o,a||t.role,s||e.activeTenant,f)})}},function(e){i(e)},e.activeApp,s||e.activeTenant)}},removeTemplateFieldsForObject:function(e,t,n,r,i,o,a){if(!t){r("template not found");return}["onCreate","onChange","onDelete"].forEach(function(n){if(e[n]){Object.keys(e[n]).forEach(function(r){if(e[n][r]){if(e[n][r].template==t&&!e[n][r].overwritten)delete e[n][r]}})}});var s=function(e){return!!e&&e.constructor===Object};function doTheProps(e){var n=e[o.propsObject]||e;if(n){Object.keys(n).forEach(function(e){if(!s(n[e]))return;if(n[e]){["onCreate","onChange","onDelete"].forEach(function(r){if(n[e][r]){propsObject.keys(n[e][r]).forEach(function(i){if(n[e][r][i]){if(n[e][r][i].template==t&&!n[e][r][i].overwritten)delete n[e][r][i]}})}})}if(n[e].type=="bag"){return doTheProps(n[e])}if(n[e]){if(n[e].value!=null)n[e].overwritten=true;if(n[e].template==t&&!n[e].overwritten){console.info("deleting propsObj",e,n[e]);delete n[e]}}})}}doTheProps(e);if(e.permissions){Object.keys(e.permissions).forEach(function(n){if(e.permissions[n]){if(e.permissions[n].template==t&&!e.permissions[n].overwritten)delete e.permissions[n]}})}if(e.privileges){Object.keys(e.privileges).forEach(function(n){if(!Array.isArray(e.privileges[n]))return;e.privileges[n].forEach(function(r,i){if(r.template==t&&!r.overwritten)e.privileges[n].splice(i,1)})})}n(e)},updateObjAfterTemplateChange:function(e){},removeTemplateFieldsToObject:function(e,t){this.getTemplateAsyn(t,function(t){var n=Object.keys(t);n.forEach(function(t){if(e[t]===undefined){this.removeTemplateFieldFromObjects(e.template[t])}})},function(e){})},addTemplateToObject:function(t,n,r){var i=false;t.inherits.forEach(function(e){if(e==n)i=true});if(!i){t.inherits.push(n);e.chainPermission(t,r,"i","addInherit",n);e.chainCommand(t,r,"addInherit",n)}},addApplicationToObject:function(t,n,i){var o=false;if(!t.applications)t.applications=[];t.applications.forEach(function(e){if(e==n)o=true});if(!o){t.applications.push(n);e.chainPermission(t,i,"a","addApplication",n)}else throw new r.DuplicateApplicationException(n)},removeApplicationFromObject:function(t,n,i){var o=false;t.applications.forEach(function(e,r){if(e==n){t.applications.splice(r,1);o=true}});e.chainPermission(t,i,"a","removeApplication",n);if(!o){throw new r.NoSuchApplicationException(n)}},removeTemplateFromObject:function(t,n,r,i,o){var a=false;t.inherits.forEach(function(e){if(e==n)a=true});if(t.inherits.indexOf(n)!=-1){t.inherits.splice(t.inherits.indexOf(n),1);e.chainPermission(t,o,"i","removeInherit",n);e.chainCommand(t,o,"removeInherit",n);r(t)}else{i("Template not found in object")}},TemplatesCreateWrapper:function(e,t){var n=false;e.inherits.forEach(function(e){if(e==t)n=true});if(!n){e.inherits.push(t)}},ObjectPermissionsCreateWrapper:function(e,t){if(!typeof t=="object")throw new r.InvalidPermissionException;if(!t)return;var n=Object.keys(t);n.forEach(function(e){if(typeof t[e]=="string"){t[e]={value:t[e]}}else{t[e]=t[e]}});return t},ObjectOnCreateSetWrapper:function(t,n,i,o,a,s){if(!i)throw new r.InvalidHandlerException;if(!t.onCreate)t.onCreate={};if(t.onCreate[n])throw new r.HandlerExistsException(n);if(!n)n=e.RANDOM();if(!t.onCreate[n])t.onCreate[n]={};t.onCreate[n].value=i;t.onCreate[n].trigger=o||"after";t.onCreate[n].type=a||"async";if(t.onCreate[n].templateId)t.onCreate[n].overwritten=true;e.chainPermission(t,s,"v","setOnCreateHandler",n);return i},ObjectOnCreateCreateWrapper:function(e,t,n){if(!t)return;Object.keys(t).forEach(function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"});return t},AffectsCreateWrapper:function(e,t){if(!t)t={};return t},ApplyCreateWrapper:function(e,t){if(!t)t={};return t},ObjectOnChangeCreateWrapper:function(e,t,n){if(!t)return;Object.keys(t).forEach(function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"});return t},ObjectAuthorisationSetWrapper:function(t,n,r){var i=r.activeApp||"*";if(!t.authorisations)t.authorisations={};if(!t.authorisations[i])t.authorisations[i]=[];if(!n.name)n.name=e.RANDOM();var o=false;t.authorisations[i].forEach(e=>{if(e.name==n.name){e=n;o=true}});if(!o)t.authorisations[i].push(n);return n},ObjectAuthorisationRemoveWrapper:function(e,t,n){var r=n.activeApp||"*";if(!e.authorisations)throw new Error("No authorisations present");if(!e.authorisations[r])throw new Error("No authorisations for this app present");e.authorisations[r].forEach((n,i)=>{if(n.name==t)e.authorisations[r].splice(i,1)});if(Object.keys(e.authorisations[r]).length==0)delete e.authorisations[r];return t},ObjectOnDeleteCreateWrapper:function(e,t,n){if(!t)return;Object.keys(t).forEach(function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"});return t},ObjectOnChangeSetWrapper:function(t,n,i,o,a,s){if(!i)throw new r.InvalidHandlerException;if(!t.onChange)t.onChange={};if(t.onChange[n])throw new r.HandlerExistsException(n);if(!n)n=e.RANDOM();if(!t.onChange[n])t.onChange[n]={};t.onChange[n].value=i;t.onChange[n].trigger=o||"after";t.onChange[n].type=a||"async";if(t.onChange[n].templateId)t.onChange[n].overwritten=true;e.chainPermission(t,s,"w","setOnChangeHandler",n);return i},ObjectOnDeleteSetWrapper:function(t,n,i,o,a,s){if(!i)throw new r.InvalidHandlerException;if(!t.onDelete)t.onDelete={};if(t.onDelete[n])throw new r.HandlerExistsException(n);if(!n)n=e.RANDOM();if(!t.onDelete[n])t.onDelete[n]={};t.onDelete[n].value=i;t.onDelete[n].trigger=o||"after";t.onDelete[n].type=a||"async";if(t.onDelete[n].templateId)t.onDelete[n].overwritten=true;e.chainPermission(t,s,"z","setOnDeleteHandler",n);return i},ObjectPermissionSetWrapper:function(t,n,i){if(!t.permissions)t.permissions={};if(!typeof n=="object")throw new r.InvalidPermissionException;if(!n)throw new r.InvalidPermissionException;var o=Object.keys(n)[0];if(!t.permissions[o])t.permissions[o]=n[o];else{t.permissions[o]=n[o]}e.chainPermission(t,i,"x","setPermission",o);return n},ObjectPermissionRemoveWrapper:function(t,n,i){if(!n)throw new r.InvalidPermissionException;if(!typeof n=="string")throw new r.InvalidPermissionException;if(!t.permissions[n])throw new r.NoSuchPermissionException(n);e.chainPermission(t,i,"x","removePermission",n);delete t.permissions[n];return n},ObjectRoleChecker:function(e,t){switch(t){case"object":return t;break;case"template":return t;break;case"tenant":return t;break;case"application":return t;break;case"user":e.username="";e.password="";return t;break;default:return"object"}},PropertiesChecker:function(t,n,r,i){if(n===undefined)return;if(i.propsObject)t[i.propsObject]={};var o=Object.keys(n);o.forEach(function(o){var a={};a[o]=n[o];var s=a;new e.PropertyCreateWrapper(t,s,false,r,i)});return t[i.propsObject]||t},ApplicationsChecker:function(e,t){if(t===undefined)return;e.applications=[];t.forEach(function(t){e.applications.push(t)});return e.applications},ActionsChecker:function(t,n){if(n===undefined)return;t.actions={};var r=Object.keys(n);r.forEach(function(r){var i={};i[r]=n[r];var o=i;new e.ActionCreateWrapper(t,o,false)});return t.actions},InheritsChecker:function(t,n){if(n===undefined)return;if(typeof n!=="object")return;t.inherits=[];n.forEach(function(n){if(n!=t._id)new e.TemplatesCreateWrapper(t,n)});return t.inherits},PrivilegesChecker:function(e){return e.privileges},PrivilegeChecker:function(e,t){if(!typeof t=="object")throw new r.InvalidPrivilegeException;var n=Object.keys(t)[0];if(!e.privileges)e.privileges={};if(!e.privileges[n]){e.privileges[n]=[]}var i=false;e.privileges[n].forEach(function(e){if(e.name==t[n].name)i=true});if(!i)e.privileges[n].push({name:t[n].name});else throw new Error("Privilege already exists");return t},PrivilegeRemover:function(e,t,n){var i=n.activeApp;if(!e.privileges[i]){throw new r.NoSuchPrivilegeException}var o;for(o=0;o<e.privileges[i].length;o++){if(e.privileges[i][o].name==t)e.privileges[i].splice(o,1)}if(e.privileges[i].length==0){delete e.privileges[i]}return t}}}},417:function(e){e.exports=require("crypto")},451:function(e,t,n){var r=n(797);Mapper=function(e){return Object.assign(new e.ObserverTemplate(e),{initialize:function(e){var t=this;this.interval=setInterval(function(){t.run(r().utc())},this.interval)},run:function(t){var n=this;e.getPersistence(n.objectFamily).listClients(function(r){r.forEach(function(r){e.Logger.log("Running ovserver "+t.toISOString()+" "+r);e.getPersistence(n.objectFamily).getByCriteria({_aggregatedEvents:{$elemMatch:{date:{$lte:t.toISOString()}}}},function(t){t.forEach(function(t){t=e[n.objectFamily](t);t._aggregatedEvents.forEach(function(n){var i=t.getProperty(n.propName);e.execProcessorAction(i.action,t,i,null,function(){t.setEventTriggered(n.propName,true,r).update(function(t){e.Logger.log("d._aggregatedEvents");e.Logger.log(t._aggregatedEvents)},function(e){console.log(e)},r)},r,{})})})},function(e){},undefined,r,{})})},function(e){})}})};e.exports=Mapper},458:function(e){var t;(function(){function objectify(e){var t=[];for(var n in e){var r={};r[n]=e[n];t.push(r)}return t}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{enumerable:false,configurable:false,writable:false,value:function(e,t){t=t||0;return this.lastIndexOf(e,t)===t}})}if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();if(t===undefined||t>n.length){t=n.length}t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}})}t={satisfies:function(e,n,r){return t.lhs._rowsatisfies(e,n,r)},Query:function(e,n){return function(r){return t.lhs._rowsatisfies(r,e,n)}},join:function(e,t,n,r){var i,o;if(typeof n=="string")i=function(e){return e[n]};else i=n;if(!r)o=i;if(typeof r=="string")o=function(e){return e[n]};else o=r;return e},query:function(e,n,r){if(typeof r=="string"){var i=r;r=function(e,t){return e[i](t)}}var o=new t.Query(n,r);return e.filter(o)},lhs:{_rowsatisfies:function(e,t,n){for(var r in t){if(this[r]){if(!this[r](e,t[r],n))return false}else{var i=n?n(e,r):e[r];var o=this.rhs._satisfies(i,t[r],r);if(!o)return false}}return true},$count:function(e,n,r){var i=n.$constraints.map(function(n){return t.satisfies(e,n,r)}).filter(function(e){return e}).length;return this.rhs._satisfies(i,n.$constraint)},$not:function(e,t,n){return!this._rowsatisfies(e,t,n)},$or:function(e,t,n){if(!Array.isArray(t)){t=objectify(t)}for(var r=0;r<t.length;r++){if(this._rowsatisfies(e,t[r],n))return true}return false},$and:function(e,t,n){if(!Array.isArray(t)){t=objectify(t)}for(var r=0;r<t.length;r++){if(!this._rowsatisfies(e,t[r],n))return false}return true},$nor:function(e,t,n){return!this.$or(e,t,n)},$where:function(e,t){var n=typeof t=="string"?new Function(t):t;var r=n.call(e);return r},rhs:{$cb:function(e,t,n){return t(e)},_satisfies:function(e,t,n){if(t===e)return true;else if(t instanceof RegExp)return this.$regex(e,t);else if(Array.isArray(t))return this.$in(e,t);else if(t&&typeof t==="object"){if(t instanceof Date)return this.$eq(e,t.getTime());else{if(t.$regex)return this.$regex(e,new RegExp(t.$regex,t.$options));for(var r in t){if(!this[r])return this.$eq(e,t,n);else if(!this[r](e,t[r],n))return false}return true}}else if(Array.isArray(e)){for(var i=0;i<e.length;i++)if(this.$eq(e[i],t))return true;return false}else if(t===""||t===null||t===undefined)return this.$null(e);else return this.$eq(e,t)},$eq:function(e,t){if(e===t)return true;else if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(this.$eq(e[n],t))return true;return false}else if(t===null||t===undefined||t===""){return this.$null(e)}else if(e===null||e===""||e===undefined)return false;else if(e instanceof Date){if(t instanceof Date){return e.getTime()==t.getTime()}else if(typeof t=="number"){return e.getTime()==t}else if(typeof t=="string")return e.getTime()==new Date(t).getTime()}else{return e==t}},$exists:function(e,t,n){return e!=undefined==(t&&true)},$deepEquals:function(e,t){if(typeof _=="undefined"||typeof _.isEqual=="undefined"){return JSON.stringify(e)==JSON.stringify(t)}else{return _.isEqual(e,t)}},$not:function(e,t){return!this._satisfies(e,t)},$ne:function(e,t){return!this._satisfies(e,t)},$nor:function(e,t,n){return!this.$or(e,t,n)},$and:function(e,t,n){if(!Array.isArray(t)){throw new Error("Logic $and takes array of constraint objects")}for(var r=0;r<t.length;r++){var i=this._satisfies(e,t[r],n);if(!i)return false}return true},$or:function(e,t,n){if(!Array.isArray(e)){e=[e]}for(var r=0;r<e.length;r++){for(var i=0;i<t.length;i++){if(this._satisfies(e[r],t[i],n)){return true}}}return false},$null:function(e){var t;if(e===""||e===null||e===undefined){return true}else if(Array.isArray(e)){for(var n=0;n<e.length;n++){if(!this.$null(e[n])){return false}}return true}else return false},$in:function(e,t){if(!Array.isArray(t))throw new Error("$in requires an array operand");var n=false;if(!Array.isArray(e)){e=[e]}for(var r=0;r<e.length;r++){var i=e[r];for(var o=0;o<t.length;o++){if(this._satisfies(i,t[o])){n=true;break}}n=n||t.indexOf(i)>=0}return n},$likeI:function(e,t){return e.toLowerCase().indexOf(t)>=0},$like:function(e,t){return e.indexOf(t)>=0},$startsWith:function(e,t){if(!e)return false;return e.startsWith(t)},$endsWith:function(e,t){if(!e)return false;return e.endsWith(t)},$elemMatch:function(e,n,r){for(var i=0;i<e.length;i++){if(t.lhs._rowsatisfies(e[i],n))return true}return false},$contains:function(e,t){return e.indexOf(t)>=0},$nin:function(e,t){return!this.$in(e,t)},$regex:function(e,t){var n=false;if(Array.isArray(e)){for(var r=0;r<e.length;r++){if(t.test(e[r])){return true}}}else return t.test(e)},$gte:function(e,t){return!this.$null(e)&&e>=this.resolve(t)},$gt:function(e,t){return!this.$null(e)&&e>this.resolve(t)},$lt:function(e,t){return!this.$null(e)&&e<this.resolve(t)},$lte:function(e,t){return!this.$null(e)&&e<=this.resolve(t)},$before:function(e,t){if(typeof t==="string")t=Date.parse(t);if(typeof e==="string")e=Date.parse(e);return this.$lte(e,t)},$after:function(e,t){if(typeof t==="string")t=Date.parse(t);if(typeof e==="string")e=Date.parse(e);return this.$gte(e,t)},$type:function(e,t){return typeof e==t},$all:function(e,t){throw new Error("$all not implemented")},$size:function(e,t){return typeof e=="object"&&(e.length==t||Object.keys(e).length==t)},$mod:function(e,t){return e%t[0]==t[1]},$equal:function(){return this.$eq(arguments)},$between:function(e,t){return this._satisfies(e,{$gt:t[0],$lt:t[1]})},resolve:function(e){if(typeof e==="object"){if(e["$date"])return Date.parse(e["$date"])}return e}}}};t.undot=function(e,t){var n=t.split("."),r=e;for(var i=0;i<n.length;i++){if(r)r=r[n[i]]}return r};t.lhs.rhs.$equal=t.lhs.rhs.$eq;t.lhs.rhs.$any=t.lhs.rhs.$or;t.lhs.rhs.$all=t.lhs.rhs.$and;t.satisfies=function(e,t,n){return this.lhs._rowsatisfies(e,t,n)};Array.prototype.query=function(e){return t.query(this,e)};RegExp.prototype.toJSON=RegExp.prototype.toString;if(true)e.exports=t;else{}return t})(this);e.exports=t},459:function(e){"use strict";var t=1;function getNextValue(){t=(t*9301+49297)%233280;return t/233280}function setSeed(e){t=e}e.exports={nextValue:getNextValue,seed:setSeed}},462:function(module){Mapper=function(OBJY,mapperOptions){return Object.assign(new OBJY.ProcessorTemplate(OBJY),{execute:function(dsl,obj,prop,data,callback,client,app,user,options){OBJY.Logger.log("Executing dsl in mapper");if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){try{if((mapperOptions||{}).hasOwnProperty("parse")){mapperOptions.parse(dsl)}else{eval(dsl)}}catch(e){OBJY.Logger.error(e)}if(callback)callback()}else{try{if((mapperOptions||{}).hasOwnProperty("parse")){mapperOptions.parse(dsl)}else{eval(dsl)}}catch(e){OBJY.Logger.error(e)}if(callback)callback()}}})};module.exports=Mapper},493:function(e,t,n){var r=n(969);var i=n(982);var o=n(928);var a=n(860);var s=r;var f=i;var u=o;e.exports=function(e){return{Logger:a,predefinedProperties:["_aggregatedEvents","authorisations","_id","properties","role","applications","inherits","onCreate","onChange","onDelete","permissions","privileges","created","lastModified"],metaPropPrefix:"",instance:this,activeTenant:null,activeUser:null,activeApp:null,objectFamilies:[],affectables:[],staticRules:[],mappers:{},caches:{},backgroundAffectables:this.staticRules,handlerSequence:[],permissionSequence:[],commandSequence:[],eventAlterationSequence:[],storage:null,processor:null,observer:null,StorageTemplate:s,ProcessorTemplate:f,ObserverTemplate:u,processors:{},observers:{}}}},508:function(e){var t=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{customStorage:function(t,n){return Object.assign(new e.StorageTemplate(e,n),t)},customProcessor:function(t,n){return Object.assign(new e.ProcessorTemplate(e,n),t)},customObserver:function(t,n){return Object.assign(new e.ObserverTemplate(e,n),t)},getPersistenceMapper:function(e){if(!this.mappers[e])throw new Error("No such Object Family");return this.mappers[e]},getPersistence:function(e){if(!this.mappers[e])throw new Error("No such Object Family: "+e);return this.mappers[e]},plugInPersistenceMapper:function(e,t){if(!e)throw new Error("No mapper name provided");this.mappers[e]=t;if(Array.isArray(this.mappers[e])){this.mappers[e].forEach(t=>{t.setObjectFamily(e)})}else this.mappers[e].setObjectFamily(e);this.caches[e]={data:{},add:function(e,t){if(Object.keys(this.data).length>=50)delete this.data[Object.keys(this.data).length];this.data[e]=t},get:function(e){return this.data[e]}}},getProcessor:function(e){if(!this.processors[e])throw new Error("No such Object Family");return this.processors[e]},plugInProcessor:function(e,t){if(!e)throw new Error("No mapper name provided");this.processors[e]=t;this.processors[e].setObjectFamily(e)},getObserver:function(e){if(!this.observers[e])throw new Error("No such Object Family");return this.observers[e]},plugInObserver:function(e,t){if(!e)throw new Error("No mapper name provided");this.observers[e]=t;this.observers[e].setObjectFamily(e)},instantStorage:function(e){return Object.assign(new StorageTemplate(this),e)},instantObserver:function(e){return Object.assign(new ObserverTemplate(this),e)},instantProcessor:function(e){return Object.assign(new ProcessorTemplate,e)},remove:function(e,t,n,r,i,o,a){this.removeObject(e,t,n,r,i,o,a)},removeObject:function(e,t,n,r,i,o,a){var s=this;this.mappers[e.role].remove(e,function(e){t(e)},function(e){n(e)},r,i,o,a)},add:function(n,r,i,o,a,s,f){if(n){var u=Object.keys(n);u.forEach(function(n){if(!t(n))return;if(n.template)n=null;if(n.type==CONSTANTS.PROPERTY.TYPE_SHORTID){if(n.value==""&&!n.value)n.value=e.RANDOM()}})}this.addObject(n,r,i,o,a,s,f)},addObject:function(e,t,n,r,i,o,a){if(Array.isArray(this.mappers[e.role])){var s=0;var f=this.mappers[e.role].length;var u=[];function commit(o){this.mappers[e.role][o].add(e,function(n){u.push(e);++o;if(o==f)return t(n);commit(o)},function(e){n(e)},r,i,u[o-1],a)}commit(s);this.mappers[e.role].forEach(e=>{})}else{this.mappers[e.role].add(e,function(e){t(e)},function(e){n(e)},r,i,o,a)}},updateO:function(t,n,r,i,o,a,s){var f=this;if((t.inherits||[]).length==0)f.updateObject(t,n,r,i,o,a);var u=0;(t.inherits||[]).forEach(function(h){if(t._id!=h){e.removeTemplateFieldsForObject(t,h,function(){u++;if(u==t.inherits.length){f.updateObject(t,n,r,i,o,a);return t}},function(e){f.updateObject(t,n,r,i,o,a,s);return t},o,a,s)}else{if(t.inherits.length==1){f.updateObject(t,n,r,i,o,a,s);return t}else{u++;return}}});return},updateObject:function(e,t,n,r,i,o,a){this.mappers[e.role].update(e,function(e){t(e)},function(e){n(e)},r,i,o,a)},getObjectById:function(e,t,n,r,i,o,a,s,a){this.mappers[e].getById(t,function(e){if(e==null){r("Error - object not found: "+t);return}n(e)},function(e){r("Error - Could get object: "+e)},i,o,s,a)},findObjects:function(e,t,n,r,i,o,a,s,f){var u=[];var h=[];this.mappers[t].getByCriteria(e,function(e){var t=0;var r=e.length;if(r==0)return n([]);n(e)},function(e){r("Error - Could get object: "+e)},i,o,a,s,f)},countObjects:function(e,t,n,r,i,o,a,s){var f=[];var u=[];this.mappers[t].count(e,function(e){var t=0;var r=e.length;if(r==0)n([]);n(e)},function(e){r("Error - Could get object: "+e)},i,o,a,s,instance)},findAllObjects:function(e,t,n,r,i,o,a,s){this.findObjects(e,t,n,r,i,o,a,s)}}}},531:function(e){e.exports=require("cluster")},566:function(e,t,n){var r=typeof process!=="undefined"&&process.versions&&process.versions.node;if(r){r={version:process.versions.node}}var i={};var o=function(e){return!!e&&e.constructor===Object};var a=n(493)(i);var s=n(261)(i);var f=n(993)(i);var u=n(272)(i);var h=n(414)(i);var l=n(508)(i);var c=n(925)(i);var d=n(843)(i);var g=n(788)(i);var v=n(750)(i);Object.assign(i,{...a,...s,...f,...u,...h,...l,...c,...d,...g,...v,hello:function(){i.Logger.log("Hello from OBJY!")}});objy=i;if(r)e.exports=i;else if(window)window.OBJY=i},720:function(e,t,n){"use strict";var r=n(459);var i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";var o;var a;var s;function reset(){s=false}function setCharacters(e){if(!e){if(o!==i){o=i;reset()}return}if(e===o){return}if(e.length!==i.length){throw new Error("Custom alphabet for shortid must be "+i.length+" unique characters. You submitted "+e.length+" characters: "+e)}var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length){throw new Error("Custom alphabet for shortid must be "+i.length+" unique characters. These characters were not unique: "+t.join(", "))}o=e;reset()}function characters(e){setCharacters(e);return o}function setSeed(e){r.seed(e);if(a!==e){reset();a=e}}function shuffle(){if(!o){setCharacters(i)}var e=o.split("");var t=[];var n=r.nextValue();var a;while(e.length>0){n=r.nextValue();a=Math.floor(n*e.length);t.push(e.splice(a,1)[0])}return t.join("")}function getShuffled(){if(s){return s}s=shuffle();return s}function lookup(e){var t=getShuffled();return t[e]}function get(){return o||i}e.exports={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},750:function(e,t,n){var r=n(797);var i=n(2);var o=n(373);var a=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{Obj:function(t,n,s,f){e.Logger.log("Plain Object: "+t);if(s.metaPropPrefix!=""&&typeof t!=="string")t=e.serialize(t);if(!t)t={};if(t._id)this._id=t._id;if(typeof t==="string"){this._id=t}if(t===undefined)t={};this.role=n||"object";if(f.extendedStructure){for(var u in f.extendedStructure){if(f.extendedStructure[u]===null)this[u]=t[u];else if(f.extendedStructure[u]==="$useForProps"){f.propsObject=u;e.PropertiesChecker(this,t[f.propsObject],s,f)}else this[u]=f.extendedStructure[u];if(!e.predefinedProperties.includes(u))e.predefinedProperties.push(u)}}if(f.hasAffects){this.affects=e.AffectsCreateWrapper(this,t.affects,s);this.apply=e.ApplyCreateWrapper(this,t.apply,s)}this._constraints=t._constraints;this.applications=e.ApplicationsChecker(this,t.applications);this.inherits=e.InheritsChecker(this,t.inherits);this.onCreate=e.ObjectOnCreateCreateWrapper(this,t.onCreate,s);this.onChange=e.ObjectOnChangeCreateWrapper(this,t.onChange,s);this.onDelete=e.ObjectOnDeleteCreateWrapper(this,t.onDelete,s);this.created=t.created||r().utc().toDate().toISOString();this.lastModified=t.lastModified||r().utc().toDate().toISOString();if(!f.propsObject)e.PropertiesChecker(this,t,s,f);this.permissions=e.ObjectPermissionsCreateWrapper(this,t.permissions);this._aggregatedEvents=t._aggregatedEvents;this.authorisations=t.authorisations||undefined;if(f.authable){this.username=t.username||null;this.email=t.email||null;this.password=t.password||null;this.spooAdmin=t.spooAdmin;delete this.name;this.setUsername=function(t){this.username=t;e.chainPermission(this,s,"o","setUsername",t);return this};this.setEmail=function(t){this.email=t;e.chainPermission(this,s,"h","setEmail",t);return this};this.setPassword=function(e){this.password=e;return this};this.setAuthorisation=function(t){new e.ObjectAuthorisationSetWrapper(this,t,s);return this};this.removeAuthorisation=function(t){new e.ObjectAuthorisationRemoveWrapper(this,t,s);return this}}if(f.authable||f.authableTemplate){this.privileges=e.PrivilegesChecker(t)||{};this._clients=t._clients;this.addPrivilege=function(t){if(s.activeApp){var n={};n[s.activeApp]={name:t};new e.PrivilegeChecker(this,n);return this}else throw new Error("Invalid app id");return this};this.removePrivilege=function(t){new e.PrivilegeRemover(this,t,s);return this};this.addClient=function(e){if(this._clients.indexOf(e)!=-1)throw new Error("Client "+e+" already exists");this._clients.push(e);return this};this.removeClient=function(e){if(this._clients.indexOf(e)==-1)throw new Error("Client "+e+" does not exist");this._clients.splice(this._clients.indexOf(e),1);return this}}Object.getPrototypeOf(this).addInherit=function(t){e.addTemplateToObject(this,t,s);return this};Object.getPrototypeOf(this).removeInherit=function(t,n,r){e.removeTemplateFromObject(this,t,function(e){if(n)n(t)},function(e){if(r)r(e)},s);return this};Object.getPrototypeOf(this).addApplication=function(t){e.addApplicationToObject(this,t,s);return this};Object.getPrototypeOf(this).removeApplication=function(t){e.removeApplicationFromObject(this,t,s);return this};Object.getPrototypeOf(this).replace=function(t){t=e[this.role](t);var n=this;if(n.role!=t.role)throw new Error("cannot alter role");Object.keys(this).forEach(function(e){if(n[e]instanceof Function||e=="_id")return;delete n[e]});function doTheProps(e,t){Object.keys(t).forEach(function(n){if(t[n]==null||t[n]===undefined)return;e[n]=t[n];if(typeof t[n]==="object"){doTheProps(e[n],t[n])}})}doTheProps(n,t);return n};Object.getPrototypeOf(this).addProperty=function(t,n){var r={};r[t]=n;n=r;var i=Object.keys(n)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var u=i.substring(o+1,i.length);var h={};h[u]=n[i];this.addPropertyToBag(a,h);return}new e.PropertyCreateWrapper(this,n,false,s,f,true);return this};Object.getPrototypeOf(this).setOnChange=function(t,n){if(typeof n!=="object")throw new o.InvalidArgumentException;var r=t;new e.ObjectOnChangeSetWrapper(this,r,n.value,n.trigger,n.type,s);return this};Object.getPrototypeOf(this).setOnDelete=function(t,n){if(typeof n!=="object")throw new o.InvalidArgumentException;var r=t;new e.ObjectOnDeleteSetWrapper(this,r,n.value,n.trigger,n.type,s);return this};Object.getPrototypeOf(this).setOnCreate=function(t,n){if(typeof n!=="object")throw new o.InvalidArgumentException;var r=t;new e.ObjectOnCreateSetWrapper(this,r,n.value,n.trigger,n.type,s);return this};Object.getPrototypeOf(this).removeOnChange=function(e){if(!this.onChange[e])throw new o.HandlerNotFoundException(e);else delete this.onChange[e];return this};Object.getPrototypeOf(this).removeOnDelete=function(e){if(!this.onDelete[e])throw new o.HandlerNotFoundException(e);else delete this.onDelete[e];return this};Object.getPrototypeOf(this).removeOnCreate=function(e){if(!this.onCreate[e])throw new o.HandlerNotFoundException(e);else delete this.onCreate[e];return this};Object.getPrototypeOf(this).setPermission=function(t,n){var r={};r[t]=n;n=r;new e.ObjectPermissionSetWrapper(this,n,s);return this};Object.getPrototypeOf(this).removePermission=function(t){new e.ObjectPermissionRemoveWrapper(this,t,s);return this};Object.getPrototypeOf(this).setPropertyValue=function(t,n,r){new e.PropertySetWrapper(this,t,n,s,f);return this};Object.getPrototypeOf(this).setProperty=function(t,n,r){new e.PropertySetFullWrapper(this,t,n,s,false,f);return this};Object.getPrototypeOf(this).makeProperty=function(t,n,r){new e.PropertySetFullWrapper(this,t,n,s,true,f);return this};Object.getPrototypeOf(this).setEventDate=function(t,n,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var u=i.substring(o+1,i.length);var h={};this.setBagEventDate(a,u,n,r);return}new e.EventDateSetWrapper(this,t,n,r,s,f);return this};Object.getPrototypeOf(this).setEventAction=function(t,n,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var u=i.substring(o+1,i.length);var h={};this.setBagEventAction(a,u,n,r);return}new e.EventActionSetWrapper(this,t,n,r,s,f);return this};Object.getPrototypeOf(this).setEventTriggered=function(t,n,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var u=i.substring(o+1,i.length);var h={};this.setBagEventTriggered(a,u,n,r);return}new e.EventTriggeredSetWrapper(this,t,n,r,s,f);return this};Object.getPrototypeOf(this).setEventLastOccurence=function(t,n,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var s=i.substring(o+1,i.length);var u={};this.setBagEventLastOccurence(a,s,n,r);return}new e.EventLastOccurenceSetWrapper(this,t,n,r,f);return this};Object.getPrototypeOf(this).setEventInterval=function(t,n,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var o=i.lastIndexOf(".");var a=i.substring(0,o);var u=i.substring(o+1,i.length);var h={};this.setBagEventInterval(a,u,n,r);return}new e.EventIntervalSetWrapper(this,t,n,r,s,f);return this};Object.getPrototypeOf(this).pushToArray=function(e,t){var n=Object.keys(t)[0];var r={};var i;i=shortid.generate();r[i]=t[n];this.addPropertyToBag(e,r)};Object.getPrototypeOf(this).setPropertyPermission=function(t,n,r){var i={};i[n]=r;r=i;new e.PropertyPermissionSetWrapper(this,t,r,s,f);return this};Object.getPrototypeOf(this).setPropertyOnCreate=function(t,n,r){if(typeof r!=="object")throw new o.InvalidArgumentException;var i=n;new e.PropertyOnCreateSetWrapper(this,t,i,r.value,r.trigger,r.type,s,f);return this};Object.getPrototypeOf(this).removePropertyOnCreate=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnCreateFromBag(e,t);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].onCreate)throw new o.NoOnCreateException;if(!this[e].onCreate[t])throw new o.NoOnCreateException;delete this[e].onCreate[e]}return this};Object.getPrototypeOf(this).removePropertyOnCreateFromBag=function(t,n){var r=this.getProperty(t);if(this.role=="template"){}new e.PropertyBagItemOnCreateRemover(this,t,n);return this};Object.getPrototypeOf(this).setPropertyMeta=function(t,n){new e.PropertyMetaSetWrapper(this,t,n,f);return this};Object.getPrototypeOf(this).removePropertyMetaFromBag=function(t){var n=this.getProperty(t);if(this.role=="template"){}new e.PropertyBagItemMetaRemover(this,t);return this};Object.getPrototypeOf(this).removePropertyMeta=function(e){if(e.indexOf(".")!=-1){this.removePropertyMetaFromBag(e);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].meta)throw new o.NoMetaException;delete this[e].meta}return this};Object.getPrototypeOf(this).setPropertyOnChange=function(t,n,r){if(typeof r!=="object")throw new o.InvalidArgumentException;var i=n;new e.PropertyOnChangeSetWrapper(this,t,i,r.value,r.trigger,r.type,s,f);return this};Object.getPrototypeOf(this).removePropertyOnChange=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnChangeFromBag(e,t);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].onDelete[t])throw new o.HandlerNotFoundException(t);delete this[e][t]}return this};Object.getPrototypeOf(this).removePropertyOnChangeFromBag=function(t,n){var r=this.getProperty(t);new e.PropertyBagItemOnChangeRemover(this,t,n);return this};Object.getPrototypeOf(this).setPropertyOnDelete=function(t,n,r){if(typeof r!=="object")throw new o.InvalidArgumentException;var i=n;new e.PropertyOnDeleteSetWrapper(this,t,i,r.value,r.trigger,r.type,s,f);return this};Object.getPrototypeOf(this).removePropertyOnDelete=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnDeleteFromBag(e,t);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].onDelete[t])throw new o.HandlerNotFoundException(t);delete this[e].onDelete[t]}return this};Object.getPrototypeOf(this).removePropertyOnDeleteFromBag=function(t,n){var r=this.getProperty(t);new e.PropertyBagItemOnDeleteRemover(this,t,n);return this};Object.getPrototypeOf(this).setPropertyConditions=function(t,n){var r=Object.keys(t)[0];if(r.indexOf(".")!=-1){var i=r.lastIndexOf(".");var o=r.substring(0,i);var a=r.substring(i+1,r.length);var s={};this.setBagPropertyConditions(o,a,n);return}new e.PropertyConditionsSetWrapper(this,t,n,f);return this};Object.getPrototypeOf(this).setBagPropertyConditions=function(t,n,r){new e.PropertyConditionsSetWrapper(this.getProperty(t),n,r,f);return this};Object.getPrototypeOf(this).setBagPropertyPermission=function(t,n,r){new e.PropertyPermissionSetWrapper(this.getProperty(t),n,r,f);return this};Object.getPrototypeOf(this).setPropertyQuery=function(t,n){var r=Object.keys(t)[0];if(r.indexOf(".")!=-1){var i=r.lastIndexOf(".");var o=r.substring(0,i);var a=r.substring(i+1,r.length);var s={};this.setBagPropertyQuery(o,a,value);return}new e.PropertyQuerySetWrapper(this,t,n,f);return this};Object.getPrototypeOf(this).removePropertyQuery=function(e){if(e.indexOf(".")!=-1){this.removePropertyQueryFromBag(e);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].query)throw new o.NoSuchPermissionException(permissionKey);delete this[e].query}return this};Object.getPrototypeOf(this).removePropertyQueryFromBag=function(t){var n=this.getProperty(t);new e.PropertyBagItemQueryRemover(this,t);return this};Object.getPrototypeOf(this).removePropertyConditions=function(e){if(e.indexOf(".")!=-1){this.removePropertyConditionsFromBag(e);return}else{if(!this[e])throw new o.NoSuchPropertyException(e);if(!this[e].conditions)throw new o.NoSuchPermissionException(permissionKey);delete this[e].conditions}return this};Object.getPrototypeOf(this).removePropertyConditionsFromBag=function(t){var n=this.getProperty(t);new e.PropertyBagItemConditionsRemover(this,t);return this};Object.getPrototypeOf(this).setBagPropertyQuery=function(e,t,n){return this};Object.getPrototypeOf(this).removePropertyPermission=function(t,n){if(t.indexOf(".")!=-1){this.removePropertyPermissionFromBag(t,n);return}else{if(!this[t])throw new o.NoSuchPropertyException(t);if(!this[t].permissions[n])throw new o.NoSuchPermissionException(n);e.chainPermission(this,s,"x","removePropertyPermission",n);delete this[t].permissions[n]}return this};Object.getPrototypeOf(this).setBagPropertyValue=function(t,n,r,i){new e.PropertySetWrapper(this.getProperty(t),n,r,s,f);return this};Object.getPrototypeOf(this).setBagEventDate=function(t,n,r,i){new e.EventDateSetWrapper(this.getProperty(t),n,r,s,f);return this};Object.getPrototypeOf(this).setBagEventAction=function(t,n,r,i){new e.EventActionSetWrapper(this.getProperty(t),n,r,s,f);return this};Object.getPrototypeOf(this).setBagEventInterval=function(t,n,r,i){new e.EventIntervalSetWrapper(this.getProperty(t),n,r,s,f);return this};Object.getPrototypeOf(this).setBagEventTriggered=function(t,n,r,i){new e.EventTriggeredSetWrapper(this,n,r,i,s,f);return this};Object.getPrototypeOf(this).setBagEventLastOccurence=function(t,n,r,i){new e.EventLastOccurenceSetWrapper(this.getProperty(t),n,r,i,f);return this};Object.getPrototypeOf(this).addPropertyToBag=function(t,n){var r=this.getProperty(t);new e.PropertyCreateWrapper(r,n,true,s,f,true);return this};Object.getPrototypeOf(this).removePropertyFromBag=function(t,n){var r=this.getProperty(t);new e.PropertyBagItemRemover(this,t,s);return this};Object.getPrototypeOf(this).removePropertyPermissionFromBag=function(t,n){var r=this.getProperty(t);new e.PropertyBagItemPermissionRemover(this,t,n,s);return this};Object.getPrototypeOf(this).removeProperty=function(t,n){var r=this;if(f.propsObject)r=this[f.propsObject];if(t.indexOf(".")!=-1){this.removePropertyFromBag(t,n);return}else{if(!r[t])throw new o.NoSuchPropertyException(t);var i=Object.assign({},r[t]);if(i.onDelete){if(Object.keys(i.onDelete).length>0){if(!s.handlerSequence[this._id])s.handlerSequence[this._id]={};if(!s.handlerSequence[this._id].onDelete)s.handlerSequence[this._id].onDelete=[];s.handlerSequence[this._id].onDelete.push({handler:i.onDelete,prop:i})}}e.chainPermission(r[t],s,"d","removeProperty",t);delete r[t]}return this};Object.getPrototypeOf(this).getId=function(){return this._id};Object.getPrototypeOf(this).getName=function(){return this.name};Object.getPrototypeOf(this).setName=function(t){this.name=t;e.chainPermission(this,s,"n","setName",t);return this};Object.getPrototypeOf(this).setType=function(t){this.type=t;e.chainPermission(this,s,"t","setType",t);return this};Object.getPrototypeOf(this).getType=function(){return this.type};Object.getPrototypeOf(this).getRef=function(t){return new e.PropertyRefParser(this,t)};Object.getPrototypeOf(this).getProperty=function(t){return e.PropertyParser(this,t,s,f)};Object.getPrototypeOf(this).getProperties=function(){return this[f.propsObject]||this};Object.getPrototypeOf(this).add=function(n,o,u){var u=u||s.activeTenant;var h=s.activeApp;var l=this;e.applyAffects(l,"onCreate",s,u,f);e.checkAuthroisations(this,s.activeUser,"c",s.activeApp);if(!this._id)this._id=e.ID();if(f.dirty){var c=e.checkConstraints(t);if(Array.isArray(c)&&o){return o({message:"constraints error: "+c.join(",")})}e.add(l,function(t){l._id=t._id;e.deSerializePropsObject(t,f);if(n)n(e.deserialize(t));delete l.instance},function(e){console.warn("err",e,o);if(o)o(e)},h,u,f);return e.deserialize(this)}if(l.onCreate){Object.keys(l.onCreate).forEach(function(e){if(l.onCreate[e].trigger=="before"||!l.onCreate[e].trigger){s.execProcessorAction(l.onCreate[e].value||l.onCreate[e].action,l,null,null,function(e){},u,null)}})}this.created=r().utc().toDate().toISOString();this.lastModified=r().utc().toDate().toISOString();l._aggregatedEvents=[];function aggregateAllEvents(e,t){Object.keys(e).forEach(function(n){if(!a(e[n]))return;if(e[n].type==i.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[n],t+"."+n)}else{aggregateAllEvents(e[n],n)}if(e[n].type==i.PROPERTY.TYPE_EVENT){var o=null;if(e[n].date){if(!e[n].triggered)o=e[n].date;else o=null}else if(e[n].interval){if(e[n].nextOccurence){o=e[n].nextOccurence}else o=r().utc().toISOString()}if(t){s.eventAlterationSequence.push({operation:"add",obj:l,propName:t+"."+n,property:e[n],date:o});var f=false;l._aggregatedEvents.forEach(function(e){if(e.propName==t+"."+n)f=true});if(!f&&e[n].triggered!=true)l._aggregatedEvents.push({propName:t+"."+n,date:o})}else{s.eventAlterationSequence.push({operation:"add",obj:l,propName:n,property:e[n],date:o});var f=false;l._aggregatedEvents.forEach(function(e){if(e.propName==n)f=true});if(!f&&e[n].triggered!=true)l._aggregatedEvents.push({propName:n,date:o})}}})}var d=s.observers[l.role];aggregateAllEvents(l);if(h){if(!this.applications)this.applications=[];if(this.applications)if(this.applications.indexOf(h)==-1)this.applications.push(h)}var g=function(t){if(!e.checkPermissions(s.activeUser,s.activeApp,t,"c"))return o({error:"Lack of Permissions"});var r=e.checkConstraints(t);if(Array.isArray(r)&&o){return o({message:"constraints error: "+r.join(",")})}e.add(t,function(r){t._id=r._id;if(r.onCreate){Object.keys(r.onCreate).forEach(function(e){if(r.onCreate[e].trigger=="after"){s.execProcessorAction(r.onCreate[e].value||r.onCreate[e].action,r,null,null,function(e){},u,null)}})}if(d.type=="scheduled"){s.eventAlterationSequence.forEach(function(e){if(e.operation=="add"){d.addEvent(t._id,e.propName,e.property,function(e){},function(e){},s.activeTenant)}else if(e.operation=="remove"){d.addEvent(t._id,e.propName,function(e){},function(e){},s.activeTenant)}})}s.eventAlterationSequence=[];e.Logger.log("Added Object: "+JSON.stringify(r,null,2));e.deSerializePropsObject(r,f);if(n)n(e.deserialize(r));delete l.instance},function(e){if(o)o(e)},h,u,f,s)};if(f.templateMode==i.TEMPLATEMODES.STRICT){if(this.inherits.length==0)g(l);var v=0;this.inherits.forEach(function(t){if(l._id!=t){e.getTemplateFieldsForObject(l,t,function(){v++;if(v==l.inherits.length){g(l);return this}},function(e){if(o)o(l);return this},u,f.templateFamily,f.templateSource,f)}})}else{g(l)}return e.deserialize(this)};Object.getPrototypeOf(this).update=function(t,n,u){var u=u||s.activeTenant;var h=s.activeApp;e.checkAuthroisations(this,s.activeUser,"u",s.activeApp);var l=this;if(f.dirty){var c=e.checkConstraints(this);if(Array.isArray(c)&&n){return n({message:"constraints error: "+c.join(",")})}e.updateO(l,function(n){delete s.handlerSequence[this._id];s.eventAlterationSequence=[];e.deSerializePropsObject(n,f);if(t)t(e.deserialize(n))},function(e){if(n)n(e)},h,u,f,s);return e.deserialize(this)}if(!e.checkPermissions(s.activeUser,s.activeApp,l,"u"))return n({error:"Lack of Permissions"});if((s.permissionSequence[l._id]||[]).length>0){throw new o.LackOfPermissionsException(s.permissionSequence[l._id])}if(l.onChange){Object.keys(l.onChange).forEach(function(e){if(l.onChange[e].trigger=="before"){s.execProcessorAction(l.onChange[e].value||l.onChange[e].action,l,null,null,function(e){},u,null)}})}if(s.handlerSequence[this._id]){for(var d in s.handlerSequence[this._id]){for(var g in s.handlerSequence[this._id][d]){var v=s.handlerSequence[this._id][d][g];for(var y in v.handler){if(v.handler[y].trigger=="before"){s.execProcessorAction(v.handler[y].value||v.handler[y].action,l,v.prop,null,function(e){},u,null)}}}}}this.lastModified=r().toDate().toISOString();var l=this;l._aggregatedEvents=[];function aggregateAllEvents(e,t){Object.keys(e).forEach(function(n){if(!a(e[n]))return;if(e[n].type==i.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[n],t+"."+n)}else{aggregateAllEvents(e[n],n)}if(e[n].type==i.PROPERTY.TYPE_EVENT){var o=null;if(e[n].date){if(!e[n].triggered)o=e[n].date;else o=null}else if(e[n].interval){if(e[n].nextOccurence){o=e[n].nextOccurence}else o=r().utc().toISOString()}if(t){var s=false;l._aggregatedEvents.forEach(function(e){if(e.propName==t+"."+n)s=true});if(!s&&e[n].triggered!=true)l._aggregatedEvents.push({propName:t+"."+n,date:o})}else{var s=false;l._aggregatedEvents.forEach(function(e){if(e.propName==n)s=true});if(!s&&e[n].triggered!=true)l._aggregatedEvents.push({propName:n,date:o})}}})}var P=s.observers[l.role];if(P.type!="scheduled")aggregateAllEvents(this);function updateFn(){var r=e.checkConstraints(l);if(Array.isArray(r)&&n){return n({message:"constraints error: "+r.join(",")})}e.updateO(l,function(n){e.applyAffects(n,"onChange",s,u,f);if(n.onChange){Object.keys(n.onChange).forEach(function(e){if(n.onChange[e].trigger=="after"){s.execProcessorAction(n.onChange[e].value||n.onChange[e].action,n,null,null,function(e){},u,null)}})}if(s.handlerSequence[l._id]){for(var r in s.handlerSequence[l._id]){for(var o in s.handlerSequence[l._id][r]){var a=s.handlerSequence[l._id][r][o];for(var h in a.handler){if(a.handler[h].trigger=="after"||!a.handler[h].trigger){s.execProcessorAction(a.handler[h].value||a.handler[h].action,l,a.prop,null,function(e){},u,null)}}}}}delete s.handlerSequence[l._id];if(P.type=="scheduled"){s.eventAlterationSequence.forEach(function(e){if(e.type=="add"){P.addEvent(l._id,e.propName,e.property,function(e){},function(e){},s.activeTenant)}})}s.eventAlterationSequence=[];if(f.templateMode==i.TEMPLATEMODES.STRICT){e.updateInheritedObjs(l,f.pluralName,function(e){},function(e){},u,f)}e.Logger.log("Updated Object: "+n);e.deSerializePropsObject(n,f);if(t)t(e.deserialize(n))},function(e){if(n)n(e)},h,u,f,s)}if(s.commandSequence.length>0&&f.templateMode==i.TEMPLATEMODES.STRICT){var m=false;var _=0;s.commandSequence.forEach(function(e){if(e.name=="addInherit"||e.name=="removeInherit"){_++;m=true}});if(_==0)updateFn(l);var E=0;s.commandSequence.forEach(function(t){if(t.name=="addInherit"&&l.inherits.indexOf(t.value)!=-1){E++;e.getTemplateFieldsForObject(l,t.value,function(){if(E==_){updateFn(l)}},function(e){if(n)n(l);return l},u,f.templateFamily,f.templateSource,f,s)}if(t.name=="removeInherit"&&l.inherits.indexOf(t.value)==-1){E++;e.removeTemplateFieldsForObject(l,t.value,function(){if(E==_){updateFn(l)}},function(e){if(n)n(l);return l},u,f,s)}})}else updateFn(l);s.commandSequence=[];return e.deserialize(this)};Object.getPrototypeOf(this).remove=function(t,n,o){var o=o||s.activeTenant;var u=s.activeApp;var h=JSON.parse(JSON.stringify(this));e.checkAuthroisations(this,s.activeUser,"d",s.activeApp);if(f.dirty){e.getObjectById(this.role,this._id,function(r){return e.remove(h,function(n){e.deSerializePropsObject(r,f);t(e.deserialize(r))},function(e){if(n)n(e)},u,o)},function(e){if(n)n(e)},u,o,s,f,s);return e.deserialize(this)}if(!e.checkPermissions(s.activeUser,s.activeApp,h,"d"))return n({error:"Lack of Permissions"});if(h.onDelete){Object.keys(h.onDelete).forEach(function(e){if(h.onDelete[e].trigger=="before"){s.execProcessorAction(h.onDelete[e].value||h.onDelete[e].action,h,null,null,function(e){},o,null)}})}e.getObjectById(this.role,this._id,function(l){return e.remove(h,function(n){if(h.onDelete){Object.keys(h.onDelete).forEach(function(e){if(h.onDelete[e].trigger=="after"){s.execProcessorAction(h.onDelete[e].value||h.onDelete[e].action,h,null,null,function(e){},o,null)}})}function aggregateAllEvents(e,t){Object.keys(e||{}).forEach(function(n){if(!a(e[n]))return;if(e[n].type==i.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[n],t+"."+n)}else{if(e[n])aggregateAllEvents(e[n],n)}if(e[n].type==i.PROPERTY.TYPE_EVENT){var o=null;if(e[n].date){if(!e[n].date.triggered)o=e[n].date;else o=null}else if(e[n].interval){if(e[n].nextOccurence){o=e[n].nextOccurence}else o=r().utc().toISOString()}if(t){s.eventAlterationSequence.push({operation:"remove",obj:h,propName:t+"."+n,date:o});var f=false}else{s.eventAlterationSequence.push({operation:"remove",obj:h,propName:n,date:o})}}})}var u=s.observers[h.role];aggregateAllEvents(l||{});if(u.type=="scheduled"){s.eventAlterationSequence.forEach(function(e){if(e.operation=="add"){u.addEvent(l._id,e.propName,e.property,function(e){},function(e){},s.activeTenant)}else if(e.operation=="remove"){u.removeEvent(l._id,e.propName,function(e){},function(e){console.log(e)},s.activeTenant)}})}if(f.templateMode==i.TEMPLATEMODES.STRICT){e.removeInheritedObjs(h,f.pluralName,function(e){},function(e){},o,f)}e.Logger.log("Removed Object: "+l);e.deSerializePropsObject(l,f);if(t)t(e.deserialize(l))},function(e){if(n)n(e)},u,o)},function(e){if(n)n(e)},u,o,s,f,s);return e.deserialize(this)};Object.getPrototypeOf(this).get=function(t,n,r){var o=s.activeTenant;var a=s.activeApp;var u=this;e.checkAuthroisations(this,s.activeUser,"r",s.activeApp);if(f.dirty){e.getObjectById(u.role,u._id,function(n){e.deSerializePropsObject(n,f);if(t)t(e[n.role](e.deserialize(n)))},function(e){if(n)n(e)},a,o,s,f,s);return e.deserialize(this)}var h=0;function prepareObj(a){var l=e[a.role](e.deserialize(a));e.applyAffects(a,null,s,o,f);if(!e.checkPermissions(s.activeUser,s.activeApp,a,"r"))return n({error:"Lack of Permissions"});if(r){if(t)t(l);return a}if(f.templateMode==i.TEMPLATEMODES.STRICT){if(t)t(l);return a}if((a.inherits||[]).length==0){if(t)t(e.deSerializePropsObject(l,f));return a}a.inherits.forEach(function(n){if(a._id!=n){e.getTemplateFieldsForObject(a,n,function(){var n=e[a.role](e.deserialize(a));h++;if(h==a.inherits.length){if(t)t(e.deSerializePropsObject(n,f));return a}},function(n){h++;var r=e[a.role](e.deserialize(a));if(h==a.inherits.length){if(t)t(e.deSerializePropsObject(r,f));return a}},o,f.templateFamily,f.templateSource,f,s)}else{var r=e[a.role](e.deserialize(a));if(u.inherits.length==1){if(t)t(e.deSerializePropsObject(r,f));return a}else{h++;return}}})}if(s.caches[u.role].data[u._id]){prepareObj(s.caches[u.role].data[u._id])}else{e.getObjectById(u.role,u._id,function(e){prepareObj(e);if(!s.caches[u.role].data[u._id]){}},function(e){if(n)n(e)},a,o,s,f,s)}return e.deserialize(this)};const h={get:(e,t)=>{if(typeof e[t]==="object"&&e[t]!==null){return new Proxy(e[t],h)}else{return e[t]}},set:(e,t,n)=>{if(Array.isArray(e)&&t=="length")return true;e[t]=n;this.update();return true},deleteProperty:(e,t,n)=>{delete e[t];this.update();return true}};if(!f.storage){this.add();var l=this;(this.inherits||[]).forEach(function(t){e.getTemplateFieldsForObject(l,t,function(){},function(e){console.log("errr",e)},s.activeTenant,f.templateFamily,f.templateSource,f,s)});return new Proxy(this,h)}return e.deserialize(this)}}}},755:function(e,t,n){e.exports=n(335)},788:function(e,t,n){var r=n(2);e.exports=function(e){return{Objs:function(t,n,i,o,a){var s=this;if(typeof t==="object"&&!Array.isArray(t)){var a=a||{};Object.keys(t).forEach(function(e){if(["$page","$sort","$pageSize"].indexOf(e)!=-1){a[e]=t[e];delete t[e]}});t=e.buildAuthroisationQuery(t,i.activeUser,"r",i.activeApp);if(i.activeUser)t=e.buildPermissionQuery(t,i.activeUser,i.activeApp);Object.getPrototypeOf(this).get=function(s,f){var u=i.activeTenant;var h=i.activeApp;var l=this;var c=0;e.findObjects(t,n,function(t){var n;for(n=0;n<t.length;n++){if(e[t[n].role])t[n]=e[t[n].role](e.deserialize(t[n]))}if(o.templateMode==r.TEMPLATEMODES.STRICT){s(e.deSerializePropsObjectMulti(t,o));return}if(t.length==0){s(e.deSerializePropsObjectMulti(t,o));return}t.forEach(function(n){e.applyAffects(n,null,i,u);if(!n.inherits)n.inherits=[];var r=0;if(n.inherits.length==0){c++;if(c==t.length){s(e.deSerializePropsObjectMulti(t,o));return n}}n.inherits.forEach(function(a){if(n._id!=a){e.getTemplateFieldsForObject(n,a,function(){r++;if(r==n.inherits.length)c++;if(c==t.length){s(e.deSerializePropsObjectMulti(t,o));return n}},function(i){r++;if(r==n.inherits.length)c++;if(c==t.length){s(e.deSerializePropsObjectMulti(t,o));return n}},u,o.templateFamily,o.templateSource,o,i)}else{if(n.inherits.length==1){s(e.deSerializePropsObjectMulti(t,o));return n}else{r++;return}}})})},function(e){console.log("err",e);f(e)},h,u,a||{},o,i)};Object.getPrototypeOf(this).count=function(r,s){var f=i.activeTenant;var u=i.activeApp;var h=this;var l=0;e.countObjects(t,n,function(e){r(e)},function(e){s(e)},u,f,a||{},o,i);return}}else if(Array.isArray(t)){Object.getPrototypeOf(this).add=function(a,s){var f=i.activeTenant;var u=i.activeApp;var h;var l=0;for(h=0;h<t.length;h++){t[h]=e[n](t[h]).add(function(n){e.applyAffects(n,"onCreate",i,f);if(o.templateMode==r.TEMPLATEMODES.STRICT){var u=0;if(n.inherits.length==0){l++;if(l==t.length){a(t);return n}}n.inherits.forEach(function(r){if(n._id!=r){e.getTemplateFieldsForObject(n,r,function(){u++;if(u==n.inherits.length)l++;if(l==t.length){a(t);return n}},function(e){s(e);return n},f,o.templateFamily,o.templateSource,o,i)}else{if(n.inherits.length==1){a(t);return n}else{u++;return}}})}else{l++;if(l==t.length){a(t);return n}}},function(e){s(e)})}};return this}else{if(o.authMethod)Object.getPrototypeOf(this).auth=o.authMethod;else{Object.getPrototypeOf(this).auth=function(e,t,n,r,a){var s={username:e.username};if(i.authableFields){s={$or:[]};i.authableFields.forEach(function(t){var n={};n[t]=e[t];if(n[t])s.$or.push(n)});if(Object.keys(s.$or).length==0)s={username:e.username}}i[o.pluralName](s).get(function(e){if(e.length==0)n("User not found");t(e[0])},function(e){n(e)})}}}}}}},797:function(e,t,n){e=n.nmd(e);(function(t,n){true?e.exports=n():undefined})(this,function(){"use strict";var t;function hooks(){return t.apply(null,arguments)}function setHookCallback(e){t=e}function isArray(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}function isObject(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"}function isObjectEmpty(e){if(Object.getOwnPropertyNames){return Object.getOwnPropertyNames(e).length===0}else{var t;for(t in e){if(e.hasOwnProperty(t)){return false}}return true}}function isUndefined(e){return e===void 0}function isNumber(e){return typeof e==="number"||Object.prototype.toString.call(e)==="[object Number]"}function isDate(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function map(e,t){var n=[],r;for(r=0;r<e.length;++r){n.push(t(e[r],r))}return n}function hasOwnProp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function extend(e,t){for(var n in t){if(hasOwnProp(t,n)){e[n]=t[n]}}if(hasOwnProp(t,"toString")){e.toString=t.toString}if(hasOwnProp(t,"valueOf")){e.valueOf=t.valueOf}return e}function createUTC(e,t,n,r){return createLocalOrUTC(e,t,n,r,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(e){if(e._pf==null){e._pf=defaultParsingFlags()}return e._pf}var n;if(Array.prototype.some){n=Array.prototype.some}else{n=function(e){var t=Object(this);var n=t.length>>>0;for(var r=0;r<n;r++){if(r in t&&e.call(this,t[r],r,t)){return true}}return false}}function isValid(e){if(e._isValid==null){var t=getParsingFlags(e);var r=n.call(t.parsedDateParts,function(e){return e!=null});var i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict){i=i&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(e)){e._isValid=i}else{return i}}return e._isValid}function createInvalid(e){var t=createUTC(NaN);if(e!=null){extend(getParsingFlags(t),e)}else{getParsingFlags(t).userInvalidated=true}return t}var r=hooks.momentProperties=[];function copyConfig(e,t){var n,i,o;if(!isUndefined(t._isAMomentObject)){e._isAMomentObject=t._isAMomentObject}if(!isUndefined(t._i)){e._i=t._i}if(!isUndefined(t._f)){e._f=t._f}if(!isUndefined(t._l)){e._l=t._l}if(!isUndefined(t._strict)){e._strict=t._strict}if(!isUndefined(t._tzm)){e._tzm=t._tzm}if(!isUndefined(t._isUTC)){e._isUTC=t._isUTC}if(!isUndefined(t._offset)){e._offset=t._offset}if(!isUndefined(t._pf)){e._pf=getParsingFlags(t)}if(!isUndefined(t._locale)){e._locale=t._locale}if(r.length>0){for(n=0;n<r.length;n++){i=r[n];o=t[i];if(!isUndefined(o)){e[i]=o}}}return e}var i=false;function Moment(e){copyConfig(this,e);this._d=new Date(e._d!=null?e._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(i===false){i=true;hooks.updateOffset(this);i=false}}function isMoment(e){return e instanceof Moment||e!=null&&e._isAMomentObject!=null}function absFloor(e){if(e<0){return Math.ceil(e)||0}else{return Math.floor(e)}}function toInt(e){var t=+e,n=0;if(t!==0&&isFinite(t)){n=absFloor(t)}return n}function compareArrays(e,t,n){var r=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),o=0,a;for(a=0;a<r;a++){if(n&&e[a]!==t[a]||!n&&toInt(e[a])!==toInt(t[a])){o++}}return o+i}function warn(e){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+e)}}function deprecate(e,t){var n=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,e)}if(n){var r=[];var i;for(var o=0;o<arguments.length;o++){i="";if(typeof arguments[o]==="object"){i+="\n["+o+"] ";for(var a in arguments[0]){i+=a+": "+arguments[0][a]+", "}i=i.slice(0,-2)}else{i=arguments[o]}r.push(i)}warn(e+"\nArguments: "+Array.prototype.slice.call(r).join("")+"\n"+(new Error).stack);n=false}return t.apply(this,arguments)},t)}var o={};function deprecateSimple(e,t){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(e,t)}if(!o[e]){warn(t);o[e]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(e){return e instanceof Function||Object.prototype.toString.call(e)==="[object Function]"}function set(e){var t,n;for(n in e){t=e[n];if(isFunction(t)){this[n]=t}else{this["_"+n]=t}}this._config=e;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(e,t){var n=extend({},e),r;for(r in t){if(hasOwnProp(t,r)){if(isObject(e[r])&&isObject(t[r])){n[r]={};extend(n[r],e[r]);extend(n[r],t[r])}else if(t[r]!=null){n[r]=t[r]}else{delete n[r]}}}for(r in e){if(hasOwnProp(e,r)&&!hasOwnProp(t,r)&&isObject(e[r])){n[r]=extend({},n[r])}}return n}function Locale(e){if(e!=null){this.set(e)}}var a;if(Object.keys){a=Object.keys}else{a=function(e){var t,n=[];for(t in e){if(hasOwnProp(e,t)){n.push(t)}}return n}}var s={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(e,t,n){var r=this._calendar[e]||this._calendar["sameElse"];return isFunction(r)?r.call(t,n):r}var f={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];if(t||!n){return t}this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)});return this._longDateFormat[e]}var u="Invalid date";function invalidDate(){return this._invalidDate}var h="%d";var l=/\d{1,2}/;function ordinal(e){return this._ordinal.replace("%d",e)}var c={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(e,t,n,r){var i=this._relativeTime[n];return isFunction(i)?i(e,t,n,r):i.replace(/%d/i,e)}function pastFuture(e,t){var n=this._relativeTime[e>0?"future":"past"];return isFunction(n)?n(t):n.replace(/%s/i,t)}var d={};function addUnitAlias(e,t){var n=e.toLowerCase();d[n]=d[n+"s"]=d[t]=e}function normalizeUnits(e){return typeof e==="string"?d[e]||d[e.toLowerCase()]:undefined}function normalizeObjectUnits(e){var t={},n,r;for(r in e){if(hasOwnProp(e,r)){n=normalizeUnits(r);if(n){t[n]=e[r]}}}return t}var g={};function addUnitPriority(e,t){g[e]=t}function getPrioritizedUnits(e){var t=[];for(var n in e){t.push({unit:n,priority:g[n]})}t.sort(function(e,t){return e.priority-t.priority});return t}function zeroFill(e,t,n){var r=""+Math.abs(e),i=t-r.length,o=e>=0;return(o?n?"+":"":"-")+Math.pow(10,Math.max(0,i)).toString().substr(1)+r}var v=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var y=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var P={};var m={};function addFormatToken(e,t,n,r){var i=r;if(typeof r==="string"){i=function(){return this[r]()}}if(e){m[e]=i}if(t){m[t[0]]=function(){return zeroFill(i.apply(this,arguments),t[1],t[2])}}if(n){m[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)}}}function removeFormattingTokens(e){if(e.match(/\[[\s\S]/)){return e.replace(/^\[|\]$/g,"")}return e.replace(/\\/g,"")}function makeFormatFunction(e){var t=e.match(v),n,r;for(n=0,r=t.length;n<r;n++){if(m[t[n]]){t[n]=m[t[n]]}else{t[n]=removeFormattingTokens(t[n])}}return function(n){var i="",o;for(o=0;o<r;o++){i+=isFunction(t[o])?t[o].call(n,e):t[o]}return i}}function formatMoment(e,t){if(!e.isValid()){return e.localeData().invalidDate()}t=expandFormat(t,e.localeData());P[t]=P[t]||makeFormatFunction(t);return P[t](e)}function expandFormat(e,t){var n=5;function replaceLongDateFormatTokens(e){return t.longDateFormat(e)||e}y.lastIndex=0;while(n>=0&&y.test(e)){e=e.replace(y,replaceLongDateFormatTokens);y.lastIndex=0;n-=1}return e}var _=/\d/;var E=/\d\d/;var k=/\d{3}/;var T=/\d{4}/;var w=/[+-]?\d{6}/;var O=/\d\d?/;var S=/\d\d\d\d?/;var p=/\d\d\d\d\d\d?/;var D=/\d{1,3}/;var x=/\d{1,4}/;var M=/[+-]?\d{1,6}/;var F=/\d+/;var I=/[+-]?\d+/;var R=/Z|[+-]\d\d:?\d\d/gi;var b=/Z|[+-]\d\d(?::?\d\d)?/gi;var A=/[+-]?\d+(\.\d{1,3})?/;var Y=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var N={};function addRegexToken(e,t,n){N[e]=isFunction(t)?t:function(e,r){return e&&n?n:t}}function getParseRegexForToken(e,t){if(!hasOwnProp(N,e)){return new RegExp(unescapeFormat(e))}return N[e](t._strict,t._locale)}function unescapeFormat(e){return regexEscape(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,r,i){return t||n||r||i}))}function regexEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var W={};function addParseToken(e,t){var n,r=t;if(typeof e==="string"){e=[e]}if(isNumber(t)){r=function(e,n){n[t]=toInt(e)}}for(n=0;n<e.length;n++){W[e[n]]=r}}function addWeekParseToken(e,t){addParseToken(e,function(e,n,r,i){r._w=r._w||{};t(e,r._w,r,i)})}function addTimeToArrayFromToken(e,t,n){if(t!=null&&hasOwnProp(W,e)){W[e](t,n._a,n,e)}}var C=0;var U=1;var L=2;var $=3;var V=4;var H=5;var G=6;var z=7;var q=8;addFormatToken("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e});addFormatToken(0,["YY",2],0,function(){return this.year()%100});addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",I);addRegexToken("YY",O,E);addRegexToken("YYYY",x,T);addRegexToken("YYYYY",M,w);addRegexToken("YYYYYY",M,w);addParseToken(["YYYYY","YYYYYY"],C);addParseToken("YYYY",function(e,t){t[C]=e.length===2?hooks.parseTwoDigitYear(e):toInt(e)});addParseToken("YY",function(e,t){t[C]=hooks.parseTwoDigitYear(e)});addParseToken("Y",function(e,t){t[C]=parseInt(e,10)});function daysInYear(e){return isLeapYear(e)?366:365}function isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}hooks.parseTwoDigitYear=function(e){return toInt(e)+(toInt(e)>68?1900:2e3)};var j=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function makeGetSet(e,t){return function(n){if(n!=null){set$1(this,e,n);hooks.updateOffset(this,t);return this}else{return get(this,e)}}}function get(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function set$1(e,t,n){if(e.isValid()&&!isNaN(n)){if(t==="FullYear"&&isLeapYear(e.year())&&e.month()===1&&e.date()===29){e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),daysInMonth(n,e.month()))}else{e._d["set"+(e._isUTC?"UTC":"")+t](n)}}}function stringGet(e){e=normalizeUnits(e);if(isFunction(this[e])){return this[e]()}return this}function stringSet(e,t){if(typeof e==="object"){e=normalizeObjectUnits(e);var n=getPrioritizedUnits(e);for(var r=0;r<n.length;r++){this[n[r].unit](e[n[r].unit])}}else{e=normalizeUnits(e);if(isFunction(this[e])){return this[e](t)}}return this}function mod(e,t){return(e%t+t)%t}var Z;if(Array.prototype.indexOf){Z=Array.prototype.indexOf}else{Z=function(e){var t;for(t=0;t<this.length;++t){if(this[t]===e){return t}}return-1}}function daysInMonth(e,t){if(isNaN(e)||isNaN(t)){return NaN}var n=mod(t,12);e+=(t-n)/12;return n===1?isLeapYear(e)?29:28:31-n%7%2}addFormatToken("M",["MM",2],"Mo",function(){return this.month()+1});addFormatToken("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)});addFormatToken("MMMM",0,0,function(e){return this.localeData().months(this,e)});addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",O);addRegexToken("MM",O,E);addRegexToken("MMM",function(e,t){return t.monthsShortRegex(e)});addRegexToken("MMMM",function(e,t){return t.monthsRegex(e)});addParseToken(["M","MM"],function(e,t){t[U]=toInt(e)-1});addParseToken(["MMM","MMMM"],function(e,t,n,r){var i=n._locale.monthsParse(e,r,n._strict);if(i!=null){t[U]=i}else{getParsingFlags(n).invalidMonth=e}});var Q=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var B="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(e,t){if(!e){return isArray(this._months)?this._months:this._months["standalone"]}return isArray(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Q).test(t)?"format":"standalone"][e.month()]}var X="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(e,t){if(!e){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"]}return isArray(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Q.test(t)?"format":"standalone"][e.month()]}function handleStrictParse(e,t,n){var r,i,o,a=e.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(r=0;r<12;++r){o=createUTC([2e3,r]);this._shortMonthsParse[r]=this.monthsShort(o,"").toLocaleLowerCase();this._longMonthsParse[r]=this.months(o,"").toLocaleLowerCase()}}if(n){if(t==="MMM"){i=Z.call(this._shortMonthsParse,a);return i!==-1?i:null}else{i=Z.call(this._longMonthsParse,a);return i!==-1?i:null}}else{if(t==="MMM"){i=Z.call(this._shortMonthsParse,a);if(i!==-1){return i}i=Z.call(this._longMonthsParse,a);return i!==-1?i:null}else{i=Z.call(this._longMonthsParse,a);if(i!==-1){return i}i=Z.call(this._shortMonthsParse,a);return i!==-1?i:null}}}function localeMonthsParse(e,t,n){var r,i,o;if(this._monthsParseExact){return handleStrictParse.call(this,e,t,n)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(r=0;r<12;r++){i=createUTC([2e3,r]);if(n&&!this._longMonthsParse[r]){this._longMonthsParse[r]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i");this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")}if(!n&&!this._monthsParse[r]){o="^"+this.months(i,"")+"|^"+this.monthsShort(i,"");this._monthsParse[r]=new RegExp(o.replace(".",""),"i")}if(n&&t==="MMMM"&&this._longMonthsParse[r].test(e)){return r}else if(n&&t==="MMM"&&this._shortMonthsParse[r].test(e)){return r}else if(!n&&this._monthsParse[r].test(e)){return r}}}function setMonth(e,t){var n;if(!e.isValid()){return e}if(typeof t==="string"){if(/^\d+$/.test(t)){t=toInt(t)}else{t=e.localeData().monthsParse(t);if(!isNumber(t)){return e}}}n=Math.min(e.date(),daysInMonth(e.year(),t));e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n);return e}function getSetMonth(e){if(e!=null){setMonth(this,e);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var J=Y;function monthsShortRegex(e){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(e){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=J}return this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex}}var K=Y;function monthsRegex(e){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(e){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=K}return this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(e,t){return t.length-e.length}var e=[],t=[],n=[],r,i;for(r=0;r<12;r++){i=createUTC([2e3,r]);e.push(this.monthsShort(i,""));t.push(this.months(i,""));n.push(this.months(i,""));n.push(this.monthsShort(i,""))}e.sort(cmpLenRev);t.sort(cmpLenRev);n.sort(cmpLenRev);for(r=0;r<12;r++){e[r]=regexEscape(e[r]);t[r]=regexEscape(t[r])}for(r=0;r<24;r++){n[r]=regexEscape(n[r])}this._monthsRegex=new RegExp("^("+n.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+e.join("|")+")","i")}function createDate(e,t,n,r,i,o,a){var s;if(e<100&&e>=0){s=new Date(e+400,t,n,r,i,o,a);if(isFinite(s.getFullYear())){s.setFullYear(e)}}else{s=new Date(e,t,n,r,i,o,a)}return s}function createUTCDate(e){var t;if(e<100&&e>=0){var n=Array.prototype.slice.call(arguments);n[0]=e+400;t=new Date(Date.UTC.apply(null,n));if(isFinite(t.getUTCFullYear())){t.setUTCFullYear(e)}}else{t=new Date(Date.UTC.apply(null,arguments))}return t}function firstWeekOffset(e,t,n){var r=7+t-n,i=(7+createUTCDate(e,0,r).getUTCDay()-t)%7;return-i+r-1}function dayOfYearFromWeeks(e,t,n,r,i){var o=(7+n-r)%7,a=firstWeekOffset(e,r,i),s=1+7*(t-1)+o+a,f,u;if(s<=0){f=e-1;u=daysInYear(f)+s}else if(s>daysInYear(e)){f=e+1;u=s-daysInYear(e)}else{f=e;u=s}return{year:f,dayOfYear:u}}function weekOfYear(e,t,n){var r=firstWeekOffset(e.year(),t,n),i=Math.floor((e.dayOfYear()-r-1)/7)+1,o,a;if(i<1){a=e.year()-1;o=i+weeksInYear(a,t,n)}else if(i>weeksInYear(e.year(),t,n)){o=i-weeksInYear(e.year(),t,n);a=e.year()+1}else{a=e.year();o=i}return{week:o,year:a}}function weeksInYear(e,t,n){var r=firstWeekOffset(e,t,n),i=firstWeekOffset(e+1,t,n);return(daysInYear(e)-r+i)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",O);addRegexToken("ww",O,E);addRegexToken("W",O);addRegexToken("WW",O,E);addWeekParseToken(["w","ww","W","WW"],function(e,t,n,r){t[r.substr(0,1)]=toInt(e)});function localeWeek(e){return weekOfYear(e,this._week.dow,this._week.doy).week}var ee={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")}function getSetISOWeek(e){var t=weekOfYear(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)});addFormatToken("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)});addFormatToken("dddd",0,0,function(e){return this.localeData().weekdays(this,e)});addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",O);addRegexToken("e",O);addRegexToken("E",O);addRegexToken("dd",function(e,t){return t.weekdaysMinRegex(e)});addRegexToken("ddd",function(e,t){return t.weekdaysShortRegex(e)});addRegexToken("dddd",function(e,t){return t.weekdaysRegex(e)});addWeekParseToken(["dd","ddd","dddd"],function(e,t,n,r){var i=n._locale.weekdaysParse(e,r,n._strict);if(i!=null){t.d=i}else{getParsingFlags(n).invalidWeekday=e}});addWeekParseToken(["d","e","E"],function(e,t,n,r){t[r]=toInt(e)});function parseWeekday(e,t){if(typeof e!=="string"){return e}if(!isNaN(e)){return parseInt(e,10)}e=t.weekdaysParse(e);if(typeof e==="number"){return e}return null}function parseIsoWeekday(e,t){if(typeof e==="string"){return t.weekdaysParse(e)%7||7}return isNaN(e)?null:e}function shiftWeekdays(e,t){return e.slice(t,7).concat(e.slice(0,t))}var te="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(e,t){var n=isArray(this._weekdays)?this._weekdays:this._weekdays[e&&e!==true&&this._weekdays.isFormat.test(t)?"format":"standalone"];return e===true?shiftWeekdays(n,this._week.dow):e?n[e.day()]:n}var ne="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(e){return e===true?shiftWeekdays(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}var re="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(e){return e===true?shiftWeekdays(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function handleStrictParse$1(e,t,n){var r,i,o,a=e.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(r=0;r<7;++r){o=createUTC([2e3,1]).day(r);this._minWeekdaysParse[r]=this.weekdaysMin(o,"").toLocaleLowerCase();this._shortWeekdaysParse[r]=this.weekdaysShort(o,"").toLocaleLowerCase();this._weekdaysParse[r]=this.weekdays(o,"").toLocaleLowerCase()}}if(n){if(t==="dddd"){i=Z.call(this._weekdaysParse,a);return i!==-1?i:null}else if(t==="ddd"){i=Z.call(this._shortWeekdaysParse,a);return i!==-1?i:null}else{i=Z.call(this._minWeekdaysParse,a);return i!==-1?i:null}}else{if(t==="dddd"){i=Z.call(this._weekdaysParse,a);if(i!==-1){return i}i=Z.call(this._shortWeekdaysParse,a);if(i!==-1){return i}i=Z.call(this._minWeekdaysParse,a);return i!==-1?i:null}else if(t==="ddd"){i=Z.call(this._shortWeekdaysParse,a);if(i!==-1){return i}i=Z.call(this._weekdaysParse,a);if(i!==-1){return i}i=Z.call(this._minWeekdaysParse,a);return i!==-1?i:null}else{i=Z.call(this._minWeekdaysParse,a);if(i!==-1){return i}i=Z.call(this._weekdaysParse,a);if(i!==-1){return i}i=Z.call(this._shortWeekdaysParse,a);return i!==-1?i:null}}}function localeWeekdaysParse(e,t,n){var r,i,o;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,e,t,n)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(r=0;r<7;r++){i=createUTC([2e3,1]).day(r);if(n&&!this._fullWeekdaysParse[r]){this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i");this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i");this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")}if(!this._weekdaysParse[r]){o="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,"");this._weekdaysParse[r]=new RegExp(o.replace(".",""),"i")}if(n&&t==="dddd"&&this._fullWeekdaysParse[r].test(e)){return r}else if(n&&t==="ddd"&&this._shortWeekdaysParse[r].test(e)){return r}else if(n&&t==="dd"&&this._minWeekdaysParse[r].test(e)){return r}else if(!n&&this._weekdaysParse[r].test(e)){return r}}}function getSetDayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){e=parseWeekday(e,this.localeData());return this.add(e-t,"d")}else{return t}}function getSetLocaleDayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")}function getSetISODayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}if(e!=null){var t=parseIsoWeekday(e,this.localeData());return this.day(this.day()%7?t:t-7)}else{return this.day()||7}}var ie=Y;function weekdaysRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=ie}return this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex}}var oe=Y;function weekdaysShortRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=oe}return this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var ae=Y;function weekdaysMinRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=ae}return this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(e,t){return t.length-e.length}var e=[],t=[],n=[],r=[],i,o,a,s,f;for(i=0;i<7;i++){o=createUTC([2e3,1]).day(i);a=this.weekdaysMin(o,"");s=this.weekdaysShort(o,"");f=this.weekdays(o,"");e.push(a);t.push(s);n.push(f);r.push(a);r.push(s);r.push(f)}e.sort(cmpLenRev);t.sort(cmpLenRev);n.sort(cmpLenRev);r.sort(cmpLenRev);for(i=0;i<7;i++){t[i]=regexEscape(t[i]);n[i]=regexEscape(n[i]);r[i]=regexEscape(r[i])}this._weekdaysRegex=new RegExp("^("+r.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+n.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+e.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken("hmmss",0,0,function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken("Hmm",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)});addFormatToken("Hmmss",0,0,function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(e,t){addFormatToken(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(e,t){return t._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",O);addRegexToken("h",O);addRegexToken("k",O);addRegexToken("HH",O,E);addRegexToken("hh",O,E);addRegexToken("kk",O,E);addRegexToken("hmm",S);addRegexToken("hmmss",p);addRegexToken("Hmm",S);addRegexToken("Hmmss",p);addParseToken(["H","HH"],$);addParseToken(["k","kk"],function(e,t,n){var r=toInt(e);t[$]=r===24?0:r});addParseToken(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e);n._meridiem=e});addParseToken(["h","hh"],function(e,t,n){t[$]=toInt(e);getParsingFlags(n).bigHour=true});addParseToken("hmm",function(e,t,n){var r=e.length-2;t[$]=toInt(e.substr(0,r));t[V]=toInt(e.substr(r));getParsingFlags(n).bigHour=true});addParseToken("hmmss",function(e,t,n){var r=e.length-4;var i=e.length-2;t[$]=toInt(e.substr(0,r));t[V]=toInt(e.substr(r,2));t[H]=toInt(e.substr(i));getParsingFlags(n).bigHour=true});addParseToken("Hmm",function(e,t,n){var r=e.length-2;t[$]=toInt(e.substr(0,r));t[V]=toInt(e.substr(r))});addParseToken("Hmmss",function(e,t,n){var r=e.length-4;var i=e.length-2;t[$]=toInt(e.substr(0,r));t[V]=toInt(e.substr(r,2));t[H]=toInt(e.substr(i))});function localeIsPM(e){return(e+"").toLowerCase().charAt(0)==="p"}var se=/[ap]\.?m?\.?/i;function localeMeridiem(e,t,n){if(e>11){return n?"pm":"PM"}else{return n?"am":"AM"}}var fe=makeGetSet("Hours",true);var ue={calendar:s,longDateFormat:f,invalidDate:u,ordinal:h,dayOfMonthOrdinalParse:l,relativeTime:c,months:B,monthsShort:X,week:ee,weekdays:te,weekdaysMin:re,weekdaysShort:ne,meridiemParse:se};var he={};var le={};var ce;function normalizeLocale(e){return e?e.toLowerCase().replace("_","-"):e}function chooseLocale(e){var t=0,n,r,i,o;while(t<e.length){o=normalizeLocale(e[t]).split("-");n=o.length;r=normalizeLocale(e[t+1]);r=r?r.split("-"):null;while(n>0){i=loadLocale(o.slice(0,n).join("-"));if(i){return i}if(r&&r.length>=n&&compareArrays(o,r,true)>=n-1){break}n--}t++}return ce}function loadLocale(t){var n=null;if(!he[t]&&"object"!=="undefined"&&e&&e.exports){try{n=ce._abbr;var r=require;r("./locale/"+t);getSetGlobalLocale(n)}catch(e){}}return he[t]}function getSetGlobalLocale(e,t){var n;if(e){if(isUndefined(t)){n=getLocale(e)}else{n=defineLocale(e,t)}if(n){ce=n}else{if(typeof console!=="undefined"&&console.warn){console.warn("Locale "+e+" not found. Did you forget to load it?")}}}return ce._abbr}function defineLocale(e,t){if(t!==null){var n,r=ue;t.abbr=e;if(he[e]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");r=he[e]._config}else if(t.parentLocale!=null){if(he[t.parentLocale]!=null){r=he[t.parentLocale]._config}else{n=loadLocale(t.parentLocale);if(n!=null){r=n._config}else{if(!le[t.parentLocale]){le[t.parentLocale]=[]}le[t.parentLocale].push({name:e,config:t});return null}}}he[e]=new Locale(mergeConfigs(r,t));if(le[e]){le[e].forEach(function(e){defineLocale(e.name,e.config)})}getSetGlobalLocale(e);return he[e]}else{delete he[e];return null}}function updateLocale(e,t){if(t!=null){var n,r,i=ue;r=loadLocale(e);if(r!=null){i=r._config}t=mergeConfigs(i,t);n=new Locale(t);n.parentLocale=he[e];he[e]=n;getSetGlobalLocale(e)}else{if(he[e]!=null){if(he[e].parentLocale!=null){he[e]=he[e].parentLocale}else if(he[e]!=null){delete he[e]}}}return he[e]}function getLocale(e){var t;if(e&&e._locale&&e._locale._abbr){e=e._locale._abbr}if(!e){return ce}if(!isArray(e)){t=loadLocale(e);if(t){return t}e=[e]}return chooseLocale(e)}function listLocales(){return a(he)}function checkOverflow(e){var t;var n=e._a;if(n&&getParsingFlags(e).overflow===-2){t=n[U]<0||n[U]>11?U:n[L]<1||n[L]>daysInMonth(n[C],n[U])?L:n[$]<0||n[$]>24||n[$]===24&&(n[V]!==0||n[H]!==0||n[G]!==0)?$:n[V]<0||n[V]>59?V:n[H]<0||n[H]>59?H:n[G]<0||n[G]>999?G:-1;if(getParsingFlags(e)._overflowDayOfYear&&(t<C||t>L)){t=L}if(getParsingFlags(e)._overflowWeeks&&t===-1){t=z}if(getParsingFlags(e)._overflowWeekday&&t===-1){t=q}getParsingFlags(e).overflow=t}return e}function defaults(e,t,n){if(e!=null){return e}if(t!=null){return t}return n}function currentDateArray(e){var t=new Date(hooks.now());if(e._useUTC){return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]}return[t.getFullYear(),t.getMonth(),t.getDate()]}function configFromArray(e){var t,n,r=[],i,o,a;if(e._d){return}i=currentDateArray(e);if(e._w&&e._a[L]==null&&e._a[U]==null){dayOfYearFromWeekInfo(e)}if(e._dayOfYear!=null){a=defaults(e._a[C],i[C]);if(e._dayOfYear>daysInYear(a)||e._dayOfYear===0){getParsingFlags(e)._overflowDayOfYear=true}n=createUTCDate(a,0,e._dayOfYear);e._a[U]=n.getUTCMonth();e._a[L]=n.getUTCDate()}for(t=0;t<3&&e._a[t]==null;++t){e._a[t]=r[t]=i[t]}for(;t<7;t++){e._a[t]=r[t]=e._a[t]==null?t===2?1:0:e._a[t]}if(e._a[$]===24&&e._a[V]===0&&e._a[H]===0&&e._a[G]===0){e._nextDay=true;e._a[$]=0}e._d=(e._useUTC?createUTCDate:createDate).apply(null,r);o=e._useUTC?e._d.getUTCDay():e._d.getDay();if(e._tzm!=null){e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm)}if(e._nextDay){e._a[$]=24}if(e._w&&typeof e._w.d!=="undefined"&&e._w.d!==o){getParsingFlags(e).weekdayMismatch=true}}function dayOfYearFromWeekInfo(e){var t,n,r,i,o,a,s,f;t=e._w;if(t.GG!=null||t.W!=null||t.E!=null){o=1;a=4;n=defaults(t.GG,e._a[C],weekOfYear(createLocal(),1,4).year);r=defaults(t.W,1);i=defaults(t.E,1);if(i<1||i>7){f=true}}else{o=e._locale._week.dow;a=e._locale._week.doy;var u=weekOfYear(createLocal(),o,a);n=defaults(t.gg,e._a[C],u.year);r=defaults(t.w,u.week);if(t.d!=null){i=t.d;if(i<0||i>6){f=true}}else if(t.e!=null){i=t.e+o;if(t.e<0||t.e>6){f=true}}else{i=o}}if(r<1||r>weeksInYear(n,o,a)){getParsingFlags(e)._overflowWeeks=true}else if(f!=null){getParsingFlags(e)._overflowWeekday=true}else{s=dayOfYearFromWeeks(n,r,i,o,a);e._a[C]=s.year;e._dayOfYear=s.dayOfYear}}var de=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var ge=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var ve=/Z|[+-]\d\d(?::?\d\d)?/;var ye=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var Pe=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var me=/^\/?Date\((\-?\d+)/i;function configFromISO(e){var t,n,r=e._i,i=de.exec(r)||ge.exec(r),o,a,s,f;if(i){getParsingFlags(e).iso=true;for(t=0,n=ye.length;t<n;t++){if(ye[t][1].exec(i[1])){a=ye[t][0];o=ye[t][2]!==false;break}}if(a==null){e._isValid=false;return}if(i[3]){for(t=0,n=Pe.length;t<n;t++){if(Pe[t][1].exec(i[3])){s=(i[2]||" ")+Pe[t][0];break}}if(s==null){e._isValid=false;return}}if(!o&&s!=null){e._isValid=false;return}if(i[4]){if(ve.exec(i[4])){f="Z"}else{e._isValid=false;return}}e._f=a+(s||"")+(f||"");configFromStringAndFormat(e)}else{e._isValid=false}}var _e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(e,t,n,r,i,o){var a=[untruncateYear(e),X.indexOf(t),parseInt(n,10),parseInt(r,10),parseInt(i,10)];if(o){a.push(parseInt(o,10))}return a}function untruncateYear(e){var t=parseInt(e,10);if(t<=49){return 2e3+t}else if(t<=999){return 1900+t}return t}function preprocessRFC2822(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function checkWeekday(e,t,n){if(e){var r=ne.indexOf(e),i=new Date(t[0],t[1],t[2]).getDay();if(r!==i){getParsingFlags(n).weekdayMismatch=true;n._isValid=false;return false}}return true}var Ee={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(e,t,n){if(e){return Ee[e]}else if(t){return 0}else{var r=parseInt(n,10);var i=r%100,o=(r-i)/100;return o*60+i}}function configFromRFC2822(e){var t=_e.exec(preprocessRFC2822(e._i));if(t){var n=extractFromRFC2822Strings(t[4],t[3],t[2],t[5],t[6],t[7]);if(!checkWeekday(t[1],n,e)){return}e._a=n;e._tzm=calculateOffset(t[8],t[9],t[10]);e._d=createUTCDate.apply(null,e._a);e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm);getParsingFlags(e).rfc2822=true}else{e._isValid=false}}function configFromString(e){var t=me.exec(e._i);if(t!==null){e._d=new Date(+t[1]);return}configFromISO(e);if(e._isValid===false){delete e._isValid}else{return}configFromRFC2822(e);if(e._isValid===false){delete e._isValid}else{return}hooks.createFromInputFallback(e)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))});hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(e){if(e._f===hooks.ISO_8601){configFromISO(e);return}if(e._f===hooks.RFC_2822){configFromRFC2822(e);return}e._a=[];getParsingFlags(e).empty=true;var t=""+e._i,n,r,i,o,a,s=t.length,f=0;i=expandFormat(e._f,e._locale).match(v)||[];for(n=0;n<i.length;n++){o=i[n];r=(t.match(getParseRegexForToken(o,e))||[])[0];if(r){a=t.substr(0,t.indexOf(r));if(a.length>0){getParsingFlags(e).unusedInput.push(a)}t=t.slice(t.indexOf(r)+r.length);f+=r.length}if(m[o]){if(r){getParsingFlags(e).empty=false}else{getParsingFlags(e).unusedTokens.push(o)}addTimeToArrayFromToken(o,r,e)}else if(e._strict&&!r){getParsingFlags(e).unusedTokens.push(o)}}getParsingFlags(e).charsLeftOver=s-f;if(t.length>0){getParsingFlags(e).unusedInput.push(t)}if(e._a[$]<=12&&getParsingFlags(e).bigHour===true&&e._a[$]>0){getParsingFlags(e).bigHour=undefined}getParsingFlags(e).parsedDateParts=e._a.slice(0);getParsingFlags(e).meridiem=e._meridiem;e._a[$]=meridiemFixWrap(e._locale,e._a[$],e._meridiem);configFromArray(e);checkOverflow(e)}function meridiemFixWrap(e,t,n){var r;if(n==null){return t}if(e.meridiemHour!=null){return e.meridiemHour(t,n)}else if(e.isPM!=null){r=e.isPM(n);if(r&&t<12){t+=12}if(!r&&t===12){t=0}return t}else{return t}}function configFromStringAndArray(e){var t,n,r,i,o;if(e._f.length===0){getParsingFlags(e).invalidFormat=true;e._d=new Date(NaN);return}for(i=0;i<e._f.length;i++){o=0;t=copyConfig({},e);if(e._useUTC!=null){t._useUTC=e._useUTC}t._f=e._f[i];configFromStringAndFormat(t);if(!isValid(t)){continue}o+=getParsingFlags(t).charsLeftOver;o+=getParsingFlags(t).unusedTokens.length*10;getParsingFlags(t).score=o;if(r==null||o<r){r=o;n=t}}extend(e,n||t)}function configFromObject(e){if(e._d){return}var t=normalizeObjectUnits(e._i);e._a=map([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)});configFromArray(e)}function createFromConfig(e){var t=new Moment(checkOverflow(prepareConfig(e)));if(t._nextDay){t.add(1,"d");t._nextDay=undefined}return t}function prepareConfig(e){var t=e._i,n=e._f;e._locale=e._locale||getLocale(e._l);if(t===null||n===undefined&&t===""){return createInvalid({nullInput:true})}if(typeof t==="string"){e._i=t=e._locale.preparse(t)}if(isMoment(t)){return new Moment(checkOverflow(t))}else if(isDate(t)){e._d=t}else if(isArray(n)){configFromStringAndArray(e)}else if(n){configFromStringAndFormat(e)}else{configFromInput(e)}if(!isValid(e)){e._d=null}return e}function configFromInput(e){var t=e._i;if(isUndefined(t)){e._d=new Date(hooks.now())}else if(isDate(t)){e._d=new Date(t.valueOf())}else if(typeof t==="string"){configFromString(e)}else if(isArray(t)){e._a=map(t.slice(0),function(e){return parseInt(e,10)});configFromArray(e)}else if(isObject(t)){configFromObject(e)}else if(isNumber(t)){e._d=new Date(t)}else{hooks.createFromInputFallback(e)}}function createLocalOrUTC(e,t,n,r,i){var o={};if(n===true||n===false){r=n;n=undefined}if(isObject(e)&&isObjectEmpty(e)||isArray(e)&&e.length===0){e=undefined}o._isAMomentObject=true;o._useUTC=o._isUTC=i;o._l=n;o._i=e;o._f=t;o._strict=r;return createFromConfig(o)}function createLocal(e,t,n,r){return createLocalOrUTC(e,t,n,r,false)}var ke=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=createLocal.apply(null,arguments);if(this.isValid()&&e.isValid()){return e<this?this:e}else{return createInvalid()}});var Te=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=createLocal.apply(null,arguments);if(this.isValid()&&e.isValid()){return e>this?this:e}else{return createInvalid()}});function pickBy(e,t){var n,r;if(t.length===1&&isArray(t[0])){t=t[0]}if(!t.length){return createLocal()}n=t[0];for(r=1;r<t.length;++r){if(!t[r].isValid()||t[r][e](n)){n=t[r]}}return n}function min(){var e=[].slice.call(arguments,0);return pickBy("isBefore",e)}function max(){var e=[].slice.call(arguments,0);return pickBy("isAfter",e)}var we=function(){return Date.now?Date.now():+new Date};var Oe=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(e){for(var t in e){if(!(Z.call(Oe,t)!==-1&&(e[t]==null||!isNaN(e[t])))){return false}}var n=false;for(var r=0;r<Oe.length;++r){if(e[Oe[r]]){if(n){return false}if(parseFloat(e[Oe[r]])!==toInt(e[Oe[r]])){n=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(e){var t=normalizeObjectUnits(e),n=t.year||0,r=t.quarter||0,i=t.month||0,o=t.week||t.isoWeek||0,a=t.day||0,s=t.hour||0,f=t.minute||0,u=t.second||0,h=t.millisecond||0;this._isValid=isDurationValid(t);this._milliseconds=+h+u*1e3+f*6e4+s*1e3*60*60;this._days=+a+o*7;this._months=+i+r*3+n*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(e){return e instanceof Duration}function absRound(e){if(e<0){return Math.round(-1*e)*-1}else{return Math.round(e)}}function offset(e,t){addFormatToken(e,0,0,function(){var e=this.utcOffset();var n="+";if(e<0){e=-e;n="-"}return n+zeroFill(~~(e/60),2)+t+zeroFill(~~e%60,2)})}offset("Z",":");offset("ZZ","");addRegexToken("Z",b);addRegexToken("ZZ",b);addParseToken(["Z","ZZ"],function(e,t,n){n._useUTC=true;n._tzm=offsetFromString(b,e)});var Se=/([\+\-]|\d\d)/gi;function offsetFromString(e,t){var n=(t||"").match(e);if(n===null){return null}var r=n[n.length-1]||[];var i=(r+"").match(Se)||["-",0,0];var o=+(i[1]*60)+toInt(i[2]);return o===0?0:i[0]==="+"?o:-o}function cloneWithOffset(e,t){var n,r;if(t._isUTC){n=t.clone();r=(isMoment(e)||isDate(e)?e.valueOf():createLocal(e).valueOf())-n.valueOf();n._d.setTime(n._d.valueOf()+r);hooks.updateOffset(n,false);return n}else{return createLocal(e).local()}}function getDateOffset(e){return-Math.round(e._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(e,t,n){var r=this._offset||0,i;if(!this.isValid()){return e!=null?this:NaN}if(e!=null){if(typeof e==="string"){e=offsetFromString(b,e);if(e===null){return this}}else if(Math.abs(e)<16&&!n){e=e*60}if(!this._isUTC&&t){i=getDateOffset(this)}this._offset=e;this._isUTC=true;if(i!=null){this.add(i,"m")}if(r!==e){if(!t||this._changeInProgress){addSubtract(this,createDuration(e-r,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?r:getDateOffset(this)}}function getSetZone(e,t){if(e!=null){if(typeof e!=="string"){e=-e}this.utcOffset(e,t);return this}else{return-this.utcOffset()}}function setOffsetToUTC(e){return this.utcOffset(0,e)}function setOffsetToLocal(e){if(this._isUTC){this.utcOffset(0,e);this._isUTC=false;if(e){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==="string"){var e=offsetFromString(R,this._i);if(e!=null){this.utcOffset(e)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(e){if(!this.isValid()){return false}e=e?createLocal(e).utcOffset():0;return(this.utcOffset()-e)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var e={};copyConfig(e,this);e=prepareConfig(e);if(e._a){var t=e._isUTC?createUTC(e._a):createLocal(e._a);this._isDSTShifted=this.isValid()&&compareArrays(e._a,t.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var pe=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var De=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(e,t){var n=e,r=null,i,o,a;if(isDuration(e)){n={ms:e._milliseconds,d:e._days,M:e._months}}else if(isNumber(e)){n={};if(t){n[t]=e}else{n.milliseconds=e}}else if(!!(r=pe.exec(e))){i=r[1]==="-"?-1:1;n={y:0,d:toInt(r[L])*i,h:toInt(r[$])*i,m:toInt(r[V])*i,s:toInt(r[H])*i,ms:toInt(absRound(r[G]*1e3))*i}}else if(!!(r=De.exec(e))){i=r[1]==="-"?-1:1;n={y:parseIso(r[2],i),M:parseIso(r[3],i),w:parseIso(r[4],i),d:parseIso(r[5],i),h:parseIso(r[6],i),m:parseIso(r[7],i),s:parseIso(r[8],i)}}else if(n==null){n={}}else if(typeof n==="object"&&("from"in n||"to"in n)){a=momentsDifference(createLocal(n.from),createLocal(n.to));n={};n.ms=a.milliseconds;n.M=a.months}o=new Duration(n);if(isDuration(e)&&hasOwnProp(e,"_locale")){o._locale=e._locale}return o}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function positiveMomentsDifference(e,t){var n={};n.months=t.month()-e.month()+(t.year()-e.year())*12;if(e.clone().add(n.months,"M").isAfter(t)){--n.months}n.milliseconds=+t-+e.clone().add(n.months,"M");return n}function momentsDifference(e,t){var n;if(!(e.isValid()&&t.isValid())){return{milliseconds:0,months:0}}t=cloneWithOffset(t,e);if(e.isBefore(t)){n=positiveMomentsDifference(e,t)}else{n=positiveMomentsDifference(t,e);n.milliseconds=-n.milliseconds;n.months=-n.months}return n}function createAdder(e,t){return function(n,r){var i,o;if(r!==null&&!isNaN(+r)){deprecateSimple(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");o=n;n=r;r=o}n=typeof n==="string"?+n:n;i=createDuration(n,r);addSubtract(this,i,e);return this}}function addSubtract(e,t,n,r){var i=t._milliseconds,o=absRound(t._days),a=absRound(t._months);if(!e.isValid()){return}r=r==null?true:r;if(a){setMonth(e,get(e,"Month")+a*n)}if(o){set$1(e,"Date",get(e,"Date")+o*n)}if(i){e._d.setTime(e._d.valueOf()+i*n)}if(r){hooks.updateOffset(e,o||a)}}var xe=createAdder(1,"add");var Me=createAdder(-1,"subtract");function getCalendarFormat(e,t){var n=e.diff(t,"days",true);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"}function calendar$1(e,t){var n=e||createLocal(),r=cloneWithOffset(n,this).startOf("day"),i=hooks.calendarFormat(this,r)||"sameElse";var o=t&&(isFunction(t[i])?t[i].call(this,n):t[i]);return this.format(o||this.localeData().calendar(i,this,createLocal(n)))}function clone(){return new Moment(this)}function isAfter(e,t){var n=isMoment(e)?e:createLocal(e);if(!(this.isValid()&&n.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()>n.valueOf()}else{return n.valueOf()<this.clone().startOf(t).valueOf()}}function isBefore(e,t){var n=isMoment(e)?e:createLocal(e);if(!(this.isValid()&&n.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()<n.valueOf()}else{return this.clone().endOf(t).valueOf()<n.valueOf()}}function isBetween(e,t,n,r){var i=isMoment(e)?e:createLocal(e),o=isMoment(t)?t:createLocal(t);if(!(this.isValid()&&i.isValid()&&o.isValid())){return false}r=r||"()";return(r[0]==="("?this.isAfter(i,n):!this.isBefore(i,n))&&(r[1]===")"?this.isBefore(o,n):!this.isAfter(o,n))}function isSame(e,t){var n=isMoment(e)?e:createLocal(e),r;if(!(this.isValid()&&n.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()===n.valueOf()}else{r=n.valueOf();return this.clone().startOf(t).valueOf()<=r&&r<=this.clone().endOf(t).valueOf()}}function isSameOrAfter(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function isSameOrBefore(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function diff(e,t,n){var r,i,o;if(!this.isValid()){return NaN}r=cloneWithOffset(e,this);if(!r.isValid()){return NaN}i=(r.utcOffset()-this.utcOffset())*6e4;t=normalizeUnits(t);switch(t){case"year":o=monthDiff(this,r)/12;break;case"month":o=monthDiff(this,r);break;case"quarter":o=monthDiff(this,r)/3;break;case"second":o=(this-r)/1e3;break;case"minute":o=(this-r)/6e4;break;case"hour":o=(this-r)/36e5;break;case"day":o=(this-r-i)/864e5;break;case"week":o=(this-r-i)/6048e5;break;default:o=this-r}return n?o:absFloor(o)}function monthDiff(e,t){var n=(t.year()-e.year())*12+(t.month()-e.month()),r=e.clone().add(n,"months"),i,o;if(t-r<0){i=e.clone().add(n-1,"months");o=(t-r)/(r-i)}else{i=e.clone().add(n+1,"months");o=(t-r)/(i-r)}return-(n+o)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(e){if(!this.isValid()){return null}var t=e!==true;var n=t?this.clone().utc():this;if(n.year()<0||n.year()>9999){return formatMoment(n,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ")}if(isFunction(Date.prototype.toISOString)){if(t){return this.toDate().toISOString()}else{return new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",formatMoment(n,"Z"))}}return formatMoment(n,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var e="moment";var t="";if(!this.isLocal()){e=this.utcOffset()===0?"moment.utc":"moment.parseZone";t="Z"}var n="["+e+'("]';var r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var i="-MM-DD[T]HH:mm:ss.SSS";var o=t+'[")]';return this.format(n+r+i+o)}function format(e){if(!e){e=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var t=formatMoment(this,e);return this.localeData().postformat(t)}function from(e,t){if(this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())){return createDuration({to:this,from:e}).locale(this.locale()).humanize(!t)}else{return this.localeData().invalidDate()}}function fromNow(e){return this.from(createLocal(),e)}function to(e,t){if(this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())){return createDuration({from:this,to:e}).locale(this.locale()).humanize(!t)}else{return this.localeData().invalidDate()}}function toNow(e){return this.to(createLocal(),e)}function locale(e){var t;if(e===undefined){return this._locale._abbr}else{t=getLocale(e);if(t!=null){this._locale=t}return this}}var Fe=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){if(e===undefined){return this.localeData()}else{return this.locale(e)}});function localeData(){return this._locale}var Ie=1e3;var Re=60*Ie;var be=60*Re;var Ae=(365*400+97)*24*be;function mod$1(e,t){return(e%t+t)%t}function localStartOfDate(e,t,n){if(e<100&&e>=0){return new Date(e+400,t,n)-Ae}else{return new Date(e,t,n).valueOf()}}function utcStartOfDate(e,t,n){if(e<100&&e>=0){return Date.UTC(e+400,t,n)-Ae}else{return Date.UTC(e,t,n)}}function startOf(e){var t;e=normalizeUnits(e);if(e===undefined||e==="millisecond"||!this.isValid()){return this}var n=this._isUTC?utcStartOfDate:localStartOfDate;switch(e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf();t-=mod$1(t+(this._isUTC?0:this.utcOffset()*Re),be);break;case"minute":t=this._d.valueOf();t-=mod$1(t,Re);break;case"second":t=this._d.valueOf();t-=mod$1(t,Ie);break}this._d.setTime(t);hooks.updateOffset(this,true);return this}function endOf(e){var t;e=normalizeUnits(e);if(e===undefined||e==="millisecond"||!this.isValid()){return this}var n=this._isUTC?utcStartOfDate:localStartOfDate;switch(e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf();t+=be-mod$1(t+(this._isUTC?0:this.utcOffset()*Re),be)-1;break;case"minute":t=this._d.valueOf();t+=Re-mod$1(t,Re)-1;break;case"second":t=this._d.valueOf();t+=Ie-mod$1(t,Ie)-1;break}this._d.setTime(t);hooks.updateOffset(this,true);return this}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function toObject(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,function(){return this.weekYear()%100});addFormatToken(0,["GG",2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(e,t){addFormatToken(0,[e,e.length],0,t)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",I);addRegexToken("g",I);addRegexToken("GG",O,E);addRegexToken("gg",O,E);addRegexToken("GGGG",x,T);addRegexToken("gggg",x,T);addRegexToken("GGGGG",M,w);addRegexToken("ggggg",M,w);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,r){t[r.substr(0,2)]=toInt(e)});addWeekParseToken(["gg","GG"],function(e,t,n,r){t[r]=hooks.parseTwoDigitYear(e)});function getSetWeekYear(e){return getSetWeekYearHelper.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(e){return getSetWeekYearHelper.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var e=this.localeData()._week;return weeksInYear(this.year(),e.dow,e.doy)}function getSetWeekYearHelper(e,t,n,r,i){var o;if(e==null){return weekOfYear(this,r,i).year}else{o=weeksInYear(e,r,i);if(t>o){t=o}return setWeekAll.call(this,e,t,n,r,i)}}function setWeekAll(e,t,n,r,i){var o=dayOfYearFromWeeks(e,t,n,r,i),a=createUTCDate(o.year,0,o.dayOfYear);this.year(a.getUTCFullYear());this.month(a.getUTCMonth());this.date(a.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",_);addParseToken("Q",function(e,t){t[U]=(toInt(e)-1)*3});function getSetQuarter(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",O);addRegexToken("DD",O,E);addRegexToken("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient});addParseToken(["D","DD"],L);addParseToken("Do",function(e,t){t[L]=toInt(e.match(O)[0])});var Ye=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",D);addRegexToken("DDDD",k);addParseToken(["DDD","DDDD"],function(e,t,n){n._dayOfYear=toInt(e)});function getSetDayOfYear(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return e==null?t:this.add(e-t,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",O);addRegexToken("mm",O,E);addParseToken(["m","mm"],V);var Ne=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",O);addRegexToken("ss",O,E);addParseToken(["s","ss"],H);var We=makeGetSet("Seconds",false);addFormatToken("S",0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,["SS",2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,function(){return this.millisecond()*10});addFormatToken(0,["SSSSS",5],0,function(){return this.millisecond()*100});addFormatToken(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3});addFormatToken(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4});addFormatToken(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5});addFormatToken(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6});addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",D,_);addRegexToken("SS",D,E);addRegexToken("SSS",D,k);var Ce;for(Ce="SSSS";Ce.length<=9;Ce+="S"){addRegexToken(Ce,F)}function parseMs(e,t){t[G]=toInt(("0."+e)*1e3)}for(Ce="S";Ce.length<=9;Ce+="S"){addParseToken(Ce,parseMs)}var Ue=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var Le=Moment.prototype;Le.add=xe;Le.calendar=calendar$1;Le.clone=clone;Le.diff=diff;Le.endOf=endOf;Le.format=format;Le.from=from;Le.fromNow=fromNow;Le.to=to;Le.toNow=toNow;Le.get=stringGet;Le.invalidAt=invalidAt;Le.isAfter=isAfter;Le.isBefore=isBefore;Le.isBetween=isBetween;Le.isSame=isSame;Le.isSameOrAfter=isSameOrAfter;Le.isSameOrBefore=isSameOrBefore;Le.isValid=isValid$2;Le.lang=Fe;Le.locale=locale;Le.localeData=localeData;Le.max=Te;Le.min=ke;Le.parsingFlags=parsingFlags;Le.set=stringSet;Le.startOf=startOf;Le.subtract=Me;Le.toArray=toArray;Le.toObject=toObject;Le.toDate=toDate;Le.toISOString=toISOString;Le.inspect=inspect;Le.toJSON=toJSON;Le.toString=toString;Le.unix=unix;Le.valueOf=valueOf;Le.creationData=creationData;Le.year=j;Le.isLeapYear=getIsLeapYear;Le.weekYear=getSetWeekYear;Le.isoWeekYear=getSetISOWeekYear;Le.quarter=Le.quarters=getSetQuarter;Le.month=getSetMonth;Le.daysInMonth=getDaysInMonth;Le.week=Le.weeks=getSetWeek;Le.isoWeek=Le.isoWeeks=getSetISOWeek;Le.weeksInYear=getWeeksInYear;Le.isoWeeksInYear=getISOWeeksInYear;Le.date=Ye;Le.day=Le.days=getSetDayOfWeek;Le.weekday=getSetLocaleDayOfWeek;Le.isoWeekday=getSetISODayOfWeek;Le.dayOfYear=getSetDayOfYear;Le.hour=Le.hours=fe;Le.minute=Le.minutes=Ne;Le.second=Le.seconds=We;Le.millisecond=Le.milliseconds=Ue;Le.utcOffset=getSetOffset;Le.utc=setOffsetToUTC;Le.local=setOffsetToLocal;Le.parseZone=setOffsetToParsedOffset;Le.hasAlignedHourOffset=hasAlignedHourOffset;Le.isDST=isDaylightSavingTime;Le.isLocal=isLocal;Le.isUtcOffset=isUtcOffset;Le.isUtc=isUtc;Le.isUTC=isUtc;Le.zoneAbbr=getZoneAbbr;Le.zoneName=getZoneName;Le.dates=deprecate("dates accessor is deprecated. Use date instead.",Ye);Le.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);Le.years=deprecate("years accessor is deprecated. Use year instead",j);Le.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);Le.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(e){return createLocal(e*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(e){return e}var $e=Locale.prototype;$e.calendar=calendar;$e.longDateFormat=longDateFormat;$e.invalidDate=invalidDate;$e.ordinal=ordinal;$e.preparse=preParsePostFormat;$e.postformat=preParsePostFormat;$e.relativeTime=relativeTime;$e.pastFuture=pastFuture;$e.set=set;$e.months=localeMonths;$e.monthsShort=localeMonthsShort;$e.monthsParse=localeMonthsParse;$e.monthsRegex=monthsRegex;$e.monthsShortRegex=monthsShortRegex;$e.week=localeWeek;$e.firstDayOfYear=localeFirstDayOfYear;$e.firstDayOfWeek=localeFirstDayOfWeek;$e.weekdays=localeWeekdays;$e.weekdaysMin=localeWeekdaysMin;$e.weekdaysShort=localeWeekdaysShort;$e.weekdaysParse=localeWeekdaysParse;$e.weekdaysRegex=weekdaysRegex;$e.weekdaysShortRegex=weekdaysShortRegex;$e.weekdaysMinRegex=weekdaysMinRegex;$e.isPM=localeIsPM;$e.meridiem=localeMeridiem;function get$1(e,t,n,r){var i=getLocale();var o=createUTC().set(r,t);return i[n](o,e)}function listMonthsImpl(e,t,n){if(isNumber(e)){t=e;e=undefined}e=e||"";if(t!=null){return get$1(e,t,n,"month")}var r;var i=[];for(r=0;r<12;r++){i[r]=get$1(e,r,n,"month")}return i}function listWeekdaysImpl(e,t,n,r){if(typeof e==="boolean"){if(isNumber(t)){n=t;t=undefined}t=t||""}else{t=e;n=t;e=false;if(isNumber(t)){n=t;t=undefined}t=t||""}var i=getLocale(),o=e?i._week.dow:0;if(n!=null){return get$1(t,(n+o)%7,r,"day")}var a;var s=[];for(a=0;a<7;a++){s[a]=get$1(t,(a+o)%7,r,"day")}return s}function listMonths(e,t){return listMonthsImpl(e,t,"months")}function listMonthsShort(e,t){return listMonthsImpl(e,t,"monthsShort")}function listWeekdays(e,t,n){return listWeekdaysImpl(e,t,n,"weekdays")}function listWeekdaysShort(e,t,n){return listWeekdaysImpl(e,t,n,"weekdaysShort")}function listWeekdaysMin(e,t,n){return listWeekdaysImpl(e,t,n,"weekdaysMin")}getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=toInt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var Ve=Math.abs;function abs(){var e=this._data;this._milliseconds=Ve(this._milliseconds);this._days=Ve(this._days);this._months=Ve(this._months);e.milliseconds=Ve(e.milliseconds);e.seconds=Ve(e.seconds);e.minutes=Ve(e.minutes);e.hours=Ve(e.hours);e.months=Ve(e.months);e.years=Ve(e.years);return this}function addSubtract$1(e,t,n,r){var i=createDuration(t,n);e._milliseconds+=r*i._milliseconds;e._days+=r*i._days;e._months+=r*i._months;return e._bubble()}function add$1(e,t){return addSubtract$1(this,e,t,1)}function subtract$1(e,t){return addSubtract$1(this,e,t,-1)}function absCeil(e){if(e<0){return Math.floor(e)}else{return Math.ceil(e)}}function bubble(){var e=this._milliseconds;var t=this._days;var n=this._months;var r=this._data;var i,o,a,s,f;if(!(e>=0&&t>=0&&n>=0||e<=0&&t<=0&&n<=0)){e+=absCeil(monthsToDays(n)+t)*864e5;t=0;n=0}r.milliseconds=e%1e3;i=absFloor(e/1e3);r.seconds=i%60;o=absFloor(i/60);r.minutes=o%60;a=absFloor(o/60);r.hours=a%24;t+=absFloor(a/24);f=absFloor(daysToMonths(t));n+=f;t-=absCeil(monthsToDays(f));s=absFloor(n/12);n%=12;r.days=t;r.months=n;r.years=s;return this}function daysToMonths(e){return e*4800/146097}function monthsToDays(e){return e*146097/4800}function as(e){if(!this.isValid()){return NaN}var t;var n;var r=this._milliseconds;e=normalizeUnits(e);if(e==="month"||e==="quarter"||e==="year"){t=this._days+r/864e5;n=this._months+daysToMonths(t);switch(e){case"month":return n;case"quarter":return n/3;case"year":return n/12}}else{t=this._days+Math.round(monthsToDays(this._months));switch(e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return t*24+r/36e5;case"minute":return t*1440+r/6e4;case"second":return t*86400+r/1e3;case"millisecond":return Math.floor(t*864e5)+r;default:throw new Error("Unknown unit "+e)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(e){return function(){return this.as(e)}}var He=makeAs("ms");var Ge=makeAs("s");var ze=makeAs("m");var qe=makeAs("h");var je=makeAs("d");var Ze=makeAs("w");var Qe=makeAs("M");var Be=makeAs("Q");var Xe=makeAs("y");function clone$1(){return createDuration(this)}function get$2(e){e=normalizeUnits(e);return this.isValid()?this[e+"s"]():NaN}function makeGetter(e){return function(){return this.isValid()?this._data[e]:NaN}}var Je=makeGetter("milliseconds");var Ke=makeGetter("seconds");var et=makeGetter("minutes");var tt=makeGetter("hours");var nt=makeGetter("days");var rt=makeGetter("months");var it=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var ot=Math.round;var at={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function relativeTime$1(e,t,n){var r=createDuration(e).abs();var i=ot(r.as("s"));var o=ot(r.as("m"));var a=ot(r.as("h"));var s=ot(r.as("d"));var f=ot(r.as("M"));var u=ot(r.as("y"));var h=i<=at.ss&&["s",i]||i<at.s&&["ss",i]||o<=1&&["m"]||o<at.m&&["mm",o]||a<=1&&["h"]||a<at.h&&["hh",a]||s<=1&&["d"]||s<at.d&&["dd",s]||f<=1&&["M"]||f<at.M&&["MM",f]||u<=1&&["y"]||["yy",u];h[2]=t;h[3]=+e>0;h[4]=n;return substituteTimeAgo.apply(null,h)}function getSetRelativeTimeRounding(e){if(e===undefined){return ot}if(typeof e==="function"){ot=e;return true}return false}function getSetRelativeTimeThreshold(e,t){if(at[e]===undefined){return false}if(t===undefined){return at[e]}at[e]=t;if(e==="s"){at.ss=t-1}return true}function humanize(e){if(!this.isValid()){return this.localeData().invalidDate()}var t=this.localeData();var n=relativeTime$1(this,!e,t);if(e){n=t.pastFuture(+this,n)}return t.postformat(n)}var st=Math.abs;function sign(e){return(e>0)-(e<0)||+e}function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var e=st(this._milliseconds)/1e3;var t=st(this._days);var n=st(this._months);var r,i,o;r=absFloor(e/60);i=absFloor(r/60);e%=60;r%=60;o=absFloor(n/12);n%=12;var a=o;var s=n;var f=t;var u=i;var h=r;var l=e?e.toFixed(3).replace(/\.?0+$/,""):"";var c=this.asSeconds();if(!c){return"P0D"}var d=c<0?"-":"";var g=sign(this._months)!==sign(c)?"-":"";var v=sign(this._days)!==sign(c)?"-":"";var y=sign(this._milliseconds)!==sign(c)?"-":"";return d+"P"+(a?g+a+"Y":"")+(s?g+s+"M":"")+(f?v+f+"D":"")+(u||h||l?"T":"")+(u?y+u+"H":"")+(h?y+h+"M":"")+(l?y+l+"S":"")}var ft=Duration.prototype;ft.isValid=isValid$1;ft.abs=abs;ft.add=add$1;ft.subtract=subtract$1;ft.as=as;ft.asMilliseconds=He;ft.asSeconds=Ge;ft.asMinutes=ze;ft.asHours=qe;ft.asDays=je;ft.asWeeks=Ze;ft.asMonths=Qe;ft.asQuarters=Be;ft.asYears=Xe;ft.valueOf=valueOf$1;ft._bubble=bubble;ft.clone=clone$1;ft.get=get$2;ft.milliseconds=Je;ft.seconds=Ke;ft.minutes=et;ft.hours=tt;ft.days=nt;ft.weeks=weeks;ft.months=rt;ft.years=it;ft.humanize=humanize;ft.toISOString=toISOString$1;ft.toString=toISOString$1;ft.toJSON=toISOString$1;ft.locale=locale;ft.localeData=localeData;ft.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);ft.lang=Fe;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",I);addRegexToken("X",A);addParseToken("X",function(e,t,n){n._d=new Date(parseFloat(e,10)*1e3)});addParseToken("x",function(e,t,n){n._d=new Date(toInt(e))});hooks.version="2.24.0";setHookCallback(createLocal);hooks.fn=Le;hooks.min=min;hooks.max=max;hooks.now=we;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=Le;hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};return hooks})},798:function(e,t,n){"use strict";var r=n(720);var i=n(1);var o=n(269);var a=n(0)||0;function seed(t){r.seed(t);return e.exports}function worker(t){a=t;return e.exports}function characters(e){if(e!==undefined){r.characters(e)}return r.shuffled()}function generate(){return i(a)}e.exports=generate;e.exports.generate=generate;e.exports.seed=seed;e.exports.worker=worker;e.exports.characters=characters;e.exports.isValid=o},808:function(e,t,n){"use strict";var r=n(720);var i=n(755);var o=n(279);function generate(e){var t=0;var n;var a="";while(!n){a=a+o(i,r.get(),1);n=e<Math.pow(16,t+1);t++}return a}e.exports=generate},843:function(e,t,n){var r=n(2);var i=n(797);var o=n(373);var a=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{PropertyRefParser:function(t,n,r,i){var a=t.getProperties();try{propertyToReturn=a[n]}catch(e){}if(!propertyToReturn)throw new o.PropertyNotFoundException(n);if(!propertyToReturn.type=="objectRef")throw new o.PropertyNotFoundException(n);return e.getObjectByIdSyn(propertyToReturn.value)},EventParser:function(e,t){var n;function getValue(e,t){if(typeof t=="string"){t=t.split(".")}if(t.length>1){getValue(e.events[t.shift()],t)}else{try{var r=e.events[t[0]].type}catch(e){throw new o.NoSuchEventException(propertyName)}n=e.events[t[0]]}}getValue(e,t);return n},PropertyBagItemQueryRemover:function(e,t){function removeQuery(e,n){if(typeof n=="string"){n=n.split(".")}if(n.length>1){removeQuery(e[n.shift()],n)}else{if(!e.hasOwnProperty(n[0]))throw new o.NoSuchPropertyException(t);if(!e[n[0]].query)throw new o.NoSuchPermissionException(permissionKey);delete e[n[0]].query;return}}removeQuery(e,t)},PropertyBagItemConditionsRemover:function(e,t){function removeConditions(e,n){if(typeof n=="string"){n=n.split(".")}if(n.length>1){removeConditions(e[n.shift()],n)}else{if(!e.hasOwnProperty(n[0]))throw new o.NoSuchPropertyException(t);if(!e[n[0]].conditions)throw new o.NoSuchPermissionException(permissionKey);delete e[n[0]].conditions;return}}removeConditions(e,t)},PropertyBagItemOnChangeRemover:function(e,t,n){function removeOnChange(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeOnChange(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new o.NoSuchPropertyException(t);if(!e[r[0]].onChange[n])throw new o.HandlerNotFoundException(n);delete e[r[0]].onChange[n];return}}removeOnChange(e,t)},PropertyBagItemMetaRemover:function(e,t){var n=this;var r;function removeOnChange(e,n){if(typeof n=="string"){n=n.split(".")}if(n.length>1){removeOnChange(e[n.shift()],n)}else{if(!e.hasOwnProperty(n[0]))throw new o.NoSuchPropertyException(t);if(!e[n[0]].meta)throw new o.NoSuchPermissionException(permissionKey);delete e[n[0]].meta;return}}removeOnChange(e,t)},PropertyBagItemOnCreateRemover:function(e,t,n){function removeOnCreate(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeOnCreate(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new o.NoSuchPropertyException(t);if(!e[r[0]].onCreate)throw new o.HandlerNotFoundException;if(!e[r[0]].onCreate[n])throw new o.HandlerNotFoundException;delete e[r[0]].onCreate[n];return}}removeOnCreate(e,t)},PropertyBagItemOnDeleteRemover:function(e,t,n){function removeOnDelete(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeOnDelete(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new o.NoSuchPropertyException(t);if(!e[r[0]].onDelete[n])throw new o.HandlerNotFoundException(n);delete e[r[0]].onDelete[n];return}}removeOnDelete(e,t)},PropertyBagItemPermissionRemover:function(t,n,r,i){function removePermission(t,a){if(typeof a=="string"){a=a.split(".")}if(a.length>1){removePermission(t[a.shift()],a)}else{if(!t.hasOwnProperty(a[0]))throw new o.NoSuchPropertyException(n);if(!t[a[0]].permissions)throw new o.NoSuchPermissionException(r);if(!t[a[0]].permissions[r])throw new o.NoSuchPermissionException(r);e.chainPermission(t,i,"x","removePropertyPermission",n);delete t[a[0]].permissions[r];return}}removePermission(t,n)},PropertyBagItemRemover:function(t,n,r){function getValue(t,i){if(typeof i=="string"){i=i.split(".")}if(i.length>1){getValue(t[i.shift()],i)}else{if(!t.hasOwnProperty(i[0]))throw new o.NoSuchPropertyException(n);if(t[i[0]].onDelete){if(Object.keys(t[i[0]].onDelete).length>0){if(!r.handlerSequence[t._id])r.handlerSequence[t._id]={};if(!r.handlerSequence[t._id].onDelete)r.handlerSequence[t._id].onDelete=[];r.handlerSequence[t._id].onDelete.push(t[i[0]].onDelete)}}e.chainPermission(t[i[0]],r,"d","removeProperty",n);delete t[i[0]];return}}getValue(t,n)},PropertyParser:function(t,n,r,i){var a=this;var s;function getValue(e,t){var r=e[i.propsObject]||e;if(typeof t=="string"){t=t.split(".")}if(t.length>1){getValue(r[t.shift()],t)}else{if(!r.hasOwnProperty(t[0]))throw new o.NoSuchPropertyException(n);s=r[t[0]]}}getValue(t,n);if(s.type=="action"){s.call=function(n,i){e.checkAuthroisations(t,r.activeUser,"x",r.activeApp);a.execProcessorAction(s.value||s.action,t,s,{},n,i,{})}}return s},ValuePropertyMetaSubstituter:function(e){if(typeof e!=="undefined")if(typeof e.value==="undefined")e.value=null},PropertyCreateWrapper:function(t,n,a,s,f,u){if(f.propsObject&&!t[f.propsObject])t[f.propsObject]={};n=Object.assign({},n);var h=t[f.propsObject]||t;var l=Object.keys(n)[0];var c=null;if(typeof n!=="object"){throw new o.InvalidFormatException}if(u&&h.hasOwnProperty(l)&&!e.predefinedProperties.includes(l))throw new o.DuplicatePropertyException(l);switch((n[l]||{}).type){case undefined:h[l]=n[l];break;case r.PROPERTY.TYPE_SHORTTEXT:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_LONGTEXT:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_INDEXEDTEXT:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_JSON:if(n[l].value){if(typeof n[l].value==="string"){try{h[l].value=JSON.parse(h[l].value)}catch(e){}}else{}}h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_NUMBER:if(n[l].value!=""){if(n[l].value!=null)if(isNaN(n[l].value))throw new o.InvalidValueException(n[l].value,r.PROPERTY.TYPE_NUMBER)}n[l].value=+n[l].value;h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_EVENT:e.chainPermission(t,s,"evt","addProperty (Event)",l);var d={};var g=l;d[g]=n[l];if(!d[g].eventId)d[g].eventId=e.ID();if(!d[g].reminders)d[g].reminders={};if(d[g].interval!==undefined){if(d[g].lastOccurence==undefined)d[g].lastOccurence=null;else if(!i(d[g].lastOccurence).isValid())throw new o.InvalidDateException(d[g].lastOccurence);else d[g].lastOccurence=i(d[g].lastOccurence).utc().format();if(d[g].nextOccurence==undefined)d[g].nextOccurence=i().toISOString();if(d[g].action===undefined)d[g].action="";if(d[g].interval===undefined)throw new o.MissingAttributeException("interval");d[g].nextOccurence=i(d[g].lastOccurence||i().utc()).utc().add(d[g].interval).toISOString();s.eventAlterationSequence.push({operation:"add",obj:t,propName:l,property:n,date:d[g].nextOccurence})}else if(d[g].date!==undefined){if(d[g].date==null)d[g].date=i().utc().toISOString();if(!d[g].date)throw new o.MissingAttributeException("date");try{d[g].date=i(d[g].date).utc().format()}catch(e){}s.eventAlterationSequence.push({operation:"add",obj:t,propName:l,property:n,date:d[g].date});if(!d[g].action)d[g].action=""}else{}h[l]=d[g];break;case r.PROPERTY.TYPE_DATE:if(!n[l].value||n[l].value=="")n[l].value=null;h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_SHORTID:if(!n[l].value||n[l].value=="")n[l].value=e.RANDOM();if(t.role=="template")n[l].value=null;h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_REF_OBJ:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_REF_USR:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_REF_FILE:h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_PROPERTY_BAG:if(!n[l].properties)n[l].properties={};var v=n[l][f.propsObject]||n[l];var y=Object.keys(v);parentProp=n;h[l]=n[l];h[l].type=r.PROPERTY.TYPE_PROPERTY_BAG;h[l].properties={};y.forEach(function(t){tmpProp={};tmpProp[t]=v[t];new e.PropertyCreateWrapper(h[l],Object.assign({},tmpProp),true,s,f)});break;case r.PROPERTY.TYPE_ARRAY:if(!n[l].properties)n[l].properties={};var v=n[l][f.propsObject]||n[l];var y=Object.keys(v);parentProp=n;h[l]={type:r.PROPERTY.TYPE_ARRAY,properties:{},query:n[l].query,meta:n[l].meta};y.forEach(function(t){tmpProp={};tmpProp[t]=v[t];new e.PropertyCreateWrapper(h[l],Object.assign({},tmpProp),true,s,f)});break;case r.PROPERTY.TYPE_BOOLEAN:if(!typeof n[l].value==="boolean")throw new o.InvalidValueException(n[l].value,r.PROPERTY.TYPE_BOOLEAN);h[l]=n[l];e.ValuePropertyMetaSubstituter(h[l]);break;case r.PROPERTY.TYPE_ACTION:e.chainPermission(t,s,"act","addProperty (Action)",l);if(n[l].value){if(typeof n[l].value!=="string")throw new o.InvalidValueException(n[l].value,r.PROPERTY.TYPE_ACTION)}h[l]=n[l];e.ValuePropertyMetaSubstituter(t.properties[l]);break;default:throw new o.InvalidTypeException(n[l].type)}if((n[l]||{}).onCreate){if(Object.keys(n[l].onCreate).length>0){if(!s.handlerSequence[t._id])s.handlerSequence[t._id]={};if(!s.handlerSequence[t._id].onCreate)s.handlerSequence[t._id].onCreate=[];s.handlerSequence[t._id].onCreate.push({handler:n[l].onCreate,prop:n[l]})}}e.chainPermission(t,s,"p","addProperty",l)},PropertyQuerySetWrapper:function(e,t,n,r){function setValue(e,i,a){var s=e[r.propsObject]||e;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setValue(s[i.shift()],i,a)}else{if(!s.hasOwnProperty(i[0]))throw new o.NoSuchPropertyException(t);if(typeof a!=="object")throw new o.InvalidDataTypeException(a,"object");s[i[0]].query=n}}setValue(e,t,n)},PropertyMetaSetWrapper:function(e,t,n,r){function setMeta(e,n,i){var a=e[r.propsObject]||e;if(typeof n=="string"){n=n.split(".")}if(n.length>1){setMeta(a[n.shift()],n,i)}else{if(!a.hasOwnProperty(n[0]))throw new o.NoSuchPropertyException(t);if(a[n[0]].template)a[n[0]].metaOverwritten=true;a[n[0]].meta=i}}setMeta(e,t,n)},PropertyOnChangeSetWrapper:function(t,n,r,i,a,s,f,u){function setOnChange(t,i,h){var l=t[u.propsObject]||t;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setOnChange(l[i.shift()],i,h)}else{if(!l.hasOwnProperty(i[0]))throw new o.NoSuchPropertyException(n);if(!l[i[0]].onChange)l[i[0]].onChange={};if(!l[i[0]].onChange[r])l[i[0]].onChange[r]={};if(l[i[0]].onChange[r].template)l[i[0]].onChange[r].overwritten=true;l[i[0]].onChange[r].value=h;l[i[0]].onChange[r].trigger=a||"after";l[i[0]].onChange[r].type=s||"async";e.chainPermission(l[i[0]],f,"w","setPropertyOnChangeHandler",r)}}setOnChange(t,n,i)},PropertyOnCreateSetWrapper:function(t,n,r,i,a,s,f,u){function setOnCreate(t,i,h){var l=t[u.propsObject]||t;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setOnCreate(l[i.shift()],i,h)}else{if(!l.hasOwnProperty(i[0]))throw new o.NoSuchPropertyException(n);if(!l[i[0]].onCreate)l[i[0]].onCreate={};if(!l[i[0]].onCreate[r])l[i[0]].onCreate[r]={};if(l[i[0]].onCreate[r].templateId)l[i[0]].onCreate[r].overwritten=true;l[i[0]].onCreate[r].value=h;l[i[0]].onCreate[r].trigger=a||"after";l[i[0]].onCreate[r].type=s||"async";e.chainPermission(l[i[0]],f,"v","setPropertyOnCreateHandler",r)}}setOnCreate(t,n,i)},PropertyOnDeleteSetWrapper:function(t,n,r,i,a,s,f,u){function setOnDelete(t,i,h){var l=t[u.propsObject]||t;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setOnDelete(l[i.shift()],i,h)}else{if(!l.hasOwnProperty(i[0]))throw new o.NoSuchPropertyException(n);if(!l[i[0]].onDelete)l[i[0]].onDelete={};if(!l[i[0]].onDelete[r])l[i[0]].onDelete[r]={};if(l[i[0]].onDelete[r].template)l[i[0]].onDelete[r].overwritten=true;l[i[0]].onDelete[r].value=h;l[i[0]].onDelete[r].trigger=a||"after";l[i[0]].onDelete[r].type=s||"async";e.chainPermission(l[i[0]],f,"z","setPropertyOnDeleteHandler",r)}}setOnDelete(t,n,i)},PropertyConditionsSetWrapper:function(e,t,n,r){function setConditions(e,n,i){var a=e[r.propsObject]||e;if(typeof n=="string"){n=n.split(".")}if(n.length>1){setConditions(a[n.shift()],n,i)}else{if(!a.hasOwnProperty(n[0]))throw new o.NoSuchPropertyException(t);a[n[0]].conditions=i}}setConditions(e,t,n)},PropertyPermissionSetWrapper:function(t,n,r,i,a){function setPermission(t,r,s){var f=t[a.propsObject]||t;if(typeof r=="string"){r=r.split(".")}if(r.length>1){setPermission(f[r.shift()],r,s)}else{if(!f.hasOwnProperty(r[0]))throw new o.NoSuchPropertyException(n);var u=Object.keys(s)[0];if(!f[r[0]].permissions)f[r[0]].permissions={};f[r[0]].permissions[u]=s[u];e.chainPermission(f[r[0]],i,"x","setPropertyPermission",n)}}setPermission(t,n,r)},PropertySetWrapper:function(t,n,i,a,s){function setValue(t,f,u){var h=t[s.propsObject]||t;if(typeof f=="string"){f=f.split(".")}if(f.length>1){var l=f.shift();try{if(h[l].type){if(h[l].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(h[l].template)h[l].overwritten=true}if(h[l].type==r.PROPERTY.TYPE_ARRAY){if(h[l].template)h[l].overwritten=true}}}catch(e){}setValue(h[l],f,u)}else{if(!h.hasOwnProperty(f[0]))throw new o.NoSuchPropertyException(n);if(h[f[0]].type=="boolean"){if(typeof i!="boolean")throw new o.InvalidValueException(i,h[f[0]].type)}if(h[f[0]].type=="number"){if(isNaN(i))throw new o.InvalidValueException(i,h[f[0]].type)}if(h[f[0]].template)h[f[0]].overwritten=true;h[f[0]].value=i;if(h[f[0]].onChange){if(Object.keys(h[f[0]].onChange).length>0){if(!a.handlerSequence[h._id])a.handlerSequence[h._id]={};if(!a.handlerSequence[h._id].onChange)a.handlerSequence[h._id].onChange=[];a.handlerSequence[h._id].onChange.push({handler:h[f[0]].onChange,prop:h[f[0]]})}}e.chainPermission(h[f[0]],a,"u","setPropertyValue",n)}}setValue(t,n,i)},PropertySetFullWrapper:function(t,n,i,a,s,f){function setValue(t,s,u){var h=t[f.propsObject]||t;if(typeof s=="string"){s=s.split(".")}if(s.length>1){var l=s.shift();try{if(h[l].type){if(h[l].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(h[l].template)h[l].overwritten=true}if(h[l].type==r.PROPERTY.TYPE_ARRAY){if(h[l].template)h[l].overwritten=true}}}catch(e){}setValue(h[l],s,u)}else{if((h[s[0]]||{}).type=="boolean"){if(typeof i!="boolean")throw new o.InvalidValueException(i,(h[s[0]]||{}).type)}if((h[s[0]]||{}).type=="number"){if(isNaN(i))throw new o.InvalidValueException(i,(h[s[0]]||{}).type)}if((h[s[0]]||{}).template)h[s[0]].overwritten=true;h[s[0]]=i;if(h[s[0]].onChange){if(Object.keys(h[s[0]].onChange).length>0){if(!a.handlerSequence[h._id])a.handlerSequence[h._id]={};if(!a.handlerSequence[h._id].onChange)a.handlerSequence[h._id].onChange=[];a.handlerSequence[h._id].onChange.push({handler:h[s[0]].onChange,prop:h[s[0]]})}}e.chainPermission(h[s[0]],a,"u","setProperty",n)}}setValue(t,n,i)},EventIntervalSetWrapper:function(t,n,a,s,f,u){var h=t.getProperty(n);if(h.type!=r.PROPERTY.TYPE_EVENT)throw new o.NotAnEventException(n);function setValue(t,s,h){var l=t[u.propsObject]||t;if(typeof s=="string"){s=s.split(".")}if(s.length>1){var c=s.shift();try{if(l[c].type){if(l[c].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(l[c].template)l[c].overwritten=true}if(l[c].type==r.PROPERTY.TYPE_ARRAY){if(l[c].template)l[c].overwritten=true}}}catch(e){}setValue(l[c],s,h)}else{if(!l.hasOwnProperty(s[0]))throw new o.NoSuchPropertyException(n);if(l[s[0]].template)l[s[0]].overwritten=true;delete l[s[0]].date;l[s[0]].interval=a;if(l[s[0]].lastOccurence){var d=i(l[s[0]].lastOccurence).utc().add(a);f.eventAlterationSequence.push({operation:"remove",obj:t,propName:n,property:l[s[0]],date:d});f.eventAlterationSequence.push({operation:"add",obj:t,propName:n,property:l[s[0]],date:d})}e.chainPermission(l[s[0]],f,"u","setEventInterval",n)}}setValue(t,n,a)},EventTriggeredSetWrapper:function(e,t,n,a,s){var f=e.getProperty(t);if(f.type!=r.PROPERTY.TYPE_EVENT)throw new o.NotAnEventException(t);function setValue(e,a,f){var u=e[s.propsObject]||e;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var h=a.shift();try{if(u[h].type){if(u[h].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(u[h].template)u[h].overwritten=true}if(u[h].type==r.PROPERTY.TYPE_ARRAY){if(u[h].template)u[h].overwritten=true}}}catch(e){}setValue(u[h],a,f)}else{if(!u.hasOwnProperty(a[0]))throw new o.NoSuchPropertyException(t);if(u[a[0]].interval)u[a[0]].nextOccurence=i().utc().add(u[a[0]].interval).toISOString();else u[a[0]].triggered=n}}setValue(e,t,n)},EventLastOccurenceSetWrapper:function(e,t,n,a,s){var f=e.getProperty(t);if(f.type!=r.PROPERTY.TYPE_EVENT)throw new o.NotAnEventException(t);function setValue(e,a,f){var u=e[s.propsObject]||e;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var h=a.shift();try{if(u[h].type){if(u[h].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(u[h].template)u[h].overwritten=true}if(u[h].type==r.PROPERTY.TYPE_ARRAY){if(u[h].template)u[h].overwritten=true}}}catch(e){}setValue(u[h],a,f)}else{if(!u.hasOwnProperty(a[0]))throw new o.NoSuchPropertyException(t);u[a[0]].lastOccurence=n;u[a[0]].nextOccurence=i(n).utc().add(i.duration(u[a[0]].interval)).toISOString()}}setValue(e,t,n)},EventDateSetWrapper:function(t,n,i,a,s,f){function setValue(t,a,u){var h=t[f.propsObject]||t;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var l=a.shift();try{if(h[l].type){if(h[l].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(h[l].template)h[l].overwritten=true}if(h[l].type==r.PROPERTY.TYPE_ARRAY){if(h[l].template)h[l].overwritten=true}}}catch(e){}setValue(h[l],a,u)}else{if(!h.hasOwnProperty(a[0]))throw new o.NoSuchPropertyException(n);if(h[a[0]].template)h[a[0]].overwritten=true;delete h[a[0]].interval;delete h[a[0]].lastOccurence;delete h[a[0]].nextOccurence;h[a[0]].date=i;s.eventAlterationSequence.push({operation:"remove",obj:t,propName:n,property:h[a[0]],date:i});s.eventAlterationSequence.push({operation:"add",obj:t,propName:n,property:h[a[0]],date:i});e.chainPermission(h[a[0]],s,"u","setEventDate",n)}}setValue(t,n,i)},EventActionSetWrapper:function(t,n,i,a,s,f){function setValue(t,a,u){var h=t[f.propsObject]||t;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var l=a.shift();try{if(h[l].type){if(h[l].type==r.PROPERTY.TYPE_PROPERTY_BAG){if(h[l].template)h[l].overwritten=true}if(h[l].type==r.PROPERTY.TYPE_ARRAY){if(h[l].template)h[l].overwritten=true}}}catch(e){}setValue(h[l],a,u)}else{if(!h.hasOwnProperty(a[0]))throw new o.NoSuchPropertyException(n);if(h[a[0]].template)h[a[0]].overwritten=true;h[a[0]].action=i;e.chainPermission(h[a[0]],s,"u","setEventAction",n)}}setValue(t,n,i)}}}},860:function(e){var t={enabled:[],log:function(e){if(this.enabled.length==0||this.enabled.indexOf("log")!=-1)console.log(e)},warn:function(e){if(this.enabled.length==0||this.enabled.indexOf("warn")!=-1)console.warn(e)},error:function(e){if(this.enabled.length==0||this.enabled.indexOf("error")!=-1)console.error(e)}};e.exports=t},925:function(e,t,n){var r=n(325);var i=n(462);var o=n(451);e.exports=function(e){return{define:function(t){var n=this;if(typeof t=="string")t={name:t,pluralName:t+"s"};if(!t.name||!t.pluralName){throw new Error("Invalid arguments")}this[t.name]=function(n){return new e.Obj(n,t.name,this,t)};if(this.objectFamilies.indexOf(t.name)==-1)this.objectFamilies.push(t.name);this[t.pluralName]=function(n,r){return new e.Objs(n,t.name,this,t,r)};if(t.storage)this.plugInPersistenceMapper(t.name,t.storage);else this.plugInPersistenceMapper(t.name,n.storage||new r(n));if(t.processor)this.plugInProcessor(t.name,t.processor);else this.plugInProcessor(t.name,n.processor||new i(n));if(t.observer){this.plugInObserver(t.name,t.observer);if(t.observer.initialize)t.observer.initialize()}else{this.plugInObserver(t.name,n.observer||new o(n));if(this.observers[t.name].initialize)this.observers[t.name].initialize()}if(t.backend){this.plugInPersistenceMapper(t.name,t.backend.storage);this.plugInProcessor(t.name,t.backend.processor);this.plugInObserver(t.name,t.backend.observer)}return this[t.name]},ObjectFamily:function(e){return this.define(e)},getConstructor:function(t){if(this.mappers[t])return e[t];throw new Error("No constructor")},getObjectFamilies:function(){return this.objectFamilies}}}},928:function(e){ObserverMapperTemplate=function(e,t,n){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.OBJY=e;this.interval=(t||{}).interval||6e4;this.objectFamily=null;this.type=(t||{}).type||this.CONSTANTS.TYPES.QUERIED;this.multitenancy=(t||{}).multitenancy||this.CONSTANTS.MULTITENANCY.ISOLATED;this.initialize=function(e){};this.setObjectFamily=function(e){this.objectFamily=e};this.run=function(e){};if(n)Object.assign(this,n)};e.exports=ObserverMapperTemplate},969:function(e){StorageMapperTemplate=function(e,t){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.objectFamily=null;this.multitenancy=(t||{}).multitenancy||this.CONSTANTS.MULTITENANCY.ISOLATED;this.connect=function(e,t,n){};this.closeConnection=function(e,t){};this.setObjectFamily=function(e){this.objectFamily=e};this.setMultiTenancy=function(e){this.multitenancy=e};this.createClient=function(e,t,n){};this.getDBByMultitenancy=function(e){};this.listClients=function(e,t){};this.getById=function(e,t,n,r,i,o){};this.getByCriteria=function(e,t,n,r,i,o,a,s){};this.count=function(e,t,n,r,i,o,a,s){};this.update=function(e,t,n,r,i,o,a){};this.add=function(e,t,n,r,i,o,a){};this.remove=function(e,t,n,r,i,o,a){}};e.exports=StorageMapperTemplate},982:function(e){ProcessorMapperTemplate=function(e){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.OBJY=e;this.objectFamily=null;this.multitenancy=this.CONSTANTS.MULTITENANCY.ISOLATED;this.execute=function(e,t,n,r,i,o,a,s,f){};this.setMultiTenancy=function(e){this.multitenancy=e};this.setObjectFamily=function(e){this.objectFamily=e}};e.exports=ProcessorMapperTemplate},993:function(e,t,n){var r=n(458);e.exports=function(e){return{applyAffects:function(e,t,n,i,o){this.affectables.forEach(function(t){if(r.query([e],t.affects,r.undot).length!=0){var n=t.apply;var i=t._id;if(n.name){if(!e.name)e.name=n.name}if(n.type){if(!e.type)e.type=n.type}["onCreate","onChange","onDelete"].forEach(function(t){if(n[t]){Object.keys(n[t]).forEach(function(r){if(!e[t])e[t]={};if(!e[t][r]){e[t][r]=n[t][r];e[t][r].template=i}})}});var a=function(e){return!!e&&e.constructor===Object};function doTheProps(e,t){if(!t)t={};Object.keys(e||{}).forEach(function(n){var r=t[o.propsObject]||t;var s=a(e[n]);if((e[n]||{}).type=="bag"){if(!r[n]){r[n]=e[n];if(s)r[n].template=i}else{if(!r[n].overwritten&&Object.keys(r[n]).length==0){r[n]=e[n]}if(s)r[n].template=i}if(!r[r])r[n]={};doTheProps(e[n],r[n])}else if(a(e[n])){if(!r[n]){r[n]=e[n];if(n!="properties"&&s)r[n].template=i}else{if(!r[n].overwritten&&Object.keys(r[n]).length==0){r[n]=e[n]}if(n!="properties"&&s)r[n].template=i}doTheProps(e[n],r[n])}if(!r[n]){r[n]=e[n];if(n!="properties"&&s)r[n].template=i;if(s)delete r[n].overwritten}else{if(!r[n].overwritten){if(n!="properties"&&s)r[n].template=i;if(r[n].value==null&&s)r[n].value=e[n].value}if(!r[n].metaOverwritten){r[n].meta=e[n].meta}}if(e.permissions){if(!r.permissions)r.permissions={};Object.keys(e.permissions).forEach(function(t){if(!r.permissions[t]){r.permissions[t]=e.permissions[t];if(s)r.permissions[t].template=i}else{if(s)r.permissions[t].template=i;if(s)r.permissions[t].overwritten=true}})}["onCreate","onChange","onDelete"].forEach(function(t){if(!a(e[n]))return;if(e[n][t]){if(!r[n][t])r[n][t]={};Object.keys(e[n][t]).forEach(function(o){if(!r[n][t][o]){r[n][t][o]=e[n][t][o];r[n][t][o].template=i}})}})})}doTheProps(n||{},e||{});if(n.applications){n.applications.forEach(function(t){if(e.applications)if(e.applications.indexOf(t)==-1)e.applications.push(t)})}if(n._clients){n._clients.forEach(function(t){if((e._clients||[]).indexOf(t)==-1)(e._clients||[]).push(t)})}if(n.authorisations){var s=Object.keys(n.authorisations);if(s.length>0){if(!e.authorisations)e.authorisations={}}s.forEach(function(t){if(!e.authorisations[t]){e.authorisations[t]=n.authorisations[t];e.authorisations[t].forEach(function(e){e.template=n._id})}else{n.authorisations[t].forEach(function(r){var i=false;e.authorisations[t].forEach(function(e){if(JSON.stringify(e.query)==JSON.stringify(r.query))i=true});if(i){r.overwritten=true}else{r.template=n._id;e.authorisations[t].push(r)}})}})}if(n.permissions){if(!e.permissions)e.permissions={};Object.keys(n.permissions).forEach(function(t){if(!e.permissions[t]){e.permissions[t]=n.permissions[t];e.permissions[t].template=i}else{e.permissions[t].template=i;e.permissions[t].overwritten=true}})}if(n.privileges){if(!e.privileges)e.privileges={};Object.keys(n.privileges).forEach(function(t){if(!e.privileges[t])e.privileges[t]=[];n.privileges[t].forEach(function(n){var r=false;e.privileges[t].forEach(function(e){if(e.name==n.name)r=true})});if(!contains){e.privileges[t].push({name:tP.name,template:i})}})}}});this.applyRules(e,t,n,i)},applyRules:function(e,t,n,i){var o=this;o.staticRules.forEach(function(o){if(r.query([e],o.affects,r.undot).length!=0){var a=o.apply;var s=o._id;["onCreate","onChange","onDelete"].forEach(function(r){if(a[r]){Object.keys(a[r]).forEach(function(o){if(t!=r)return;n.execProcessorAction(a[r][o].value||a[r][o].action,e,null,null,function(e){},i,null)})}});if(a._constraints){if(!Array.isArray(e._constraints))e._constraints=[];a._constraints.forEach(t=>{e._constraints.push(t)})}}})}}}}},function(e){"use strict";!function(){e.nmd=function(e){e.paths=[];if(!e.children)e.children=[];Object.defineProperty(e,"loaded",{enumerable:true,get:function(){return e.l}});Object.defineProperty(e,"id",{enumerable:true,get:function(){return e.i}});return e}}()});