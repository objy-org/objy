(()=>{var __webpack_modules__={845:(e,t,r)=>{var i=r(351);e.exports=function(e){return{applyAffects:function(e,t,r,n,s){this.affectables.forEach((function(t){if(i.query([e],t.affects,i.undot).length!=0){var r=t.apply;var n=t._id;if(r.name){if(!e.name)e.name=r.name}if(r.type){if(!e.type)e.type=r.type}["onCreate","onChange","onDelete"].forEach((function(t){if(r[t]){Object.keys(r[t]).forEach((function(i){if(!e[t])e[t]={};if(!e[t][i]){if(!r[t][i])return;e[t][i]=r[t][i];e[t][i].template=n}}))}}));var isObject=function(e){return!!e&&e.constructor===Object};function doTheProps(e,t){var r=t[s.propsObject]||t;if(!e[s.propsObject])return;var i=e[s.propsObject]||e;if(!r)r={};Object.keys(i||{}).forEach((function(e){var t=isObject(i[e]);if((i[e]||{}).type=="bag"){if(!r[e]){r[e]=i[e];if(t)r[e].propsTmpl=n}else{if(!r[e].overwritten&&Object.keys(r[e]).length==0){r[e]=i[e]}if(t)r[e].propsTmpl=n}if(!r[r])r[e]={};doTheProps(i[e],r[e])}else if(isObject(i[e])){if(!r[e]){r[e]=i[e];if(e!="properties"&&t)r[e].propsTmpl=n}else{if(!r[e].overwritten&&Object.keys(r[e]).length==0){r[e]=i[e]}if(e!="properties"&&t)r[e].propsTmpl=n}doTheProps(i[e],r[e])}if(!r[e]){r[e]=i[e];if(e!="properties"&&t)r[e].propsTmpl=n;if(t)delete r[e].overwritten}else{if(!r[e].overwritten){if(e!="properties"&&t)r[e].propsTmpl=n;if(r[e].value==null&&t)r[e].value=i[e].value}if(!r[e].metaOverwritten){r[e].meta=i[e].meta}}if(i.permissions){if(!r.permissions)r.permissions={};Object.keys(i.permissions).forEach((function(e){if(!r.permissions[e]){r.permissions[e]=i.permissions[e];if(t)r.permissions[e].propsTmpl=n}else{if(t)r.permissions[e].propsTmpl=n;if(t)r.permissions[e].overwritten=true}}))}["onCreate","onChange","onDelete"].forEach((function(t){if(!isObject(i[e]))return;if(i[e][t]){if(!r[e][t])r[e][t]={};Object.keys(i[e][t]).forEach((function(s){if(!r[e][t][s]){r[e][t][s]=i[e][t][s];r[e][t][s].propsTmpl=n}}))}}))}))}doTheProps(r||{},e||{});if(r.applications){r.applications.forEach((function(t){if(e.applications)if(e.applications.indexOf(t)==-1)e.applications.push(t)}))}if(r._clients){r._clients.forEach((function(t){if((e._clients||[]).indexOf(t)==-1)(e._clients||[]).push(t)}))}if(r.authorisations){var a=Object.keys(r.authorisations);if(a.length>0){if(!e.authorisations)e.authorisations={}}a.forEach((function(t){if(!e.authorisations[t]){e.authorisations[t]=r.authorisations[t];e.authorisations[t].forEach((function(e){e.template=r._id}))}else{r.authorisations[t].forEach((function(i){var n=false;e.authorisations[t].forEach((function(e){if(JSON.stringify(e.query)==JSON.stringify(i.query))n=true}));if(n){i.overwritten=true}else{i.template=r._id;e.authorisations[t].push(i)}}))}}))}if(r.permissions){if(!e.permissions)e.permissions={};Object.keys(r.permissions).forEach((function(t){if(!e.permissions[t]){e.permissions[t]=r.permissions[t];e.permissions[t].template=n}else{e.permissions[t].template=n;e.permissions[t].overwritten=true}}))}if(r.privileges){if(!e.privileges)e.privileges={};Object.keys(r.privileges).forEach((function(t){if(!e.privileges[t])e.privileges[t]=[];r.privileges[t].forEach((function(r){var i=false;e.privileges[t].forEach((function(e){if(e.name==r.name)i=true}))}));if(!contains){e.privileges[t].push({name:tP.name,template:n})}}))}}}));this.applyRules(e,t,r,n)},applyRules:function(e,t,r,n){var s=this;s.staticRules.forEach((function(s){if(i.query([e],s.affects,i.undot).length!=0){var a=s.apply;var o=s._id;["onCreate","onChange","onDelete"].forEach((function(i){if(a[i]){Object.keys(a[i]).forEach((function(s){if(t!=i)return;r.execProcessorAction(a[i][s].value||a[i][s].action,e,null,null,(function(e){}),n,null)}))}}));if(a._constraints){if(!Array.isArray(e._constraints))e._constraints=[];a._constraints.forEach((t=>{if(e._constraints.find((e=>e.key==t.key)))return;t.templateId=o;e._constraints.push(t)}))}}}))}}}},34:(e,t,r)=>{var i=r(77);var n=r(736);var s=r(625);var a=r(583);var o=i;var u=n;var c=s;e.exports=function(e){return{Logger:a,predefinedProperties:["_aggregatedEvents","authorisations","_id","properties","role","applications","inherits","onCreate","onChange","onDelete","permissions","privileges","created","lastModified"],metaPropPrefix:"",instance:this,activeTenant:null,activeUser:null,activeApp:null,objectFamilies:[],affectables:[],staticRules:[],mappers:{},caches:{},ignorePermissions:false,ignoreAuthorisations:false,handlerSequence:[],permissionSequence:[],alterSequence:[],commandSequence:[],eventAlterationSequence:[],storage:null,processor:null,observer:null,StorageTemplate:o,ProcessorTemplate:u,ObserverTemplate:c,processors:{},observers:{}}}},731:(e,t,r)=>{var i=r(889);e.exports=function(e){return{serialize:function(e){return e},deserialize:function(e){return e},tenant:function(e){return this.client(e)},client:function(e){if(!e)throw new Error("No client specified");this.activeTenant=e;return this},useUser:function(e){this.activeUser=e;return this},app:function(e){this.activeApp=e;return this},getPropsObject:function(e,t){if(e.hasOwnProperty("role"))if(t.hasOwnProperty("propsObject"))if(!e.hasOwnProperty(t.propsObject))e[t.propsObject]={};return e[t.propsObject]||e},serializePropsObject:function(e,t,r,i,n){},deSerializePropsObject:function(t,r){return t;if(!r.propsObject)return t;if(!t.hasOwnProperty(r.propsObject))t[r.propsObject]={};Object.keys(t).forEach((i=>{if(!e.predefinedProperties.includes(i)&&typeof t[i]!=="function"){t[r.propsObject][i]=t[i];delete t[i]}}));return t},deSerializePropsObjectMulti:function(e,t){return e},chainCommand:function(e,t,r,i){t.commandSequence.push({name:r,value:i})},ConditionsChecker:function(e,t){if(e.hasOwnProperty("conditions")){}},execProcessorAction:function(t,r,i,n,s,a,o){e.Logger.log("triggering dsl");this.processors[r.role].execute(t,r,i,n,s,a,this.instance.activeUser,o)},ID:function(){var e="";var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789,;-_";for(var r=0;r<25;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},RANDOM:function(e){return i.generate()},checkConstraints:function(e,t){var r=this;var i=true;var n=[];if(!e["_constraints"])return false;e._constraints.forEach((t=>{if(e[t.key]){if(typeof t.validate==="function"){var r=t.validate(e[t.key]);if(!r)n.push(t.key)}}else if(t.key.indexOf(".")!=-1){function getValue(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){getValue(e[r.shift()],r)}else if(e){propertyToReturn=e[r[0]];if(typeof t.validate==="function"){var i=t.validate(propertyToReturn);if(!i&&!n.includes(t.key))n.push(t.key)}}}getValue(e,t.key)}}));if(!n.length)return true;else return n}}}},686:e=>{var isObject=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{customStorage:function(t,r){return Object.assign(new e.StorageTemplate(e,r),t)},customProcessor:function(t,r){return Object.assign(new e.ProcessorTemplate(e,r),t)},customObserver:function(t,r){return Object.assign(new e.ObserverTemplate(e,r),t)},getPersistenceMapper:function(e){if(!this.mappers[e])throw new Error("No such Object Family");return this.mappers[e]},getPersistence:function(e){if(!this.mappers[e])throw new Error("No such Object Family: "+e);return this.mappers[e]},plugInPersistenceMapper:function(e,t){if(!e)throw new Error("No mapper name provided");this.mappers[e]=t;if(Array.isArray(this.mappers[e])){this.mappers[e].forEach((t=>{t.setObjectFamily(e)}))}else this.mappers[e].setObjectFamily(e);this.caches[e]={data:{},add:function(e,t){if(Object.keys(this.data).length>=50)delete this.data[Object.keys(this.data).length];this.data[e]=t},get:function(e){return this.data[e]}}},getProcessor:function(e){if(!this.processors[e])throw new Error("No such Object Family");return this.processors[e]},plugInProcessor:function(e,t){if(!e)throw new Error("No mapper name provided");this.processors[e]=t;this.processors[e].setObjectFamily(e)},getObserver:function(e){if(!this.observers[e])throw new Error("No such Object Family");return this.observers[e]},plugInObserver:function(e,t){if(!e)throw new Error("No mapper name provided");this.observers[e]=t;this.observers[e].setObjectFamily(e)},instantStorage:function(e){return Object.assign(new StorageTemplate(this),e)},instantObserver:function(e){return Object.assign(new ObserverTemplate(this),e)},instantProcessor:function(e){return Object.assign(new ProcessorTemplate,e)},remove:function(e,t,r,i,n,s,a){this.removeObject(e,t,r,i,n,s,a)},removeObject:function(e,t,r,i,n,s,a){var o=this;this.mappers[e.role].remove(e,(function(e){t(e)}),(function(e){r(e)}),i,n,s,a)},add:function(t,r,i,n,s,a,o){if(t){var u=Object.keys(t);u.forEach((function(t){if(!isObject(t))return;if(t.template)t=null;if(t.type==CONSTANTS.PROPERTY.TYPE_SHORTID){if(t.value==""&&!t.value)t.value=e.RANDOM()}}))}this.addObject(t,r,i,n,s,a,o)},addObject:function(e,t,r,i,n,s,a){if(Array.isArray(this.mappers[e.role])){var o=0;var u=this.mappers[e.role].length;var c=[];function commit(s){this.mappers[e.role][s].add(e,(function(r){c.push(e);++s;if(s==u)return t(r);commit(s)}),(function(e){r(e)}),i,n,c[s-1],a)}commit(o);this.mappers[e.role].forEach((e=>{}))}else{this.mappers[e.role].add(e,(function(e){t(e)}),(function(e){r(e)}),i,n,s,a)}},updateO:function(t,r,i,n,s,a,o){var u=this;if((t.inherits||[]).length==0)u.updateObject(t,r,i,n,s,a);var c=0;(t.inherits||[]).forEach((function(f){if(t._id!=f){e.removeTemplateFieldsForObject(t,f,(function(){c++;if(c==t.inherits.length){u.updateObject(t,r,i,n,s,a);return t}}),(function(e){u.updateObject(t,r,i,n,s,a,o);return t}),s,a,o)}else{if(t.inherits.length==1){u.updateObject(t,r,i,n,s,a,o);return t}else{c++;return}}}));return},updateObject:function(e,t,r,i,n,s,a){this.mappers[e.role].update(e,(function(e){t(e)}),(function(e){r(e)}),i,n,s,a)},getObjectById:function(e,t,r,i,n,s,a,o,a){this.mappers[e].getById(t,(function(e){if(e==null){i("Error - object not found: "+t);return}r(e)}),(function(e){i("Error - Could get object: "+e)}),n,s,o,a)},findObjects:function(e,t,r,i,n,s,a,o,u){var c=[];var f=[];this.mappers[t].getByCriteria(e,(function(e){var t=0;var i=e.length;if(i==0)return r([]);r(e)}),(function(e){i("Error - Could get object: "+e)}),n,s,a,o,u)},countObjects:function(e,t,r,i,n,s,a,o,u){var c=[];var f=[];this.mappers[t].count(e,(function(e){var t=0;var i=e.length;if(i==0)r([]);r(e)}),(function(e){i("Error - Could get object: "+e)}),n,s,a,o,u)},findAllObjects:function(e,t,r,i,n,s,a,o){this.findObjects(e,t,r,i,n,s,a,o)}}}},842:(e,t,r)=>{var i=r(456);e.exports=function(e){return{updateInheritedObjs:function(e,t,r,i,n,s,a){},removeInheritedObjs:function(e,t,r,i,n){var s=` \n            OBJY['${t}']({inherits: {$in: ["${e._id}"]}}).get(function(data){\n                data.forEach(function(d){\n                    d.removeInherit(${e._id})\n                    d.update();\n                })\n            })`;this.execProcessorAction(s,e,null,null,(function(e){}),n,{})},prepareObjectDelta:function(e,t,r,i){var n=["name","type"];n.forEach((function(r){if(t[r]!=e[r])e[r]=t[r]}));var s=["onCreate","onChange","onDelete"];s.forEach((function(r){if(t[r]){Object.keys(t[r]).forEach((function(i){if(t[r][i]){if(t[r][i].value!=e[r][i].value)e[r][i].value=t[r][i].value;e[r][i].overwritten=true}}))}}));function doTheProps(t){var i=obj[r.propsObject]||obj;Object.keys(i).forEach((function(t){if(i[t].type=="bag"){doTheProps(i[t])}if(i[t]){if(i[t].template&&e[t]){if(i[t].value!=e[t].value){e[t].value=i[t].value;e[t].overwritten=true}if(i[t].action!=e[t].action){e[t].action=i[t].action;e[t].overwritten=true}if(i[t].date!=e[t].date){e[t].date=i[t].date;e[t].overwritten=true}if(i[t].interval!=e[t].interval){e[t].interval=i[t].interval;e[t].overwritten=true}if(JSON.stringify(i[t].meta)!=JSON.stringify(e[t].interval)){e[t].meta=i[t].meta;e[t].overwritten=true}}}if(!e[t])e[t]=i[t];if(i.permissions){Object.keys(i.permissions).forEach((function(t){if(i.permissions[t]){if(JSON.stringify(i.permissions[t])!=JSON.stringify(e.permissions[t]))e.permissions[t]=i.permissions[t];e.permissions[t].overwritten=true}}))}if(i[t]){s.forEach((function(r){if(i[t][r]){Object.keys(i[t][r]).forEach((function(n){if(i[t][r][n]){if(i[t][r][n].value!=e[t][r][n].value)e[t][r][n].value=i[t][r][n].value;e[t][r][n].overwritten=true}}))}}))}}))}doTheProps(t);if(t.permissions){Object.keys(t.permissions).forEach((function(r){if(t.permissions[r]){if(t.permissions[r].value!=e.permissions[r].value)e.permissions[r].value=t.permissions[r].value;e.permissions[r].overwritten=true}}))}return e},getTemplateFieldsForObject:function(t,r,i,n,s,a,o,u,c){if(u.templateFamily===null)return i(t);var f=this;var isObject=function(e){return!!e&&e.constructor===Object};function run(n){if(!n){}if(n.name){if(!t.name)t.name=n.name}if(n.type){if(!t.type)t.type=n.type}["onCreate","onChange","onDelete"].forEach((function(e){if(n[e]){Object.keys(n[e]).forEach((function(i){if(!n[e][i]||!isObject(n[e][i]))return;if(!t[e])t[e]={};if(!t[e][i]){t[e][i]=n[e][i];t[e][i].template=r}}))}}));function doTheProps(t,i){if(!i)i={};if(!t)t={};if(u.propsObject&&!i.hasOwnProperty(u.propsObject))i[u.propsObject]={};var n=i[u.propsObject]||i;var s=t[u.propsObject]||t;Object.keys(s).forEach((function(t){if(!u.propsObject&&(e.predefinedProperties.includes(t)||(isObject(s[t])||Array.isArray(s[t]))))return;if(!s[t])return;var i=JSON.parse(JSON.stringify(s[t]));if(!n[t]){n[t]=i;n[t].template=r;delete n[t].overwritten}else{if(i.meta){if(!n[t].meta){n[t].meta=i.meta;n[t].meta.overwritten=true}else{if(!n[t].meta.overwritten){n[t].meta=i.meta;n[t].meta.overwritten=true}}}if(!n[t].type)n[t].type=i.type;n[t].template=r;n[t].overwritten=true}if(s.permissions){if(!n.permissions)n.permissions={};Object.keys(s.permissions).forEach((function(e){if(!n.permissions[e]){n.permissions[e]=s.permissions[e];n.permissions[e].template=r}else{n.permissions[e].template=r;n.permissions[e].overwritten=true}}))}["onCreate","onChange","onDelete"].forEach((function(e){if(s[t][e]){if(!n[t][e])n[t][e]={};Object.keys(s[t][e]).forEach((function(i){if(!n[t][e][i]){n[t][e][i]=s[t][e][i];if(n[t][e][i])n[t][e][i].template=r}}))}}));if(s[t].type=="bag"){doTheProps(i,n[t])}}))}doTheProps(n,t);if(n.applications){n.applications.forEach((function(e){if(t.applications)if(t.applications.indexOf(e)==-1)t.applications.push(e)}))}if(n.authorisations){var s=Object.keys(n.authorisations);if(s.length>0){if(!t.authorisations)t.authorisations={}}s.forEach((function(e){if(!t.authorisations[e]){t.authorisations[e]=n.authorisations[e];t.authorisations[e].forEach((function(e){e.template=n._id}))}else{n.authorisations[e].forEach((function(r){var i=false;t.authorisations[e].forEach((function(e){if(JSON.stringify(e.query)==JSON.stringify(r.query))i=true}));if(i){r.overwritten=true}else{r.template=n._id;r.test="has";t.authorisations[e].push(r)}}))}}))}if(n.permissions){if(!t.permissions)t.permissions={};Object.keys(n.permissions).forEach((function(e){if(!t.permissions[e]){t.permissions[e]=n.permissions[e];t.permissions[e].template=r}else{t.permissions[e].template=r;t.permissions[e].overwritten=true}}))}if(n.privileges){if(!t.privileges)t.privileges={};Object.keys(n.privileges).forEach((function(e){if(!t.privileges[e])t.privileges[e]=[];n.privileges[e].forEach((function(i){var n=false;t.privileges[e].forEach((function(e){if(e.name==i.name)n=true}));if(!n){23;t.privileges[e].push({name:i.name,template:r})}}))}))}i(t)}if(f.caches[a||t.role].get(r)){}else{e.getObjectById(a||t.role,r,(function(r){var i=0;if((r.inherits||[]).length==0)run(r);else{r.inherits.forEach((function(n){e.getTemplateFieldsForObject(r,n,(function(){i++;if(i==r.inherits.length)run(r)}),(function(e){i++;if(i==r.inherits.length)run(r)}),s,a||t.role,o||e.activeTenant,u)}))}}),(function(e){n(e)}),e.activeApp,o||e.activeTenant)}},removeTemplateFieldsForObject:function(e,t,r,i,n,s,a){if(s.templateFamily===null)return r(e);if(!t){i("template not found");return}["onCreate","onChange","onDelete"].forEach((function(r){if(e[r]){Object.keys(e[r]).forEach((function(i){if(e[r][i]){if(e[r][i].template==t&&!e[r][i].overwritten)delete e[r][i]}}))}}));var isObject=function(e){return!!e&&e.constructor===Object};function doTheProps(e){var r=e[s.propsObject]||e;if(r){Object.keys(r).forEach((function(e){if(!isObject(r[e]))return;if(r[e]){["onCreate","onChange","onDelete"].forEach((function(i){if(r[e][i]){propsObject.keys(r[e][i]).forEach((function(n){if(r[e][i][n]){if(r[e][i][n].template==t&&!r[e][i][n].overwritten)delete r[e][i][n]}}))}}))}if(r[e].type=="bag"){return doTheProps(r[e])}if(r[e]){if(r[e].value!=null)r[e].overwritten=true;if(r[e].template==t&&!r[e].overwritten){delete r[e]}}}))}}doTheProps(e);if(e.permissions){Object.keys(e.permissions).forEach((function(r){if(e.permissions[r]){if(e.permissions[r].template==t&&!e.permissions[r].overwritten)delete e.permissions[r]}}))}if(e.privileges){Object.keys(e.privileges).forEach((function(r){if(!Array.isArray(e.privileges[r]))return;e.privileges[r].forEach((function(i,n){if(i.template==t&&!i.overwritten)e.privileges[r].splice(n,1)}))}))}if(e._constraints){if(!Array.isArray(e._constraints))return;e._constraints.forEach(((r,i)=>{if(r.templateId==t&&!r.overwritten)e._constraints.splice(i,1)}))}r(e)},updateObjAfterTemplateChange:function(e){},removeTemplateFieldsToObject:function(e,t){this.getTemplateAsyn(t,(function(t){var r=Object.keys(t);r.forEach((function(t){if(e[t]===undefined){this.removeTemplateFieldFromObjects(e.template[t])}}))}),(function(e){}))},addTemplateToObject:function(t,r,i){var n=false;t.inherits.forEach((function(e){if(e==r)n=true}));if(!n){t.inherits.push(r);e.chainPermission(t,i,"i","addInherit",r);e.chainCommand(t,i,"addInherit",r)}},addApplicationToObject:function(t,r,n){var s=false;if(!t.applications)t.applications=[];t.applications.forEach((function(e){if(e==r)s=true}));if(!s){t.applications.push(r);e.chainPermission(t,n,"a","addApplication",r)}else throw new i.DuplicateApplicationException(r)},removeApplicationFromObject:function(t,r,n){var s=false;t.applications.forEach((function(e,i){if(e==r){t.applications.splice(i,1);s=true}}));e.chainPermission(t,n,"a","removeApplication",r);if(!s){throw new i.NoSuchApplicationException(r)}},removeTemplateFromObject:function(t,r,i,n,s){var a=false;t.inherits.forEach((function(e){if(e==r)a=true}));if(t.inherits.indexOf(r)!=-1){t.inherits.splice(t.inherits.indexOf(r),1);e.chainPermission(t,s,"i","removeInherit",r);e.chainCommand(t,s,"removeInherit",r);i(t)}else{n("Template not found in object")}},TemplatesCreateWrapper:function(e,t){var r=false;e.inherits.forEach((function(e){if(e==t)r=true}));if(!r){e.inherits.push(t)}},ObjectPermissionsCreateWrapper:function(e,t){if(!typeof t=="object")throw new i.InvalidPermissionException;if(!t)return;var r=Object.keys(t);r.forEach((function(e){if(typeof t[e]=="string"){t[e]={value:t[e]}}else{t[e]=t[e]}}));return t},ObjectOnCreateSetWrapper:function(t,r,n,s,a,o){if(!n)throw new i.InvalidHandlerException;if(!t.onCreate)t.onCreate={};if(t.onCreate[r])throw new i.HandlerExistsException(r);if(!r)r=e.RANDOM();if(!t.onCreate[r])t.onCreate[r]={};t.onCreate[r].value=n;t.onCreate[r].trigger=s||"after";t.onCreate[r].type=a||"async";if(t.onCreate[r].templateId)t.onCreate[r].overwritten=true;e.chainPermission(t,o,"v","setOnCreateHandler",r);return n},ObjectOnCreateCreateWrapper:function(e,t,r){if(!t)return;Object.keys(t).forEach((function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"}));return t},AffectsCreateWrapper:function(e,t){if(!t)t={};return t},ApplyCreateWrapper:function(e,t){if(!t)t={};return t},ObjectOnChangeCreateWrapper:function(e,t,r){if(!t)return;Object.keys(t).forEach((function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"}));return t},ObjectAuthorisationSetWrapper:function(t,r,i){var n=i.activeApp||"*";if(!t.authorisations)t.authorisations={};if(!t.authorisations[n])t.authorisations[n]=[];if(!r.name)r.name=e.RANDOM();var s=false;t.authorisations[n].forEach((e=>{if(e.name==r.name){e=r;s=true}}));if(!s)t.authorisations[n].push(r);return r},ObjectAuthorisationRemoveWrapper:function(e,t,r){var i=r.activeApp||"*";if(!e.authorisations)throw new Error("No authorisations present");if(!e.authorisations[i])throw new Error("No authorisations for this app present");e.authorisations[i].forEach(((r,n)=>{if(r.name==t)e.authorisations[i].splice(n,1)}));if(Object.keys(e.authorisations[i]).length==0)delete e.authorisations[i];return t},ObjectOnDeleteCreateWrapper:function(e,t,r){if(!t)return;Object.keys(t).forEach((function(e){if(!t[e].trigger)e.trigger="after";if(!t[e].trigger)e.type="async"}));return t},ObjectOnChangeSetWrapper:function(t,r,n,s,a,o){if(!n)throw new i.InvalidHandlerException;if(!t.onChange)t.onChange={};if(t.onChange[r])throw new i.HandlerExistsException(r);if(!r)r=e.RANDOM();if(!t.onChange[r])t.onChange[r]={};t.onChange[r].value=n;t.onChange[r].trigger=s||"after";t.onChange[r].type=a||"async";if(t.onChange[r].templateId)t.onChange[r].overwritten=true;e.chainPermission(t,o,"w","setOnChangeHandler",r);return n},ObjectOnDeleteSetWrapper:function(t,r,n,s,a,o){if(!n)throw new i.InvalidHandlerException;if(!t.onDelete)t.onDelete={};if(t.onDelete[r])throw new i.HandlerExistsException(r);if(!r)r=e.RANDOM();if(!t.onDelete[r])t.onDelete[r]={};t.onDelete[r].value=n;t.onDelete[r].trigger=s||"after";t.onDelete[r].type=a||"async";if(t.onDelete[r].templateId)t.onDelete[r].overwritten=true;e.chainPermission(t,o,"z","setOnDeleteHandler",r);return n},ObjectPermissionSetWrapper:function(t,r,n){if(!t.permissions)t.permissions={};if(!typeof r=="object")throw new i.InvalidPermissionException;if(!r)throw new i.InvalidPermissionException;var s=Object.keys(r)[0];if(!t.permissions[s])t.permissions[s]=r[s];else{t.permissions[s]=r[s]}e.chainPermission(t,n,"x","setPermission",s);return r},ObjectPermissionRemoveWrapper:function(t,r,n){if(!r)throw new i.InvalidPermissionException;if(!typeof r=="string")throw new i.InvalidPermissionException;if(!t.permissions[r])throw new i.NoSuchPermissionException(r);e.chainPermission(t,n,"x","removePermission",r);delete t.permissions[r];return r},ObjectRoleChecker:function(e,t){switch(t){case"object":return t;break;case"template":return t;break;case"tenant":return t;break;case"application":return t;break;case"user":e.username="";e.password="";return t;break;default:return"object"}},PropertiesChecker:function(t,r,i,n){if(r===undefined)return;if(n.propsObject)t[n.propsObject]={};var s=Object.keys(r);s.forEach((function(s){var a={};a[s]=r[s];var o=a;new e.PropertyCreateWrapper(t,o,false,i,n)}));return t[n.propsObject]||t},ApplicationsChecker:function(e,t){if(t===undefined)return;e.applications=[];t.forEach((function(t){e.applications.push(t)}));return e.applications},ActionsChecker:function(t,r){if(r===undefined)return;t.actions={};var i=Object.keys(r);i.forEach((function(i){var n={};n[i]=r[i];var s=n;new e.ActionCreateWrapper(t,s,false)}));return t.actions},InheritsChecker:function(t,r){if(r===undefined)return;if(typeof r!=="object")return;t.inherits=[];r.forEach((function(r){if(r!=t._id)new e.TemplatesCreateWrapper(t,r)}));return t.inherits},PrivilegesChecker:function(e){return e.privileges},PrivilegeChecker:function(e,t){if(!typeof t=="object")throw new i.InvalidPrivilegeException;var r=Object.keys(t)[0];if(!e.privileges)e.privileges={};if(!e.privileges[r]){e.privileges[r]=[]}var n=false;e.privileges[r].forEach((function(e){if(e.name==t[r].name)n=true}));if(!n)e.privileges[r].push({name:t[r].name});else throw new Error("Privilege already exists");return t},PrivilegeRemover:function(e,t,r){var n=r.activeApp;if(!e.privileges[n]){throw new i.NoSuchPrivilegeException}var s;for(s=0;s<e.privileges[n].length;s++){if(e.privileges[n][s].name==t)e.privileges[n].splice(s,1)}if(e.privileges[n].length==0){delete e.privileges[n]}return t}}}},338:(e,t,r)=>{var i=r(351);e.exports=function(e){return{checkPermissions:function(e,t,r,i,n,s){if(s.ignorePermissions==true)return true;var a=false;if(!e)return true;if(e.spooAdmin)return true;if(e._id==r._id&&i=="r")return true;var o=e.privileges;var u=r.permissions;if(!u)return true;if(Object.keys(u||{}).length==0)return true;if(!o&&u){if(!n)return false;else return false}var c=false;if(Array.isArray(u)){var f={};u.forEach((function(e){f[e.name]={value:e.value}}));u=f}if(t){if(o["*"]){Object.keys(u).forEach((function(e){o["*"].forEach((function(e){if(u[e.name]){if(((u[e.name]||{}).value||"").indexOf(i)!=-1||(u[e.name]||{}).value=="*")c=true}if(u["*"]){if(((u["*"]||{}).value||"").indexOf(i)!=-1||(u["*"]||{}).value=="*")c=true}}))}));if(c)return true}else if(o[t]){o[t].forEach((function(e){if(u[e.name]){if(((u[e.name]||{}).value||"").indexOf(i)!=-1||(u[e.name]||{}).value=="*")c=true}if(u["*"]){if(((u["*"]||{}).value||"").indexOf(i)!=-1||(u["*"]||{}).value=="*")c=true}}));if(!c)return false;else return true}else return false}else return false},checkAuthroisations:function(e,t,r,n,s){if(s.ignoreAuthorisations==true)return true;var a;if(!t)return true;if(t.spooAdmin)return true;if(Object.keys(t.authorisations||{}).length==0)return true;if(!n&&!t.authorisations["*"]){return false}if(t.authorisations["*"])a=t.authorisations["*"];else if(n&&!t.authorisations[n]){return false}else a=t.authorisations[n];var o=[e];var u={$or:[]};a.forEach((function(e){if(typeof e.query==="string"){try{e.query=JSON.parse(e.query)}catch(t){e.query={}}}if(e.query.$query){e.query=JSON.parse(JSON.stringify(e.query.$query));delete e.query.$query}if(e.perm.indexOf(r)!=-1||e.perm.indexOf("*")!=-1)u.$or.push(e.query)}));console.log("auth query post",u,o,i.query(o,u,i.undot).length);if(u.$or.length==0)return false;if(i.query(o,u,i.undot).length==0)return false;else return true},buildPermissionQuery:function(e,t,r,i){if(i.ignorePermissions==true)return e;if(e.$query){e=JSON.parse(JSON.stringify(e.$query));delete e.$query}if(!t.spooAdmin){if(e.$sum||e.$count||e.$avg)return e;if(!t.privileges)return e;if(r&&t.privileges[r]){var n=[];t.privileges[r].forEach((function(e){var t={};t["permissions."+e.name+".value"]={$regex:"r"};n.push(t);t={};t["permissions."+e.name+".value"]="*";n.push(t);t={};t["permissions.name"]=e.name;n.push(t)}));var s={};s["permissions.*"+".value"]={$regex:"r"};n.push(s);s={};s["permissions.*"]={$regex:"r"};n.push(s);s={};s["permissions.*"+".value"]="*";n.push(s);if(Object.keys(e).length>0){return{$and:[e,{$or:n}]}}else{return{$or:n}}}else if(!r){return e}else return e}else{return e}},buildAuthroisationQuery:function(e,t,r,i,n){if(n.ignoreAuthorisations==true)return e;var s;if(!t)return e;if(t.spooAdmin)return e;if(e.$sum||e.$count||e.$avg)return e;function throwError(){throw new Error("Lack of permissions")}if(Object.keys(t.authorisations||{}).length==0)return e;if(!i&&!t.authorisations["*"]){throwError()}if(t.authorisations["*"])s=t.authorisations["*"];else if(i&&!t.authorisations[i]){throwError()}else s=t.authorisations[i];if(e.$query){e=JSON.parse(JSON.stringify(e.$query));delete e.$query}var a=[e];var o=[];var u=false;s.forEach((function(t){try{t.query=JSON.parse(t.query)}catch(e){}if(t.query.$query){t.query=JSON.parse(JSON.stringify(t.query.$query));delete t.query.$query}if(t.perm.indexOf(r)!=-1||t.perm.indexOf("*")!=-1){if(Object.keys(t.query).length==0)u=true;else{o.push({$and:[t.query,e]})}}}));if(o.length==0&&!u)throw new Error("Lack of permissions");o={$or:o};return o},chainPermission:function(t,r,i,n,s){if(["c","r","u","d","x"].includes(i)){}else i="u";if(t.permissions){if(Object.keys(t.permissions).length>0){if(!r.permissionSequence[t._id])r.permissionSequence[t._id]=[];if(!e.checkPermissions(r.activeUser,r.activeApp,t,i,true,r))r.permissionSequence[t._id].push({name:n,key:s})}}},getElementPermisson:function(e){if(!e)return{};else if(!e.permissions)return{};else return e.permissions}}}},602:(e,t,r)=>{var i=r(511);e.exports=function(e){return{Objs:function(t,r,n,s,a){var o=this;if(typeof t==="object"&&!Array.isArray(t)){var a=a||{};Object.keys(t).forEach((function(e){if(["$page","$sort","$pageSize"].indexOf(e)!=-1){a[e]=t[e];delete t[e]}}));t=e.buildAuthroisationQuery(t,n.activeUser,"r",n.activeApp,n);if(n.activeUser)t=e.buildPermissionQuery(t,n.activeUser,n.activeApp,n);Object.getPrototypeOf(this).get=function(o,u){return new Promise(((c,f)=>{var l=n.activeTenant;var h=n.activeApp;var d=this;var p=0;e.findObjects(t,r,(function(t){var r;for(r=0;r<t.length;r++){if(e[t[r].role])t[r]=e[t[r].role](e.deserialize(t[r]))}if(s.templateMode==i.TEMPLATEMODES.STRICT){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return}if(t.length==0){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return}t.forEach((function(r){e.applyAffects(r,null,n,l);if(!r.inherits)r.inherits=[];var i=0;if(r.inherits.length==0){p++;if(p==t.length){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return r}}r.inherits.forEach((function(a){if(r._id!=a){e.getTemplateFieldsForObject(r,a,(function(){i++;if(i==r.inherits.length)p++;if(p==t.length){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return r}}),(function(n){i++;if(i==r.inherits.length)p++;if(p==t.length){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return r}}),l,s.templateFamily,s.templateSource,s,n)}else{if(r.inherits.length==1){if(o)o(e.deSerializePropsObjectMulti(t,s));else{c(e.deSerializePropsObjectMulti(t,s))}return r}else{i++;return}}}))}))}),(function(e){if(u)u(e);else{f(e)}}),h,l,a||{},s,n)}))};Object.getPrototypeOf(this).count=function(i,o){return new Promise(((u,c)=>{var f=n.activeTenant;var l=n.activeApp;var h=this;var d=0;e.countObjects(t,r,(function(e){if(i)i(e);else{u(e)}}),(function(e){if(o)o(e);else{c(e)}}),l,f,a||{},s,n);return}))}}else if(Array.isArray(t)){Object.getPrototypeOf(this).add=function(a,o){return new Promise(((u,c)=>{var f=n.activeTenant;var l=n.activeApp;var h;var d=0;for(h=0;h<t.length;h++){t[h]=e[r](t[h]).add((function(r){e.applyAffects(r,"onCreate",n,f);if(s.templateMode==i.TEMPLATEMODES.STRICT){var l=0;if(r.inherits.length==0){d++;if(d==t.length){if(a)a(t);else{u(t)}return r}}r.inherits.forEach((function(i){if(r._id!=i){e.getTemplateFieldsForObject(r,i,(function(){l++;if(l==r.inherits.length)d++;if(d==t.length){if(a)a(t);else{u(t)}return r}}),(function(e){if(o)o(e);else{c(e)}return r}),f,s.templateFamily,s.templateSource,s,n)}else{if(r.inherits.length==1){if(a)a(t);else{u(t)}return r}else{l++;return}}}))}else{d++;if(d==t.length){if(a)a(t);else{u(t)}return r}}}),(function(e){if(o)o(e);else{c(e)}}))}}))};return this}else{if(s.authMethod)Object.getPrototypeOf(this).auth=s.authMethod;else{Object.getPrototypeOf(this).auth=function(e,t,r,i,a){return new Promise(((i,a)=>{var o={username:e.username};if(n.authableFields){o={$or:[]};n.authableFields.forEach((function(t){var r={};r[t]=e[t];if(r[t])o.$or.push(r)}));if(Object.keys(o.$or).length==0)o={username:e.username}}n[s.pluralName](o).get((function(e){if(e.length==0)r("User not found");if(t)t(e[0]);else{i(e[0])}}),(function(e){if(r)r(e);else{a(e)}}))}))}}}}}}},135:(e,t,r)=>{var i=r(511);var n=r(204);var s=r(456);var isObject=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{PropertyRefParser:function(t,r,i,n){var a=t.getProperties();try{propertyToReturn=a[r]}catch(e){}if(!propertyToReturn)throw new s.PropertyNotFoundException(r);if(!propertyToReturn.type=="objectRef")throw new s.PropertyNotFoundException(r);return e.getObjectByIdSyn(propertyToReturn.value)},EventParser:function(e,t){var r;function getValue(e,t){if(typeof t=="string"){t=t.split(".")}if(t.length>1){getValue(e.events[t.shift()],t)}else{try{var i=e.events[t[0]].type}catch(e){throw new s.NoSuchEventException(propertyName)}r=e.events[t[0]]}}getValue(e,t);return r},PropertyBagItemQueryRemover:function(e,t){function removeQuery(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeQuery(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new s.NoSuchPropertyException(t);if(!e[r[0]].query)throw new s.NoSuchPermissionException(permissionKey);delete e[r[0]].query;return}}removeQuery(e,t)},PropertyBagItemConditionsRemover:function(e,t){function removeConditions(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeConditions(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new s.NoSuchPropertyException(t);if(!e[r[0]].conditions)throw new s.NoSuchPermissionException(permissionKey);delete e[r[0]].conditions;return}}removeConditions(e,t)},PropertyBagItemOnChangeRemover:function(e,t,r){function removeOnChange(e,i){if(typeof i=="string"){i=i.split(".")}if(i.length>1){removeOnChange(e[i.shift()],i)}else{if(!e.hasOwnProperty(i[0]))throw new s.NoSuchPropertyException(t);if(!e[i[0]].onChange[r])throw new s.HandlerNotFoundException(r);delete e[i[0]].onChange[r];return}}removeOnChange(e,t)},PropertyBagItemMetaRemover:function(e,t){var r=this;var i;function removeOnChange(e,r){if(typeof r=="string"){r=r.split(".")}if(r.length>1){removeOnChange(e[r.shift()],r)}else{if(!e.hasOwnProperty(r[0]))throw new s.NoSuchPropertyException(t);if(!e[r[0]].meta)throw new s.NoSuchPermissionException(permissionKey);delete e[r[0]].meta;return}}removeOnChange(e,t)},PropertyBagItemOnCreateRemover:function(e,t,r){function removeOnCreate(e,i){if(typeof i=="string"){i=i.split(".")}if(i.length>1){removeOnCreate(e[i.shift()],i)}else{if(!e.hasOwnProperty(i[0]))throw new s.NoSuchPropertyException(t);if(!e[i[0]].onCreate)throw new s.HandlerNotFoundException;if(!e[i[0]].onCreate[r])throw new s.HandlerNotFoundException;delete e[i[0]].onCreate[r];return}}removeOnCreate(e,t)},PropertyBagItemOnDeleteRemover:function(e,t,r){function removeOnDelete(e,i){if(typeof i=="string"){i=i.split(".")}if(i.length>1){removeOnDelete(e[i.shift()],i)}else{if(!e.hasOwnProperty(i[0]))throw new s.NoSuchPropertyException(t);if(!e[i[0]].onDelete[r])throw new s.HandlerNotFoundException(r);delete e[i[0]].onDelete[r];return}}removeOnDelete(e,t)},PropertyBagItemPermissionRemover:function(t,r,i,n){function removePermission(t,a){if(typeof a=="string"){a=a.split(".")}if(a.length>1){removePermission(t[a.shift()],a)}else{if(!t.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(r);if(!t[a[0]].permissions)throw new s.NoSuchPermissionException(i);if(!t[a[0]].permissions[i])throw new s.NoSuchPermissionException(i);e.chainPermission(t,n,"x","removePropertyPermission",r);delete t[a[0]].permissions[i];return}}removePermission(t,r)},PropertyBagItemRemover:function(t,r,i,n){var a=t[i.propsObject]||t;function getValue(i,a){if(typeof a=="string"){a=a.split(".")}if(a.length>1){getValue(i[a.shift()],a)}else{if(!i.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(r);if(i[a[0]].onDelete){if(Object.keys(i[a[0]].onDelete).length>0){if(!n.handlerSequence[i._id])n.handlerSequence[t._id]={};if(!n.handlerSequence[i._id].onDelete)n.handlerSequence[t._id].onDelete=[];n.handlerSequence[i._id].onDelete.push(i[a[0]].onDelete)}}e.chainPermission(i[a[0]],n,"d","removeProperty",r);delete i[a[0]];return}}getValue(a,r)},PropertyParser:function(t,r,i,n){var a=this;var o=t[n.propsObject]||t;var u;function getValue(e,t){var i=e;if(typeof t=="string"){t=t.split(".")}if(t.length>1){getValue(i[t.shift()],t)}else{if(!i.hasOwnProperty(t[0]))throw new s.NoSuchPropertyException(r);u=i[t[0]]}}getValue(o,r);if(u.type=="action"){u.call=function(r,n){e.checkAuthroisations(t,i.activeUser,"x",i.activeApp);a.execProcessorAction(u.value||u.action,t,u,{},r,n,{})}}return u},ValuePropertyMetaSubstituter:function(e){if(typeof e!=="undefined")if(typeof e.value==="undefined")e.value=null},PropertyCreateWrapper:function(t,r,a,o,u,c){if(u.propsObject&&!t[u.propsObject]&&!a)t[u.propsObject]={};r=Object.assign({},r);var f=t[u.propsObject]||t;var l=Object.keys(r)[0];var h=null;if(typeof r!=="object"){throw new s.InvalidFormatException}if(c&&f.hasOwnProperty(l)&&!e.predefinedProperties.includes(l))throw new s.DuplicatePropertyException(l);switch((r[l]||{}).type){case undefined:f[l]=r[l];break;case i.PROPERTY.TYPE_SHORTTEXT:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_LONGTEXT:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_INDEXEDTEXT:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_JSON:if(r[l].value){if(typeof r[l].value==="string"){try{f[l].value=JSON.parse(f[l].value)}catch(e){}}else{}}f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_NUMBER:if(r[l].value!=""){if(r[l].value!=null)if(isNaN(r[l].value))throw new s.InvalidValueException(r[l].value,i.PROPERTY.TYPE_NUMBER)}r[l].value=+r[l].value;f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_EVENT:e.chainPermission(t,o,"evt","addProperty (Event)",l);var d={};var p=l;d[p]=r[l];if(!d[p].eventId)d[p].eventId=e.ID();if(!d[p].reminders)d[p].reminders={};if(d[p].interval!==undefined){if(d[p].lastOccurence==undefined)d[p].lastOccurence=null;else if(!n(d[p].lastOccurence).isValid())throw new s.InvalidDateException(d[p].lastOccurence);else d[p].lastOccurence=n(d[p].lastOccurence).utc().format();if(d[p].nextOccurence==undefined)d[p].nextOccurence=n().toISOString();if(d[p].action===undefined)d[p].action="";if(d[p].interval===undefined)throw new s.MissingAttributeException("interval");d[p].nextOccurence=n(d[p].lastOccurence||n().utc()).utc().add(d[p].interval).toISOString();o.eventAlterationSequence.push({operation:"add",obj:t,propName:l,property:r,date:d[p].nextOccurence})}else if(d[p].date!==undefined){if(d[p].date==null)d[p].date=n().utc().toISOString();if(!d[p].date)throw new s.MissingAttributeException("date");try{d[p].date=n(d[p].date).utc().format()}catch(e){}o.eventAlterationSequence.push({operation:"add",obj:t,propName:l,property:r,date:d[p].date});if(!d[p].action)d[p].action=""}else{}f[l]=d[p];break;case i.PROPERTY.TYPE_DATE:if(!r[l].value||r[l].value=="")r[l].value=null;f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_SHORTID:if(!r[l].value||r[l].value=="")r[l].value=e.RANDOM();if(t.role=="template")r[l].value=null;f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_REF_OBJ:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_REF_USR:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_REF_FILE:f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_PROPERTY_BAG:if(!r[l].properties)r[l].properties={};var m=r[l][u.propsObject]||r[l];var g=Object.keys(m);parentProp=r;f[l]=r[l];f[l].type=i.PROPERTY.TYPE_PROPERTY_BAG;f[l].properties={};g.forEach((function(t){tmpProp={};tmpProp[t]=m[t];new e.PropertyCreateWrapper(f[l],Object.assign({},tmpProp),true,o,u)}));break;case i.PROPERTY.TYPE_ARRAY:if(!r[l].properties)r[l].properties={};var m=r[l][u.propsObject]||r[l];var g=Object.keys(m);parentProp=r;f[l]={type:i.PROPERTY.TYPE_ARRAY,properties:{},query:r[l].query,meta:r[l].meta};g.forEach((function(t){tmpProp={};tmpProp[t]=m[t];new e.PropertyCreateWrapper(f[l],Object.assign({},tmpProp),true,o,u)}));break;case i.PROPERTY.TYPE_BOOLEAN:if(!typeof r[l].value==="boolean")throw new s.InvalidValueException(r[l].value,i.PROPERTY.TYPE_BOOLEAN);f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;case i.PROPERTY.TYPE_ACTION:e.chainPermission(t,o,"act","addProperty (Action)",l);if(r[l].value){if(typeof r[l].value!=="string")throw new s.InvalidValueException(r[l].value,i.PROPERTY.TYPE_ACTION)}f[l]=r[l];e.ValuePropertyMetaSubstituter(f[l]);break;default:throw new s.InvalidTypeException(r[l].type)}if((r[l]||{}).onCreate){if(Object.keys(r[l].onCreate).length>0){if(!o.handlerSequence[t._id])o.handlerSequence[t._id]={};if(!o.handlerSequence[t._id].onCreate)o.handlerSequence[t._id].onCreate=[];o.handlerSequence[t._id].onCreate.push({handler:r[l].onCreate,prop:r[l]})}}if(c)e.chainPermission(t,o,"p","addProperty",l)},PropertyQuerySetWrapper:function(e,t,r,i){var n=e[i.propsObject]||e;function setValue(e,i,n){var a=e;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setValue(a[i.shift()],i,n)}else{if(!a.hasOwnProperty(i[0]))throw new s.NoSuchPropertyException(t);if(typeof n!=="object")throw new s.InvalidDataTypeException(n,"object");a[i[0]].query=r}}setValue(n,t,r)},PropertyMetaSetWrapper:function(e,t,r,i){var n=e[i.propsObject]||e;function setMeta(e,r,i){var n=e;if(typeof r=="string"){r=r.split(".")}if(r.length>1){setMeta(n[r.shift()],r,i)}else{if(!n.hasOwnProperty(r[0]))throw new s.NoSuchPropertyException(t);if(n[r[0]].template)n[r[0]].metaOverwritten=true;n[r[0]].meta=i}}setMeta(n,t,r)},PropertyOnChangeSetWrapper:function(t,r,i,n,a,o,u,c){var f=t[c.propsObject]||t;function setOnChange(t,n,c){var f=t;if(typeof n=="string"){n=n.split(".")}if(n.length>1){setOnChange(f[n.shift()],n,c)}else{if(!f.hasOwnProperty(n[0]))throw new s.NoSuchPropertyException(r);if(!f[n[0]].onChange)f[n[0]].onChange={};if(!f[n[0]].onChange[i])f[n[0]].onChange[i]={};if(f[n[0]].onChange[i].template)f[n[0]].onChange[i].overwritten=true;f[n[0]].onChange[i].value=c;f[n[0]].onChange[i].trigger=a||"after";f[n[0]].onChange[i].type=o||"async";e.chainPermission(f[n[0]],u,"w","setPropertyOnChangeHandler",i)}}setOnChange(f,r,n)},PropertyOnCreateSetWrapper:function(t,r,i,n,a,o,u,c){var f=t[c.propsObject]||t;function setOnCreate(t,n,c){var f=t;if(typeof n=="string"){n=n.split(".")}if(n.length>1){setOnCreate(f[n.shift()],n,c)}else{if(!f.hasOwnProperty(n[0]))throw new s.NoSuchPropertyException(r);if(!f[n[0]].onCreate)f[n[0]].onCreate={};if(!f[n[0]].onCreate[i])f[n[0]].onCreate[i]={};if(f[n[0]].onCreate[i].templateId)f[n[0]].onCreate[i].overwritten=true;f[n[0]].onCreate[i].value=c;f[n[0]].onCreate[i].trigger=a||"after";f[n[0]].onCreate[i].type=o||"async";e.chainPermission(f[n[0]],u,"v","setPropertyOnCreateHandler",i)}}setOnCreate(f,r,n)},PropertyOnDeleteSetWrapper:function(t,r,i,n,a,o,u,c){var f=t[c.propsObject]||t;function setOnDelete(t,n,c){var f=t;if(typeof n=="string"){n=n.split(".")}if(n.length>1){setOnDelete(f[n.shift()],n,c)}else{if(!f.hasOwnProperty(n[0]))throw new s.NoSuchPropertyException(r);if(!f[n[0]].onDelete)f[n[0]].onDelete={};if(!f[n[0]].onDelete[i])f[n[0]].onDelete[i]={};if(f[n[0]].onDelete[i].template)f[n[0]].onDelete[i].overwritten=true;f[n[0]].onDelete[i].value=c;f[n[0]].onDelete[i].trigger=a||"after";f[n[0]].onDelete[i].type=o||"async";e.chainPermission(f[n[0]],u,"z","setPropertyOnDeleteHandler",i)}}setOnDelete(f,r,n)},PropertyConditionsSetWrapper:function(e,t,r,i){var n=e[i.propsObject]||e;function setConditions(e,r,i){var n=e;if(typeof r=="string"){r=r.split(".")}if(r.length>1){setConditions(n[r.shift()],r,i)}else{if(!n.hasOwnProperty(r[0]))throw new s.NoSuchPropertyException(t);n[r[0]].conditions=i}}setConditions(n,t,r)},PropertyPermissionSetWrapper:function(t,r,i,n,a){var o=t[a.propsObject]||t;function setPermission(t,i,a){var o=t;if(typeof i=="string"){i=i.split(".")}if(i.length>1){setPermission(o[i.shift()],i,a)}else{if(!o.hasOwnProperty(i[0]))throw new s.NoSuchPropertyException(r);var u=Object.keys(a)[0];if(!o[i[0]].permissions)o[i[0]].permissions={};o[i[0]].permissions[u]=a[u];e.chainPermission(o[i[0]],n,"x","setPropertyPermission",r)}}setPermission(o,r,i)},PropertySetWrapper:function(t,r,n,a,o){var u=t[o.propsObject]||t;function setValue(t,o,u){var c=t;if(typeof o=="string"){o=o.split(".")}if(o.length>1){var f=o.shift();try{if(c[f].type){if(c[f].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(c[f].template)c[f].overwritten=true}if(c[f].type==i.PROPERTY.TYPE_ARRAY){if(c[f].template)c[f].overwritten=true}}}catch(e){}setValue(c[f],o,u)}else{if(!c.hasOwnProperty(o[0]))throw new s.NoSuchPropertyException(r);if(c[o[0]].type=="boolean"){if(typeof n!="boolean")throw new s.InvalidValueException(n,c[o[0]].type)}if(c[o[0]].type=="number"){if(isNaN(n))throw new s.InvalidValueException(n,c[o[0]].type)}if(c[o[0]].template)c[o[0]].overwritten=true;c[o[0]].value=n;if(c[o[0]].onChange){if(Object.keys(c[o[0]].onChange).length>0){if(!a.handlerSequence[c._id])a.handlerSequence[c._id]={};if(!a.handlerSequence[c._id].onChange)a.handlerSequence[c._id].onChange=[];a.handlerSequence[c._id].onChange.push({handler:c[o[0]].onChange,prop:c[o[0]]})}}e.chainPermission(c[o[0]],a,"u","setPropertyValue",r)}}setValue(u,r,n)},PropertySetFullWrapper:function(t,r,n,a,o,u){var c=t[u.propsObject]||t;function setValue(t,o,u){var c=t;if(typeof o=="string"){o=o.split(".")}if(o.length>1){var f=o.shift();try{if(c[f].type){if(c[f].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(c[f].template)c[f].overwritten=true}if(c[f].type==i.PROPERTY.TYPE_ARRAY){if(c[f].template)c[f].overwritten=true}}}catch(e){}setValue(c[f],o,u)}else{if((c[o[0]]||{}).type=="boolean"){if(typeof n!="boolean")throw new s.InvalidValueException(n,(c[o[0]]||{}).type)}if((c[o[0]]||{}).type=="number"){if(isNaN(n))throw new s.InvalidValueException(n,(c[o[0]]||{}).type)}if((c[o[0]]||{}).template)c[o[0]].overwritten=true;c[o[0]]=n;if(c[o[0]].onChange){if(Object.keys(c[o[0]].onChange).length>0){if(!a.handlerSequence[c._id])a.handlerSequence[c._id]={};if(!a.handlerSequence[c._id].onChange)a.handlerSequence[c._id].onChange=[];a.handlerSequence[c._id].onChange.push({handler:c[o[0]].onChange,prop:c[o[0]]})}}e.chainPermission(c[o[0]],a,"u","setProperty",r)}}setValue(c,r,n)},EventIntervalSetWrapper:function(t,r,a,o,u,c){var f=t[c.propsObject]||t;var l=t.getProperty(r);if(l.type!=i.PROPERTY.TYPE_EVENT)throw new s.NotAnEventException(r);function setValue(t,o,c){var f=t;if(typeof o=="string"){o=o.split(".")}if(o.length>1){var l=o.shift();try{if(f[l].type){if(f[l].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(f[l].template)f[l].overwritten=true}if(f[l].type==i.PROPERTY.TYPE_ARRAY){if(f[l].template)f[l].overwritten=true}}}catch(e){}setValue(f[l],o,c)}else{if(!f.hasOwnProperty(o[0]))throw new s.NoSuchPropertyException(r);if(f[o[0]].template)f[o[0]].overwritten=true;delete f[o[0]].date;f[o[0]].interval=a;if(f[o[0]].lastOccurence){var h=n(f[o[0]].lastOccurence).utc().add(a);u.eventAlterationSequence.push({operation:"remove",obj:t,propName:r,property:f[o[0]],date:h});u.eventAlterationSequence.push({operation:"add",obj:t,propName:r,property:f[o[0]],date:h})}e.chainPermission(f[o[0]],u,"u","setEventInterval",r)}}setValue(f,r,a)},EventTriggeredSetWrapper:function(e,t,r,a,o){var u=e[o.propsObject]||e;var c=e.getProperty(t);if(c.type!=i.PROPERTY.TYPE_EVENT)throw new s.NotAnEventException(t);function setValue(e,a,o){var u=e;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var c=a.shift();try{if(u[c].type){if(u[c].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(u[c].template)u[c].overwritten=true}if(u[c].type==i.PROPERTY.TYPE_ARRAY){if(u[c].template)u[c].overwritten=true}}}catch(e){}setValue(u[c],a,o)}else{if(!u.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(t);if(u[a[0]].interval)u[a[0]].nextOccurence=n().utc().add(u[a[0]].interval).toISOString();else u[a[0]].triggered=r}}setValue(u,t,r)},EventLastOccurenceSetWrapper:function(e,t,r,a,o){var u=e[o.propsObject]||e;var c=e.getProperty(t);if(c.type!=i.PROPERTY.TYPE_EVENT)throw new s.NotAnEventException(t);function setValue(e,a,o){var u=e;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var c=a.shift();try{if(u[c].type){if(u[c].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(u[c].template)u[c].overwritten=true}if(u[c].type==i.PROPERTY.TYPE_ARRAY){if(u[c].template)u[c].overwritten=true}}}catch(e){}setValue(u[c],a,o)}else{if(!u.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(t);u[a[0]].lastOccurence=r;u[a[0]].nextOccurence=n(r).utc().add(n.duration(u[a[0]].interval)).toISOString()}}setValue(u,t,r)},EventDateSetWrapper:function(t,r,n,a,o,u){var c=t[u.propsObject]||t;function setValue(t,a,u){var c=t;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var f=a.shift();try{if(c[f].type){if(c[f].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(c[f].template)c[f].overwritten=true}if(c[f].type==i.PROPERTY.TYPE_ARRAY){if(c[f].template)c[f].overwritten=true}}}catch(e){}setValue(c[f],a,u)}else{if(!c.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(r);if(c[a[0]].template)c[a[0]].overwritten=true;delete c[a[0]].interval;delete c[a[0]].lastOccurence;delete c[a[0]].nextOccurence;c[a[0]].date=n;o.eventAlterationSequence.push({operation:"remove",obj:t,propName:r,property:c[a[0]],date:n});o.eventAlterationSequence.push({operation:"add",obj:t,propName:r,property:c[a[0]],date:n});e.chainPermission(c[a[0]],o,"u","setEventDate",r)}}setValue(c,r,n)},EventActionSetWrapper:function(t,r,n,a,o,u){var c=t[u.propsObject]||t;function setValue(t,a,u){var c=t;if(typeof a=="string"){a=a.split(".")}if(a.length>1){var f=a.shift();try{if(c[f].type){if(c[f].type==i.PROPERTY.TYPE_PROPERTY_BAG){if(c[f].template)c[f].overwritten=true}if(c[f].type==i.PROPERTY.TYPE_ARRAY){if(c[f].template)c[f].overwritten=true}}}catch(e){}setValue(c[f],a,u)}else{if(!c.hasOwnProperty(a[0]))throw new s.NoSuchPropertyException(r);if(c[a[0]].template)c[a[0]].overwritten=true;c[a[0]].action=n;e.chainPermission(c[a[0]],o,"u","setEventAction",r)}}setValue(c,r,n)}}}},658:(e,t,r)=>{var i=r(204);var n=r(511);var s=r(456);var isObject=function(e){return!!e&&e.constructor===Object};e.exports=function(e){return{Obj:function(t,r,a,o){if(a.metaPropPrefix!=""&&typeof t!=="string")t=e.serialize(t);if(!t)t={};if(t._id)this._id=t._id;if(typeof t==="string"){this._id=t}if(t===undefined)t={};this.role=r||"object";if(o.extendedStructure){for(var u in o.extendedStructure){if(o.extendedStructure[u]===null)this[u]=t[u];else if(o.extendedStructure[u]==="$useForProps"){o.propsObject=u;e.PropertiesChecker(this,t[o.propsObject],a,o)}else this[u]=o.extendedStructure[u];if(!e.predefinedProperties.includes(u))e.predefinedProperties.push(u)}}if(o.hasAffects){this.affects=e.AffectsCreateWrapper(this,t.affects,a);this.apply=e.ApplyCreateWrapper(this,t.apply,a)}this._constraints=t._constraints;this.applications=e.ApplicationsChecker(this,t.applications);this.inherits=e.InheritsChecker(this,t.inherits);this.onCreate=e.ObjectOnCreateCreateWrapper(this,t.onCreate,a);this.onChange=e.ObjectOnChangeCreateWrapper(this,t.onChange,a);this.onDelete=e.ObjectOnDeleteCreateWrapper(this,t.onDelete,a);this.created=t.created||i().utc().toDate().toISOString();this.lastModified=t.lastModified||i().utc().toDate().toISOString();if(!o.propsObject)e.PropertiesChecker(this,t,a,o);this.permissions=e.ObjectPermissionsCreateWrapper(this,t.permissions);this._aggregatedEvents=t._aggregatedEvents;this.authorisations=t.authorisations||undefined;if(o.authable){this.username=t.username||null;this.email=t.email||null;this.password=t.password||null;this.spooAdmin=t.spooAdmin;delete this.name;this.setUsername=function(t){this.username=t;e.chainPermission(this,a,"o","setUsername",t);a.alterSequence.push({setUsername:arguments});return this};this.setEmail=function(t){this.email=t;e.chainPermission(this,a,"h","setEmail",t);a.alterSequence.push({setEmail:arguments});return this};this.setPassword=function(e){this.password=e;a.alterSequence.push({setPassword:arguments});return this};this.setAuthorisation=function(t){new e.ObjectAuthorisationSetWrapper(this,t,a);a.alterSequence.push({setAuthorisation:arguments});return this};this.removeAuthorisation=function(t){new e.ObjectAuthorisationRemoveWrapper(this,t,a);a.alterSequence.push({removeAuthorisation:arguments});return this}}if(o.authable||o.authableTemplate){this.privileges=e.PrivilegesChecker(t)||{};this._clients=t._clients;this.addPrivilege=function(t){if(a.activeApp){var r={};r[a.activeApp]={name:t};new e.PrivilegeChecker(this,r);a.alterSequence.push({addPrivilege:arguments});return this}else throw new Error("Invalid app id");return this};this.removePrivilege=function(t){new e.PrivilegeRemover(this,t,a);a.alterSequence.push({removePrivilege:arguments});return this};this.addClient=function(e){if(this._clients.indexOf(e)!=-1)throw new Error("Client "+e+" already exists");this._clients.push(e);a.alterSequence.push({addClient:arguments});return this};this.removeClient=function(e){if(this._clients.indexOf(e)==-1)throw new Error("Client "+e+" does not exist");this._clients.splice(this._clients.indexOf(e),1);a.alterSequence.push({removeClient:arguments});return this}}Object.getPrototypeOf(this).addInherit=function(t){e.addTemplateToObject(this,t,a);a.alterSequence.push({addInherit:arguments});return this};Object.getPrototypeOf(this).removeInherit=function(t,r,i){e.removeTemplateFromObject(this,t,(function(e){if(r)r(t)}),(function(e){if(i)i(e)}),a);a.alterSequence.push({removeInherit:arguments});return this};Object.getPrototypeOf(this).addApplication=function(t){e.addApplicationToObject(this,t,a);a.alterSequence.push({addApplication:arguments});return this};Object.getPrototypeOf(this).removeApplication=function(t){e.removeApplicationFromObject(this,t,a);a.alterSequence.push({removeApplication:arguments});return this};Object.getPrototypeOf(this).replace=function(t){t=e[this.role](t);var r=this;if(r.role!=t.role)throw new Error("cannot alter role");Object.keys(this).forEach((function(e){if(r[e]instanceof Function||e=="_id")return;delete r[e]}));function doTheProps(e,t){Object.keys(t).forEach((function(r){if(t[r]==null||t[r]===undefined)return;e[r]=t[r];if(typeof t[r]==="object"){doTheProps(e[r],t[r])}}))}doTheProps(r,t);return r};Object.getPrototypeOf(this).addProperty=function(t,r){var i={};i[t]=r;r=i;var n=Object.keys(r)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};f[c]=r[n];this.addPropertyToBag(u,f);return}new e.PropertyCreateWrapper(this,r,false,a,o,true);a.alterSequence.push({addProperty:arguments});return this};Object.getPrototypeOf(this).setOnChange=function(t,r){if(typeof r!=="object")throw new s.InvalidArgumentException;var i=t;new e.ObjectOnChangeSetWrapper(this,i,r.value,r.trigger,r.type,a);a.alterSequence.push({setOnChange:arguments});return this};Object.getPrototypeOf(this).setOnDelete=function(t,r){if(typeof r!=="object")throw new s.InvalidArgumentException;var i=t;new e.ObjectOnDeleteSetWrapper(this,i,r.value,r.trigger,r.type,a);a.alterSequence.push({setOnDelete:arguments});return this};Object.getPrototypeOf(this).setOnCreate=function(t,r){if(typeof r!=="object")throw new s.InvalidArgumentException;var i=t;new e.ObjectOnCreateSetWrapper(this,i,r.value,r.trigger,r.type,a);a.alterSequence.push({setOnCreate:arguments});return this};Object.getPrototypeOf(this).removeOnChange=function(e){if(!this.onChange[e])throw new s.HandlerNotFoundException(e);else delete this.onChange[e];a.alterSequence.push({removeOnChange:arguments});return this};Object.getPrototypeOf(this).removeOnDelete=function(e){if(!this.onDelete[e])throw new s.HandlerNotFoundException(e);else delete this.onDelete[e];a.alterSequence.push({removeOnDelete:arguments});return this};Object.getPrototypeOf(this).removeOnCreate=function(e){if(!this.onCreate[e])throw new s.HandlerNotFoundException(e);else delete this.onCreate[e];a.alterSequence.push({removeOnCreate:arguments});return this};Object.getPrototypeOf(this).setPermission=function(t,r){var i={};i[t]=r;r=i;new e.ObjectPermissionSetWrapper(this,r,a);a.alterSequence.push({setPermission:arguments});return this};Object.getPrototypeOf(this).removePermission=function(t){new e.ObjectPermissionRemoveWrapper(this,t,a);a.alterSequence.push({removePermission:arguments});return this};Object.getPrototypeOf(this).setPropertyValue=function(t,r,i){new e.PropertySetWrapper(this,t,r,a,o);a.alterSequence.push({setPropertyValue:arguments});return this};Object.getPrototypeOf(this).setProperty=function(t,r,i){new e.PropertySetFullWrapper(this,t,r,a,false,o);a.alterSequence.push({setProperty:arguments});return this};Object.getPrototypeOf(this).makeProperty=function(t,r,i){new e.PropertySetFullWrapper(this,t,r,a,true,o);a.alterSequence.push({makeProperty:arguments});return this};Object.getPrototypeOf(this).setEventDate=function(t,r,i){var n=Object.keys(t)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};this.setBagEventDate(u,c,r,i);return}new e.EventDateSetWrapper(this,t,r,i,a,o);a.alterSequence.push({setEventDate:arguments});return this};Object.getPrototypeOf(this).setEventAction=function(t,r,i){var n=Object.keys(t)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};this.setBagEventAction(u,c,r,i);return}new e.EventActionSetWrapper(this,t,r,i,a,o);a.alterSequence.push({setEventAction:arguments});return this};Object.getPrototypeOf(this).setEventTriggered=function(t,r,i){var n=Object.keys(t)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};this.setBagEventTriggered(u,c,r,i);return}new e.EventTriggeredSetWrapper(this,t,r,i,a,o);a.alterSequence.push({setEventTriggered:arguments});return this};Object.getPrototypeOf(this).setEventLastOccurence=function(t,r,i){var n=Object.keys(t)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};this.setBagEventLastOccurence(u,c,r,i);return}new e.EventLastOccurenceSetWrapper(this,t,r,i,o);a.alterSequence.push({setEventLastOccurence:arguments});return this};Object.getPrototypeOf(this).setEventInterval=function(t,r,i){var n=Object.keys(t)[0];if(n.indexOf(".")!=-1){var s=n.lastIndexOf(".");var u=n.substring(0,s);var c=n.substring(s+1,n.length);var f={};this.setBagEventInterval(u,c,r,i);return}new e.EventIntervalSetWrapper(this,t,r,i,a,o);a.alterSequence.push({setEventInterval:arguments});return this};Object.getPrototypeOf(this).pushToArray=function(e,t){var r=Object.keys(t)[0];var i={};var n;n=shortid.generate();i[n]=t[r];this.addPropertyToBag(e,i);a.alterSequence.push({pushToArray:arguments})};Object.getPrototypeOf(this).setPropertyPermission=function(t,r,i){var n={};n[r]=i;i=n;new e.PropertyPermissionSetWrapper(this,t,i,a,o);a.alterSequence.push({setPropertyPermission:arguments});return this};Object.getPrototypeOf(this).setPropertyOnCreate=function(t,r,i){if(typeof i!=="object")throw new s.InvalidArgumentException;var n=r;new e.PropertyOnCreateSetWrapper(this,t,n,i.value,i.trigger,i.type,a,o);a.alterSequence.push({setPropertyOnCreate:arguments});return this};Object.getPrototypeOf(this).removePropertyOnCreate=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnCreateFromBag(e,t);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].onCreate)throw new s.NoOnCreateException;if(!this[e].onCreate[t])throw new s.NoOnCreateException;delete this[e].onCreate[e]}a.alterSequence.push({removePropertyOnCreate:arguments});return this};Object.getPrototypeOf(this).removePropertyOnCreateFromBag=function(t,r){var i=this.getProperty(t);if(this.role=="template"){}new e.PropertyBagItemOnCreateRemover(this,t,r);a.alterSequence.push({removePropertyOnCreateFromBag:arguments});return this};Object.getPrototypeOf(this).setPropertyMeta=function(t,r){new e.PropertyMetaSetWrapper(this,t,r,o);a.alterSequence.push({setPropertyMeta:arguments});return this};Object.getPrototypeOf(this).removePropertyMetaFromBag=function(t){var r=this.getProperty(t);if(this.role=="template"){}new e.PropertyBagItemMetaRemover(this,t);return this};Object.getPrototypeOf(this).removePropertyMeta=function(e){if(e.indexOf(".")!=-1){this.removePropertyMetaFromBag(e);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].meta)throw new s.NoMetaException;delete this[e].meta}a.alterSequence.push({removePropertyMeta:arguments});return this};Object.getPrototypeOf(this).setPropertyOnChange=function(t,r,i){if(typeof i!=="object")throw new s.InvalidArgumentException;var n=r;new e.PropertyOnChangeSetWrapper(this,t,n,i.value,i.trigger,i.type,a,o);a.alterSequence.push({setPropertyOnChange:arguments});return this};Object.getPrototypeOf(this).removePropertyOnChange=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnChangeFromBag(e,t);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].onDelete[t])throw new s.HandlerNotFoundException(t);delete this[e][t]}a.alterSequence.push({removePropertyOnChange:arguments});return this};Object.getPrototypeOf(this).removePropertyOnChangeFromBag=function(t,r){var i=this.getProperty(t);new e.PropertyBagItemOnChangeRemover(this,t,r);return this};Object.getPrototypeOf(this).setPropertyOnDelete=function(t,r,i){if(typeof i!=="object")throw new s.InvalidArgumentException;var n=r;new e.PropertyOnDeleteSetWrapper(this,t,n,i.value,i.trigger,i.type,a,o);a.alterSequence.push({setPropertyOnDelete:arguments});return this};Object.getPrototypeOf(this).removePropertyOnDelete=function(e,t){if(e.indexOf(".")!=-1){this.removePropertyOnDeleteFromBag(e,t);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].onDelete[t])throw new s.HandlerNotFoundException(t);delete this[e].onDelete[t]}a.alterSequence.push({removePropertyOnDelete:arguments});return this};Object.getPrototypeOf(this).removePropertyOnDeleteFromBag=function(t,r){var i=this.getProperty(t);new e.PropertyBagItemOnDeleteRemover(this,t,r);return this};Object.getPrototypeOf(this).setPropertyConditions=function(t,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var n=i.lastIndexOf(".");var s=i.substring(0,n);var u=i.substring(n+1,i.length);var c={};this.setBagPropertyConditions(s,u,r);return}new e.PropertyConditionsSetWrapper(this,t,r,o);a.alterSequence.push({setPropertyConditions:arguments});return this};Object.getPrototypeOf(this).setBagPropertyConditions=function(t,r,i){new e.PropertyConditionsSetWrapper(this.getProperty(t),r,i,o);return this};Object.getPrototypeOf(this).setBagPropertyPermission=function(t,r,i){new e.PropertyPermissionSetWrapper(this.getProperty(t),r,i,o);return this};Object.getPrototypeOf(this).setPropertyQuery=function(t,r){var i=Object.keys(t)[0];if(i.indexOf(".")!=-1){var n=i.lastIndexOf(".");var s=i.substring(0,n);var u=i.substring(n+1,i.length);var c={};this.setBagPropertyQuery(s,u,value);return}new e.PropertyQuerySetWrapper(this,t,r,o);a.alterSequence.push({setPropertyQuery:arguments});return this};Object.getPrototypeOf(this).removePropertyQuery=function(e){if(e.indexOf(".")!=-1){this.removePropertyQueryFromBag(e);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].query)throw new s.NoSuchPermissionException(permissionKey);delete this[e].query}a.alterSequence.push({removePropertyQuery:arguments});return this};Object.getPrototypeOf(this).removePropertyQueryFromBag=function(t){var r=this.getProperty(t);new e.PropertyBagItemQueryRemover(this,t);return this};Object.getPrototypeOf(this).removePropertyConditions=function(e){if(e.indexOf(".")!=-1){this.removePropertyConditionsFromBag(e);return}else{if(!this[e])throw new s.NoSuchPropertyException(e);if(!this[e].conditions)throw new s.NoSuchPermissionException(permissionKey);delete this[e].conditions}return this};Object.getPrototypeOf(this).removePropertyConditionsFromBag=function(t){var r=this.getProperty(t);new e.PropertyBagItemConditionsRemover(this,t);return this};Object.getPrototypeOf(this).setBagPropertyQuery=function(e,t,r){return this};Object.getPrototypeOf(this).removePropertyPermission=function(t,r){if(t.indexOf(".")!=-1){this.removePropertyPermissionFromBag(t,r);return}else{if(!this[t])throw new s.NoSuchPropertyException(t);if(!this[t].permissions[r])throw new s.NoSuchPermissionException(r);e.chainPermission(this,a,"x","removePropertyPermission",r);a.alterSequence.push({removePropertyPermission:arguments});delete this[t].permissions[r]}return this};Object.getPrototypeOf(this).setBagPropertyValue=function(t,r,i,n){new e.PropertySetWrapper(this.getProperty(t),r,i,a,o);return this};Object.getPrototypeOf(this).setBagEventDate=function(t,r,i,n){new e.EventDateSetWrapper(this.getProperty(t),r,i,a,o);return this};Object.getPrototypeOf(this).setBagEventAction=function(t,r,i,n){new e.EventActionSetWrapper(this.getProperty(t),r,i,a,o);return this};Object.getPrototypeOf(this).setBagEventInterval=function(t,r,i,n){new e.EventIntervalSetWrapper(this.getProperty(t),r,i,a,o);return this};Object.getPrototypeOf(this).setBagEventTriggered=function(t,r,i,n){new e.EventTriggeredSetWrapper(this,r,i,n,a,o);return this};Object.getPrototypeOf(this).setBagEventLastOccurence=function(t,r,i,n){new e.EventLastOccurenceSetWrapper(this.getProperty(t),r,i,n,o);return this};Object.getPrototypeOf(this).addPropertyToBag=function(t,r){var i=this.getProperty(t);new e.PropertyCreateWrapper(i,r,true,a,o,true);return this};Object.getPrototypeOf(this).removePropertyFromBag=function(t,r){var i=this.getProperty(t);new e.PropertyBagItemRemover(this,t,o,a);return this};Object.getPrototypeOf(this).removePropertyPermissionFromBag=function(t,r){var i=this.getProperty(t);new e.PropertyBagItemPermissionRemover(this,t,r,a);return this};Object.getPrototypeOf(this).removeProperty=function(t,r){var i=this;if(o.propsObject)i=this[o.propsObject];if(t.indexOf(".")!=-1){this.removePropertyFromBag(t,r);return}else{if(!i[t])throw new s.NoSuchPropertyException(t);var n=Object.assign({},i[t]);if(n.onDelete){if(Object.keys(n.onDelete).length>0){if(!a.handlerSequence[this._id])a.handlerSequence[this._id]={};if(!a.handlerSequence[this._id].onDelete)a.handlerSequence[this._id].onDelete=[];a.handlerSequence[this._id].onDelete.push({handler:n.onDelete,prop:n})}}e.chainPermission(i[t],a,"d","removeProperty",t);a.alterSequence.push({removeProperty:arguments});delete i[t]}return this};Object.getPrototypeOf(this).getId=function(){return this._id};Object.getPrototypeOf(this).getName=function(){return this.name};Object.getPrototypeOf(this).setName=function(t){this.name=t;e.chainPermission(this,a,"n","setName",t);a.alterSequence.push({setName:arguments});return this};Object.getPrototypeOf(this).setType=function(t){this.type=t;e.chainPermission(this,a,"t","setType",t);a.alterSequence.push({setType:arguments});return this};Object.getPrototypeOf(this).getType=function(){return this.type};Object.getPrototypeOf(this).getRef=function(t){return new e.PropertyRefParser(this,t)};Object.getPrototypeOf(this).getProperty=function(t){return e.PropertyParser(this,t,a,o)};Object.getPrototypeOf(this).getProperties=function(){return this[o.propsObject]||this};Object.getPrototypeOf(this).add=function(r,s,u){return new Promise(((u,c)=>{var f=f||a.activeTenant;var l=a.activeApp;var h=this;e.applyAffects(h,"onCreate",a,f,o);if(!e.checkAuthroisations(this,a.activeUser,"c",a.activeApp,a))return s({error:"Lack of Permissions"});if(!this._id)this._id=e.ID();if(o.dirty){var d=e.checkConstraints(t);if(Array.isArray(d)&&s){return s({message:"constraints error: "+d.join(",")})}e.add(h,(function(t){h._id=t._id;e.deSerializePropsObject(t,o);if(r)r(e.deserialize(t));else{u(e.deserialize(t))}delete h.instance}),(function(e){console.warn("err",e,s);if(s)s(e);else{c(e)}}),l,f,o);return e.deserialize(this)}if(h.onCreate){Object.keys(h.onCreate).forEach((function(e){if(h.onCreate[e].trigger=="before"||!h.onCreate[e].trigger){a.execProcessorAction(h.onCreate[e].value||h.onCreate[e].action,h,null,null,(function(e){}),f,null)}}))}this.created=i().utc().toDate().toISOString();this.lastModified=i().utc().toDate().toISOString();h._aggregatedEvents=[];function aggregateAllEvents(e,t){Object.keys(e).forEach((function(r){if(!isObject(e[r]))return;if(e[r].type==n.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[r],t+"."+r)}else{}if(e[r].type==n.PROPERTY.TYPE_EVENT){var s=null;if(e[r].date){if(!e[r].triggered)s=e[r].date;else s=null}else if(e[r].interval){if(e[r].nextOccurence){s=e[r].nextOccurence}else s=i().utc().toISOString()}if(t){a.eventAlterationSequence.push({operation:"add",obj:h,propName:t+"."+r,property:e[r],date:s});var o=false;h._aggregatedEvents.forEach((function(e){if(e.propName==t+"."+r)o=true}));if(!o&&e[r].triggered!=true)h._aggregatedEvents.push({propName:t+"."+r,date:s})}else{a.eventAlterationSequence.push({operation:"add",obj:h,propName:r,property:e[r],date:s});var o=false;h._aggregatedEvents.forEach((function(e){if(e.propName==r)o=true}));if(!o&&e[r].triggered!=true)h._aggregatedEvents.push({propName:r,date:s})}}}))}var p=a.observers[h.role];aggregateAllEvents(h);if(l){if(!this.applications)this.applications=[];if(this.applications)if(this.applications.indexOf(l)==-1)this.applications.push(l)}var addFn=function(t){if(!e.checkPermissions(a.activeUser,a.activeApp,t,"c",false,a))return s({error:"Lack of Permissions"});var i=e.checkConstraints(t);if(Array.isArray(i)&&s){return s({message:"constraints error: "+i.join(",")})}e.add(t,(function(i){e.applyAffects(i,"onCreate",a,f,o);t._id=i._id;if(i.onCreate){Object.keys(i.onCreate).forEach((function(e){if(i.onCreate[e].trigger=="after"){a.execProcessorAction(i.onCreate[e].value||i.onCreate[e].action,i,null,null,(function(e){}),f,null)}}))}if(p.type=="scheduled"){a.eventAlterationSequence.forEach((function(e){if(e.operation=="add"){p.addEvent(t._id,e.propName,e.property,(function(e){}),(function(e){}),a.activeTenant)}else if(e.operation=="remove"){p.addEvent(t._id,e.propName,(function(e){}),(function(e){}),a.activeTenant)}}))}a.eventAlterationSequence=[];e.Logger.log("Added Object: "+JSON.stringify(i,null,2));e.deSerializePropsObject(i,o);if(r)r(e.deserialize(i));else{u(e.deserialize(i))}delete h.instance}),(function(e){if(s)s(e);else{c(e)}}),l,f,o,a)};if(o.templateMode==n.TEMPLATEMODES.STRICT){if(this.inherits.length==0)addFn(h);var m=0;this.inherits.forEach((function(t){if(h._id!=t){e.getTemplateFieldsForObject(h,t,(function(){m++;if(m==h.inherits.length){addFn(h);return this}}),(function(e){if(s)s(h);else{c(h)}return this}),f,o.templateFamily,o.templateSource,o)}}))}else{addFn(h)}return e.deserialize(this)}))};Object.getPrototypeOf(this).update=function(t,r,u){return new Promise(((u,c)=>{var f=f||a.activeTenant;var l=a.activeApp;e.applyAffects(this,"onChange",a,f,o);if(!e.checkAuthroisations(this,a.activeUser,"u",a.activeApp,a))return r({error:"Lack of Permissions"});var h=this;if(o.dirty){var d=e.checkConstraints(this);if(Array.isArray(d)&&r){return r({message:"constraints error: "+d.join(",")})}e.updateO(h,(function(r){delete a.handlerSequence[this._id];a.eventAlterationSequence=[];e.deSerializePropsObject(r,o);a.alterSequence=[];if(t)t(e.deserialize(r));else{u(e.deserialize(r))}}),(function(e){if(r)r(e);else{c(e)}}),l,f,o,a);return e.deserialize(this)}if(!e.checkPermissions(a.activeUser,a.activeApp,h,"u",false,a))return r({error:"Lack of Permissions"});if((a.permissionSequence[h._id]||[]).length>0){throw new s.LackOfPermissionsException(a.permissionSequence[h._id])}if(h.onChange){Object.keys(h.onChange).forEach((function(e){if(h.onChange[e].trigger=="before"){a.execProcessorAction(h.onChange[e].value||h.onChange[e].action,h,null,null,(function(e){}),f,null)}}))}if(a.handlerSequence[this._id]){for(var p in a.handlerSequence[this._id]){for(var m in a.handlerSequence[this._id][p]){var g=a.handlerSequence[this._id][p][m];for(var v in g.handler){if(g.handler[v].trigger=="before"){a.execProcessorAction(g.handler[v].value||g.handler[v].action,h,g.prop,null,(function(e){}),f,null)}}}}}this.lastModified=i().toDate().toISOString();var h=this;h._aggregatedEvents=[];function aggregateAllEvents(e,t){Object.keys(e).forEach((function(r){if(!isObject(e[r]))return;if(e[r].type==n.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[r],t+"."+r)}else{aggregateAllEvents(e[r],r)}if(e[r].type==n.PROPERTY.TYPE_EVENT){var s=null;if(e[r].date){if(!e[r].triggered)s=e[r].date;else s=null}else if(e[r].interval){if(e[r].nextOccurence){s=e[r].nextOccurence}else s=i().utc().toISOString()}if(t){var a=false;h._aggregatedEvents.forEach((function(e){if(e.propName==t+"."+r)a=true}));if(!a&&e[r].triggered!=true)h._aggregatedEvents.push({propName:t+"."+r,date:s})}else{var a=false;h._aggregatedEvents.forEach((function(e){if(e.propName==r)a=true}));if(!a&&e[r].triggered!=true)h._aggregatedEvents.push({propName:r,date:s})}}}))}var y=a.observers[h.role];if(y.type!="scheduled")aggregateAllEvents(this);function updateFn(){var i=e.checkConstraints(h);if(Array.isArray(i)&&r){return r({message:"constraints error: "+i.join(",")})}e.updateO(h,(function(r){e.applyAffects(r,"onChange",a,f,o);if(r.onChange){Object.keys(r.onChange).forEach((function(e){if(r.onChange[e].trigger=="after"){a.execProcessorAction(r.onChange[e].value||r.onChange[e].action,r,null,null,(function(e){}),f,null)}}))}if(a.handlerSequence[h._id]){for(var i in a.handlerSequence[h._id]){for(var s in a.handlerSequence[h._id][i]){var c=a.handlerSequence[h._id][i][s];for(var l in c.handler){if(c.handler[l].trigger=="after"||!c.handler[l].trigger){a.execProcessorAction(c.handler[l].value||c.handler[l].action,h,c.prop,null,(function(e){}),f,null)}}}}}delete a.handlerSequence[h._id];if(y.type=="scheduled"){a.eventAlterationSequence.forEach((function(e){if(e.type=="add"){y.addEvent(h._id,e.propName,e.property,(function(e){}),(function(e){}),a.activeTenant)}}))}a.eventAlterationSequence=[];if(o.templateMode==n.TEMPLATEMODES.STRICT){e.updateInheritedObjs(h,o.pluralName,(function(e){}),(function(e){}),f,o)}e.Logger.log("Updated Object: "+r);e.deSerializePropsObject(r,o);a.alterSequence=[];if(t)t(e.deserialize(r));else{u(e.deserialize(r))}}),(function(e){if(r)r(e);else{c(e)}}),l,f,o,a)}if(a.commandSequence.length>0&&o.templateMode==n.TEMPLATEMODES.STRICT){var O=false;var P=0;a.commandSequence.forEach((function(e){if(e.name=="addInherit"||e.name=="removeInherit"){P++;O=true}}));if(P==0)updateFn(h);var _=0;a.commandSequence.forEach((function(t){if(t.name=="addInherit"&&h.inherits.indexOf(t.value)!=-1){_++;e.getTemplateFieldsForObject(h,t.value,(function(){if(_==P){updateFn(h)}}),(function(e){if(r)r(h);else{c(h)}return h}),f,o.templateFamily,o.templateSource,o,a)}if(t.name=="removeInherit"&&h.inherits.indexOf(t.value)==-1){_++;e.removeTemplateFieldsForObject(h,t.value,(function(){if(_==P){updateFn(h)}}),(function(e){if(r)r(h);else{c(h)}return h}),f,o,a)}}))}else updateFn(h);a.commandSequence=[];return e.deserialize(this)}))};Object.getPrototypeOf(this).remove=function(t,r,s){return new Promise(((s,u)=>{var c=c||a.activeTenant;var f=a.activeApp;var l=JSON.parse(JSON.stringify(this));e.applyAffects(l,"onDelete",a,c,o);if(o.dirty){e.getObjectById(this.role,this._id,(function(i){if(!e.checkAuthroisations(i,a.activeUser,"d",a.activeApp,a))return r({error:"Lack of Permissions"});return e.remove(l,(function(r){e.deSerializePropsObject(i,o);if(t)t(e.deserialize(i));else{s(e.deserialize(i))}}),(function(e){if(r)r(e);else{u(e)}}),f,c)}),(function(e){if(r)r(e);else{u(e)}}),f,c,a,o);return e.deserialize(this)}if(!e.checkPermissions(a.activeUser,a.activeApp,l,"d",false,a))return r({error:"Lack of Permissions"});if(l.onDelete){Object.keys(l.onDelete).forEach((function(e){if(l.onDelete[e].trigger=="before"){a.execProcessorAction(l.onDelete[e].value||l.onDelete[e].action,l,null,null,(function(e){}),c,null)}}))}e.getObjectById(this.role,this._id,(function(h){return e.remove(l,(function(r){e.applyAffects(h,"onDelete",a,c,o);if(l.onDelete){Object.keys(l.onDelete).forEach((function(e){if(l.onDelete[e].trigger=="after"){a.execProcessorAction(l.onDelete[e].value||l.onDelete[e].action,l,null,null,(function(e){}),c,null)}}))}function aggregateAllEvents(e,t){Object.keys(e||{}).forEach((function(r){if(!isObject(e[r]))return;if(e[r].type==n.PROPERTY.TYPE_PROPERTY_BAG)if(t){aggregateAllEvents(e[r],t+"."+r)}else{if(e[r])aggregateAllEvents(e[r],r)}if(e[r].type==n.PROPERTY.TYPE_EVENT){var s=null;if(e[r].date){if(!e[r].date.triggered)s=e[r].date;else s=null}else if(e[r].interval){if(e[r].nextOccurence){s=e[r].nextOccurence}else s=i().utc().toISOString()}if(t){a.eventAlterationSequence.push({operation:"remove",obj:l,propName:t+"."+r,date:s});var o=false}else{a.eventAlterationSequence.push({operation:"remove",obj:l,propName:r,date:s})}}}))}var u=a.observers[l.role];aggregateAllEvents(h||{});if(u.type=="scheduled"){a.eventAlterationSequence.forEach((function(e){if(e.operation=="add"){u.addEvent(h._id,e.propName,e.property,(function(e){}),(function(e){}),a.activeTenant)}else if(e.operation=="remove"){u.removeEvent(h._id,e.propName,(function(e){}),(function(e){console.log(e)}),a.activeTenant)}}))}if(o.templateMode==n.TEMPLATEMODES.STRICT){e.removeInheritedObjs(l,o.pluralName,(function(e){}),(function(e){}),c,o)}e.Logger.log("Removed Object: "+h);e.deSerializePropsObject(h,o);if(t)t(e.deserialize(h));else{s(e.deserialize(h))}}),(function(e){if(r)r(e);else{u(e)}}),f,c,a)}),(function(e){if(r)r(e);else{u(e)}}),f,c,a,o);return e.deserialize(this)}))};Object.getPrototypeOf(this).get=function(t,r,i){return new Promise(((s,u)=>{var c=a.activeTenant;var f=a.activeApp;var l=this;if(o.dirty){e.getObjectById(l.role,l._id,(function(i){e.deSerializePropsObject(i,o);if(!e.checkAuthroisations(i,a.activeUser,"r",a.activeApp,a))return r({error:"Lack of Permissions"});if(t)t(e[i.role](e.deserialize(i)));else{s(e[i.role](e.deserialize(i)))}}),(function(e){if(r)r(e);else{u(e)}}),f,c,a,o);return e.deserialize(this)}var h=0;function prepareObj(u){var f=e[u.role](e.deserialize(u));e.applyAffects(u,null,a,c,o);if(!e.checkAuthroisations(f,a.activeUser,"r",a.activeApp,a))return r({error:"Lack of Permissions",source:"authorisations"});if(!e.checkPermissions(a.activeUser,a.activeApp,u,"r",false,a))return r({error:"Lack of Permissions",source:"permissions"});if(i){if(t)t(f);else{s(f)}return u}if(o.templateMode==n.TEMPLATEMODES.STRICT){if(t)t(f);else{s(f)}return u}if((u.inherits||[]).length==0){if(t)t(e.deSerializePropsObject(f,o));else{s(e.deSerializePropsObject(f,o))}return u}u.inherits.forEach((function(r){if(u._id!=r){e.getTemplateFieldsForObject(u,r,(function(){var r=e[u.role](e.deserialize(u));h++;if(h==u.inherits.length){if(t)t(e.deSerializePropsObject(r,o));else{s(e.deSerializePropsObject(r,o))}return u}}),(function(r){h++;var i=e[u.role](e.deserialize(u));if(h==u.inherits.length){if(t)t(e.deSerializePropsObject(i,o));else{s(e.deSerializePropsObject(i,o))}return u}}),c,o.templateFamily,o.templateSource,o,a)}else{var i=e[u.role](e.deserialize(u));if(l.inherits.length==1){if(t)t(e.deSerializePropsObject(i,o));else{s(e.deSerializePropsObject(i,o))}return u}else{h++;return}}}))}if(a.caches[l.role].data[l._id]){prepareObj(a.caches[l.role].data[l._id])}else{e.getObjectById(l.role,l._id,(function(e){prepareObj(e);if(!a.caches[l.role].data[l._id]){}}),(function(e){if(r)r(e);else{u(e)}}),f,c,a,o)}return e.deserialize(this)}))};const c={get:(e,t)=>{if(typeof e[t]==="object"&&e[t]!==null){return new Proxy(e[t],c)}else{return e[t]}},set:(e,t,r)=>{if(Array.isArray(e)&&t=="length")return true;e[t]=r;this.update();return true},deleteProperty:(e,t,r)=>{delete e[t];this.update();return true}};if(!o.storage){this.add();var f=this;(this.inherits||[]).forEach((function(t){e.getTemplateFieldsForObject(f,t,(function(){}),(function(e){console.log("err",e)}),a.activeTenant,o.templateFamily,o.templateSource,o,a)}));return new Proxy(this,c)}return e.deserialize(this)}}}},883:(e,t,r)=>{var i=r(793);var n=r(434);var s=r(270);e.exports=function(e){return{define:function(t){var r=this;if(typeof t=="string")t={name:t,pluralName:t+"s"};if(!t.name||!t.pluralName){throw new Error("Invalid arguments")}this[t.name]=function(r){return new e.Obj(r,t.name,this,t)};if(this.objectFamilies.indexOf(t.name)==-1)this.objectFamilies.push(t.name);this[t.pluralName]=function(r,i){return new e.Objs(r,t.name,this,t,i)};if(t.storage)this.plugInPersistenceMapper(t.name,t.storage);else this.plugInPersistenceMapper(t.name,r.storage||new i(r));if(t.processor)this.plugInProcessor(t.name,t.processor);else this.plugInProcessor(t.name,r.processor||new n(r));if(t.observer){this.plugInObserver(t.name,t.observer);if(t.observer.initialize)t.observer.initialize()}else{this.plugInObserver(t.name,r.observer||new s(r));if(this.observers[t.name].initialize)this.observers[t.name].initialize()}if(t.backend){this.plugInPersistenceMapper(t.name,t.backend.storage);this.plugInProcessor(t.name,t.backend.processor);this.plugInObserver(t.name,t.backend.observer)}return this[t.name]},ObjectFamily:function(e){return this.define(e)},getConstructor:function(t){if(this.mappers[t])return e[t];throw new Error("No constructor")},getObjectFamilies:function(){return this.objectFamilies}}}},511:e=>{var t={EVENT:{TYPE_RECURRING:"recurring",TYPE_TERMINATING:"terminating",ACTION:{TYPE_AUTORENEW:"autorenew",TYPE_CONFIRM:"confirm",TYPE_PROTOCOL:"protocol"}},PROPERTY:{TYPE_SHORTTEXT:"shortText",TYPE_LONGTEXT:"longText",TYPE_INDEXEDTEXT:"indexedText",TYPE_NUMBER:"number",TYPE_DATE:"date",TYPE_SHORTID:"shortId",TYPE_REF_OBJ:"objectRef",TYPE_REF_USR:"userRef",TYPE_REF_FILE:"fileRef",TYPE_PROPERTY_BAG:"bag",TYPE_BOOLEAN:"boolean",TYPE_ARRAY:"array",TYPE_EVENT:"event",TYPE_ACTION:"action",TYPE_JSON:"json"},MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"},TEMPLATEMODES:{STRICT:"strict"}};e.exports=t},456:e=>{const t={NoOnChangeException:function(e){this.message="onChange not found";this.name="NoOnChangeException"},NoMetaException:function(e){this.message="meta not found";this.name="NoMetaException"},NoOnDeleteException:function(e){this.message="onDelete not found";this.name="NoOnDeleteException"},NoEventIdException:function(e){this.message="No Event ID provided";this.name="NoEventIdException"},InvalidTypeException:function(e){this.message=e+" is not a valid type";this.name="InvalidTypeException"},InvalidValueException:function(e,t){this.message=e+" is not valid. Type must be: "+t;this.name="InvalidValueException"},InvalidFormatException:function(){this.message="Invlid format";this.name="InvalidFormatException"},DuplicatePropertyException:function(e){this.message="Property "+e+" already exists in this object";this.name="DuplicatePropertyException"},DuplicateActionException:function(e){this.message="Action "+e+" already exists in this object";this.name="DuplicateActionException"},DuplicateApplicationException:function(e){this.message="Application "+e+" already exists in this object";this.name="DuplicateApplicationException"},NoSuchApplicationException:function(e){this.message="Application "+e+" does not exist in this object";this.name="NoSuchApplicationException"},NoSuchReminderException:function(e){this.message="Reminder "+e+" does not exist in this event";this.name="NoSuchReminderException"},DuplicateEventException:function(e){this.message="Event "+e+" already exists in this object";this.name="DuplicateEventException"},NoSuchTemplateException:function(e){this.message="Template id "+e+" does not exist";this.name="NoSuchTemplateException"},NotAnEventException:function(e){this.message="Property "+e+" is not an event";this.name="NotAnEventException"},NoSuchObjectException:function(e){this.message="Object id "+e+" does not exist";this.name="NoSuchObjectException"},NoSuchPropertyException:function(e){this.message="Property "+e+" does not exist in this object";this.name="NoSuchPropertyException"},NoSuchEventException:function(e){this.message="Event "+e+" does not exist in this object";this.name="NoSuchEventException"},PropertyNotFoundException:function(e){this.message="Property "+e+" does not exist in this object";this.name="PropertyNotFoundException"},MissingAttributeException:function(e){this.message="Missing attibute "+e+" in this object";this.name="MissingAttributeException"},CallbackErrorException:function(e){this.message=e;this.name="CallbackErrorException"},InvalidDateException:function(e){this.message=e+" is not a valid date";this.name="InvalidDateException"},InvalidActionException:function(e){this.message=e+" is not a valid event action";this.name="InvalidActionException"},InvalidDataTypeException:function(e,t){this.message=e+" is not of type "+t;this.name="InvalidDataTypeException"},NotATemplateExteptopn:function(e){this.message=e+" is not a template";this.name="NotATemplateExteptopn"},InvalidPrivilegeException:function(e){this.message="Invalid privileges format";this.name="InvalidPrivilegeException"},NoSuchPrivilegeException:function(e){this.message="Privilege does not exist";this.name="NoSuchPrivilegeException"},NoSuchPermissionException:function(e){this.message="Permission "+e+" does not exist";this.name="NoSuchPermissionException"},InvalidPermissionException:function(e){this.message="Permission format invalid";this.name="InvalidPermissionException"},InvalidEventIdException:function(e){this.message="Event ID format not valid: "+e;this.name="InvalidEventIdException"},NoHandlerProvidedException:function(e){this.message="No handler provided "+e;this.name="NoHandlerProvidedException"},HandlerExistsException:function(e){this.message="Handler "+e+" already exists";this.name="HandlerExistsException"},HandlerNotFoundException:function(e){this.message="Handler "+e+" not found";this.name="HandlerNotFoundException"},InvalidArgumentException:function(e){this.message="Invalid argument";this.name="InvalidArgumentException"},InvalidHandlerException:function(e){this.message="Invalid handler";this.name="InvalidHandlerException"},LackOfPermissionsException:function(e){if(Array.isArray(e)){var t="No permissions to perform these operations: ";e.forEach((function(e){t+="("+e.name+": "+e.key+") "}));this.message=t;this.name="LackOfPermissionsException"}else{this.message="No permissions to perform this operation";this.name="LackOfPermissionsException"}}};e.exports=t},583:e=>{var t={enabled:[],log:function(e){if(this.enabled.length==0||this.enabled.indexOf("log")!=-1)console.log(e)},warn:function(e){if(this.enabled.length==0||this.enabled.indexOf("warn")!=-1)console.warn(e)},error:function(e){if(this.enabled.length==0||this.enabled.indexOf("error")!=-1)console.error(e)}};e.exports=t},351:function(e){var t;(function(){function objectify(e){var t=[];for(var r in e){var i={};i[r]=e[r];t.push(i)}return t}if(!String.prototype.startsWith){Object.defineProperty(String.prototype,"startsWith",{enumerable:false,configurable:false,writable:false,value:function(e,t){t=t||0;return this.lastIndexOf(e,t)===t}})}if(!String.prototype.endsWith){Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var r=this.toString();if(t===undefined||t>r.length){t=r.length}t-=e.length;var i=r.indexOf(e,t);return i!==-1&&i===t}})}t={satisfies:function(e,r,i){return t.lhs._rowsatisfies(e,r,i)},Query:function(e,r){return function(i){return t.lhs._rowsatisfies(i,e,r)}},join:function(e,t,r,i){var n,s;if(typeof r=="string")n=function(e){return e[r]};else n=r;if(!i)s=n;if(typeof i=="string")s=function(e){return e[r]};else s=i;return e},query:function(e,r,i){if(typeof i=="string"){var n=i;i=function(e,t){return e[n](t)}}var s=new t.Query(r,i);return e.filter(s)},lhs:{_rowsatisfies:function(e,t,r){for(var i in t){if(this[i]){if(!this[i](e,t[i],r))return false}else{var n=r?r(e,i):e[i];var s=this.rhs._satisfies(n,t[i],i);if(!s)return false}}return true},$count:function(e,r,i){var n=r.$constraints.map((function(r){return t.satisfies(e,r,i)})).filter((function(e){return e})).length;return this.rhs._satisfies(n,r.$constraint)},$not:function(e,t,r){return!this._rowsatisfies(e,t,r)},$or:function(e,t,r){if(!Array.isArray(t)){t=objectify(t)}for(var i=0;i<t.length;i++){if(this._rowsatisfies(e,t[i],r))return true}return false},$and:function(e,t,r){if(!Array.isArray(t)){t=objectify(t)}for(var i=0;i<t.length;i++){if(!this._rowsatisfies(e,t[i],r))return false}return true},$nor:function(e,t,r){return!this.$or(e,t,r)},$where:function(e,t){var r=typeof t=="string"?new Function(t):t;var i=r.call(e);return i},rhs:{$cb:function(e,t,r){return t(e)},_satisfies:function(e,t,r){if(t===e)return true;else if(t instanceof RegExp)return this.$regex(e,t);else if(Array.isArray(t))return this.$in(e,t);else if(t&&typeof t==="object"){if(t instanceof Date)return this.$eq(e,t.getTime());else{if(t.$regex)return this.$regex(e,new RegExp(t.$regex,t.$options));for(var i in t){if(!this[i])return this.$eq(e,t,r);else if(!this[i](e,t[i],r))return false}return true}}else if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(this.$eq(e[n],t))return true;return false}else if(t===""||t===null||t===undefined)return this.$null(e);else return this.$eq(e,t)},$eq:function(e,t){if(e===t)return true;else if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(this.$eq(e[r],t))return true;return false}else if(t===null||t===undefined||t===""){return this.$null(e)}else if(e===null||e===""||e===undefined)return false;else if(e instanceof Date){if(t instanceof Date){return e.getTime()==t.getTime()}else if(typeof t=="number"){return e.getTime()==t}else if(typeof t=="string")return e.getTime()==new Date(t).getTime()}else{return e==t}},$exists:function(e,t,r){return e!=undefined==(t&&true)},$deepEquals:function(e,t){if(typeof _=="undefined"||typeof _.isEqual=="undefined"){return JSON.stringify(e)==JSON.stringify(t)}else{return _.isEqual(e,t)}},$not:function(e,t){return!this._satisfies(e,t)},$ne:function(e,t){return!this._satisfies(e,t)},$nor:function(e,t,r){return!this.$or(e,t,r)},$and:function(e,t,r){if(!Array.isArray(t)){throw new Error("Logic $and takes array of constraint objects")}for(var i=0;i<t.length;i++){var n=this._satisfies(e,t[i],r);if(!n)return false}return true},$or:function(e,t,r){if(!Array.isArray(e)){e=[e]}for(var i=0;i<e.length;i++){for(var n=0;n<t.length;n++){if(this._satisfies(e[i],t[n],r)){return true}}}return false},$null:function(e){var t;if(e===""||e===null||e===undefined){return true}else if(Array.isArray(e)){for(var r=0;r<e.length;r++){if(!this.$null(e[r])){return false}}return true}else return false},$in:function(e,t){if(!Array.isArray(t))throw new Error("$in requires an array operand");var r=false;if(!Array.isArray(e)){e=[e]}for(var i=0;i<e.length;i++){var n=e[i];for(var s=0;s<t.length;s++){if(this._satisfies(n,t[s])){r=true;break}}r=r||t.indexOf(n)>=0}return r},$likeI:function(e,t){return e.toLowerCase().indexOf(t)>=0},$like:function(e,t){return e.indexOf(t)>=0},$startsWith:function(e,t){if(!e)return false;return e.startsWith(t)},$endsWith:function(e,t){if(!e)return false;return e.endsWith(t)},$elemMatch:function(e,r,i){for(var n=0;n<e.length;n++){if(t.lhs._rowsatisfies(e[n],r))return true}return false},$contains:function(e,t){return e.indexOf(t)>=0},$nin:function(e,t){return!this.$in(e,t)},$regex:function(e,t){console.log("constraint",t);var r=false;if(Array.isArray(e)){for(var i=0;i<e.length;i++){if(t.test(e[i])){return true}}}else return t.test(e)},$gte:function(e,t){return!this.$null(e)&&e>=this.resolve(t)},$gt:function(e,t){return!this.$null(e)&&e>this.resolve(t)},$lt:function(e,t){return!this.$null(e)&&e<this.resolve(t)},$lte:function(e,t){return!this.$null(e)&&e<=this.resolve(t)},$before:function(e,t){if(typeof t==="string")t=Date.parse(t);if(typeof e==="string")e=Date.parse(e);return this.$lte(e,t)},$after:function(e,t){if(typeof t==="string")t=Date.parse(t);if(typeof e==="string")e=Date.parse(e);return this.$gte(e,t)},$type:function(e,t){return typeof e==t},$all:function(e,t){throw new Error("$all not implemented")},$size:function(e,t){return typeof e=="object"&&(e.length==t||Object.keys(e).length==t)},$mod:function(e,t){return e%t[0]==t[1]},$equal:function(){return this.$eq(arguments)},$between:function(e,t){return this._satisfies(e,{$gt:t[0],$lt:t[1]})},resolve:function(e){if(typeof e==="object"){if(e["$date"])return Date.parse(e["$date"])}return e}}}};t.undot=function(e,t){var r=t.split("."),i=e;for(var n=0;n<r.length;n++){if(i)i=i[r[n]]}return i};t.lhs.rhs.$equal=t.lhs.rhs.$eq;t.lhs.rhs.$any=t.lhs.rhs.$or;t.lhs.rhs.$all=t.lhs.rhs.$and;t.satisfies=function(e,t,r){return this.lhs._rowsatisfies(e,t,r)};Array.prototype.query=function(e){return t.query(this,e)};RegExp.prototype.toJSON=RegExp.prototype.toString;if(true)e.exports=t;else{}return t})(this);e.exports=t},270:(e,t,r)=>{var i=r(204);Mapper=function(e){return Object.assign(new e.ObserverTemplate(e),{initialize:function(e){var t=this;this.interval=setInterval((function(){t.run(i().utc())}),this.interval)},run:function(t){var r=this;e.getPersistence(r.objectFamily).listClients((function(i){i.forEach((function(i){e.getPersistence(r.objectFamily).getByCriteria({_aggregatedEvents:{$elemMatch:{date:{$lte:t.toISOString()}}}},(function(t){t.forEach((function(t){t=e[r.objectFamily](t);t._aggregatedEvents.forEach((function(r){var n=t.getProperty(r.propName);e.execProcessorAction(n.action,t,n,null,(function(){t.setEventTriggered(r.propName,true,i).update((function(e){}),(function(e){console.log(e)}),i)}),i,{})}))}))}),(function(e){}),undefined,i,{})}))}),(function(e){}))}})};e.exports=Mapper},434:module=>{Mapper=function(OBJY,mapperOptions){return Object.assign(new OBJY.ProcessorTemplate(OBJY),{execute:function(dsl,obj,prop,data,callback,client,app,user,options){OBJY.Logger.log("Executing dsl in mapper");if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){try{if((mapperOptions||{}).hasOwnProperty("parse")){mapperOptions.parse(dsl)}else{if(typeof dsl==="function")dsl(obj,prop,data,callback,client,app,user,options);else eval(dsl)}}catch(e){OBJY.Logger.error(e)}if(callback)callback()}else{try{if((mapperOptions||{}).hasOwnProperty("parse")){mapperOptions.parse(dsl)}else{if(typeof dsl==="function")dsl(obj,prop,data,callback,client,app,user,options);else eval(dsl)}}catch(e){OBJY.Logger.error(e)}if(callback)callback()}}})};module.exports=Mapper},793:(e,t,r)=>{var i=r(351);var Mapper=function(e,t){return Object.assign(new e.StorageTemplate(e,t),{database:{},index:{},createClient:function(e,t,r){if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){if(this.database[e])r("Client already exists");this.database[e]=[];this.index[e]={};t()}},getDBByMultitenancy:function(e){if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED){if(!Array.isArray(this.database))this.database=[];return this.database}else if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED){if(!this.database[e])throw new Error("no database for client "+e);return this.database[e]}},listClients:function(e,t){if(!this.database)return t("no database");if(this.multitenancy==this.CONSTANTS.MULTITENANCY.ISOLATED)e(Object.keys(this.database));else e(Object.keys(this.database))},getById:function(e,t,r,i,n){var s=this.getDBByMultitenancy(n);if(this.index[n][e]===undefined)return r("object not found: "+e);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[n][e].tenantId!=n)return r("object not found: "+_id);t(s[this.index[n][e]])},getByCriteria:function(e,t,r,n,s,a){var o=this.getDBByMultitenancy(s);if(n)Object.assign(e,{applications:{$in:[n]}});if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)Object.assign(e,{tenantId:s});t(i.query(o,e,i.undot))},count:function(e,t,r,n,s,a){var o=this.getDBByMultitenancy(s);if(n)Object.assign(e,{applications:{$in:[n]}});if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)Object.assign(e,{tenantId:s});t(i.query(o,e,i.undot).length)},update:function(e,t,r,i,n){var s=this.getDBByMultitenancy(n);if(this.index[n][e._id]===undefined)return r("object not found: "+e._id);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[n][e._id].tenantId!=n)return r("object not found: "+_id);s[this.index[n][e._id]]=e;t(s[this.index[n][e._id]])},add:function(e,t,r,i,n){if(!this.database[n])this.database[n]=[];if(!this.index[n])this.index[n]={};if(this.index[n][e._id]!==undefined)return r("object with taht id already exists: "+e._id);if(!this.index[n])this.index[n]={};var s=this.getDBByMultitenancy(n);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED){e.tenantId=n}this.index[n][e._id]=s.push(e)-1;t(e)},remove:function(e,t,r,i,n){var s=this.getDBByMultitenancy(n);if(this.index[n][e._id]===undefined)return r("object not found: "+e._id);if(this.multitenancy==this.CONSTANTS.MULTITENANCY.SHARED)if(this.index[n][e._id].tenantId!=n)return r("object not found: "+e._id);s.splice(this.index[n][e._id],1);delete this.index[n][e._id];t(e)}})};e.exports=Mapper},625:e=>{ObserverMapperTemplate=function(e,t,r){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.OBJY=e;this.interval=(t||{}).interval||6e4;this.objectFamily=null;this.type=(t||{}).type||this.CONSTANTS.TYPES.QUERIED;this.multitenancy=(t||{}).multitenancy||this.CONSTANTS.MULTITENANCY.ISOLATED;this.initialize=function(e){};this.setObjectFamily=function(e){this.objectFamily=e};this.run=function(e){};if(r)Object.assign(this,r)};e.exports=ObserverMapperTemplate},736:e=>{ProcessorMapperTemplate=function(e){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.OBJY=e;this.objectFamily=null;this.multitenancy=this.CONSTANTS.MULTITENANCY.ISOLATED;this.execute=function(e,t,r,i,n,s,a,o,u){};this.setMultiTenancy=function(e){this.multitenancy=e};this.setObjectFamily=function(e){this.objectFamily=e}};e.exports=ProcessorMapperTemplate},77:e=>{StorageMapperTemplate=function(e,t){this.CONSTANTS={MULTITENANCY:{ISOLATED:"isolated",SHARED:"shared"},TYPES:{SCHEDULED:"scheduled",QUERIED:"queried"}};this.objectFamily=null;this.multitenancy=(t||{}).multitenancy||this.CONSTANTS.MULTITENANCY.ISOLATED;this.connect=function(e,t,r){};this.closeConnection=function(e,t){};this.setObjectFamily=function(e){this.objectFamily=e};this.setMultiTenancy=function(e){this.multitenancy=e};this.createClient=function(e,t,r){};this.getDBByMultitenancy=function(e){};this.listClients=function(e,t){};this.getById=function(e,t,r,i,n,s){};this.getByCriteria=function(e,t,r,i,n,s,a,o){};this.count=function(e,t,r,i,n,s,a,o){};this.update=function(e,t,r,i,n,s,a){};this.add=function(e,t,r,i,n,s,a){};this.remove=function(e,t,r,i,n,s,a){}};e.exports=StorageMapperTemplate},204:function(e,t,r){e=r.nmd(e);
//! moment.js
(function(t,r){true?e.exports=r():0})(this,(function(){"use strict";var t;function hooks(){return t.apply(null,arguments)}function setHookCallback(e){t=e}function isArray(e){return e instanceof Array||Object.prototype.toString.call(e)==="[object Array]"}function isObject(e){return e!=null&&Object.prototype.toString.call(e)==="[object Object]"}function isObjectEmpty(e){if(Object.getOwnPropertyNames){return Object.getOwnPropertyNames(e).length===0}else{var t;for(t in e){if(e.hasOwnProperty(t)){return false}}return true}}function isUndefined(e){return e===void 0}function isNumber(e){return typeof e==="number"||Object.prototype.toString.call(e)==="[object Number]"}function isDate(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"}function map(e,t){var r=[],i;for(i=0;i<e.length;++i){r.push(t(e[i],i))}return r}function hasOwnProp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function extend(e,t){for(var r in t){if(hasOwnProp(t,r)){e[r]=t[r]}}if(hasOwnProp(t,"toString")){e.toString=t.toString}if(hasOwnProp(t,"valueOf")){e.valueOf=t.valueOf}return e}function createUTC(e,t,r,i){return createLocalOrUTC(e,t,r,i,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(e){if(e._pf==null){e._pf=defaultParsingFlags()}return e._pf}var r;if(Array.prototype.some){r=Array.prototype.some}else{r=function(e){var t=Object(this);var r=t.length>>>0;for(var i=0;i<r;i++){if(i in t&&e.call(this,t[i],i,t)){return true}}return false}}function isValid(e){if(e._isValid==null){var t=getParsingFlags(e);var i=r.call(t.parsedDateParts,(function(e){return e!=null}));var n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&i);if(e._strict){n=n&&t.charsLeftOver===0&&t.unusedTokens.length===0&&t.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(e)){e._isValid=n}else{return n}}return e._isValid}function createInvalid(e){var t=createUTC(NaN);if(e!=null){extend(getParsingFlags(t),e)}else{getParsingFlags(t).userInvalidated=true}return t}var i=hooks.momentProperties=[];function copyConfig(e,t){var r,n,s;if(!isUndefined(t._isAMomentObject)){e._isAMomentObject=t._isAMomentObject}if(!isUndefined(t._i)){e._i=t._i}if(!isUndefined(t._f)){e._f=t._f}if(!isUndefined(t._l)){e._l=t._l}if(!isUndefined(t._strict)){e._strict=t._strict}if(!isUndefined(t._tzm)){e._tzm=t._tzm}if(!isUndefined(t._isUTC)){e._isUTC=t._isUTC}if(!isUndefined(t._offset)){e._offset=t._offset}if(!isUndefined(t._pf)){e._pf=getParsingFlags(t)}if(!isUndefined(t._locale)){e._locale=t._locale}if(i.length>0){for(r=0;r<i.length;r++){n=i[r];s=t[n];if(!isUndefined(s)){e[n]=s}}}return e}var n=false;function Moment(e){copyConfig(this,e);this._d=new Date(e._d!=null?e._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(n===false){n=true;hooks.updateOffset(this);n=false}}function isMoment(e){return e instanceof Moment||e!=null&&e._isAMomentObject!=null}function absFloor(e){if(e<0){return Math.ceil(e)||0}else{return Math.floor(e)}}function toInt(e){var t=+e,r=0;if(t!==0&&isFinite(t)){r=absFloor(t)}return r}function compareArrays(e,t,r){var i=Math.min(e.length,t.length),n=Math.abs(e.length-t.length),s=0,a;for(a=0;a<i;a++){if(r&&e[a]!==t[a]||!r&&toInt(e[a])!==toInt(t[a])){s++}}return s+n}function warn(e){if(hooks.suppressDeprecationWarnings===false&&typeof console!=="undefined"&&console.warn){console.warn("Deprecation warning: "+e)}}function deprecate(e,t){var r=true;return extend((function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,e)}if(r){var i=[];var n;for(var s=0;s<arguments.length;s++){n="";if(typeof arguments[s]==="object"){n+="\n["+s+"] ";for(var a in arguments[0]){n+=a+": "+arguments[0][a]+", "}n=n.slice(0,-2)}else{n=arguments[s]}i.push(n)}warn(e+"\nArguments: "+Array.prototype.slice.call(i).join("")+"\n"+(new Error).stack);r=false}return t.apply(this,arguments)}),t)}var s={};function deprecateSimple(e,t){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(e,t)}if(!s[e]){warn(t);s[e]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(e){return e instanceof Function||Object.prototype.toString.call(e)==="[object Function]"}function set(e){var t,r;for(r in e){t=e[r];if(isFunction(t)){this[r]=t}else{this["_"+r]=t}}this._config=e;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function mergeConfigs(e,t){var r=extend({},e),i;for(i in t){if(hasOwnProp(t,i)){if(isObject(e[i])&&isObject(t[i])){r[i]={};extend(r[i],e[i]);extend(r[i],t[i])}else if(t[i]!=null){r[i]=t[i]}else{delete r[i]}}}for(i in e){if(hasOwnProp(e,i)&&!hasOwnProp(t,i)&&isObject(e[i])){r[i]=extend({},r[i])}}return r}function Locale(e){if(e!=null){this.set(e)}}var a;if(Object.keys){a=Object.keys}else{a=function(e){var t,r=[];for(t in e){if(hasOwnProp(e,t)){r.push(t)}}return r}}var o={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function calendar(e,t,r){var i=this._calendar[e]||this._calendar["sameElse"];return isFunction(i)?i.call(t,r):i}var u={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function longDateFormat(e){var t=this._longDateFormat[e],r=this._longDateFormat[e.toUpperCase()];if(t||!r){return t}this._longDateFormat[e]=r.replace(/MMMM|MM|DD|dddd/g,(function(e){return e.slice(1)}));return this._longDateFormat[e]}var c="Invalid date";function invalidDate(){return this._invalidDate}var f="%d";var l=/\d{1,2}/;function ordinal(e){return this._ordinal.replace("%d",e)}var h={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function relativeTime(e,t,r,i){var n=this._relativeTime[r];return isFunction(n)?n(e,t,r,i):n.replace(/%d/i,e)}function pastFuture(e,t){var r=this._relativeTime[e>0?"future":"past"];return isFunction(r)?r(t):r.replace(/%s/i,t)}var d={};function addUnitAlias(e,t){var r=e.toLowerCase();d[r]=d[r+"s"]=d[t]=e}function normalizeUnits(e){return typeof e==="string"?d[e]||d[e.toLowerCase()]:undefined}function normalizeObjectUnits(e){var t={},r,i;for(i in e){if(hasOwnProp(e,i)){r=normalizeUnits(i);if(r){t[r]=e[i]}}}return t}var p={};function addUnitPriority(e,t){p[e]=t}function getPrioritizedUnits(e){var t=[];for(var r in e){t.push({unit:r,priority:p[r]})}t.sort((function(e,t){return e.priority-t.priority}));return t}function zeroFill(e,t,r){var i=""+Math.abs(e),n=t-i.length,s=e>=0;return(s?r?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+i}var m=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var g=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var v={};var y={};function addFormatToken(e,t,r,i){var n=i;if(typeof i==="string"){n=function(){return this[i]()}}if(e){y[e]=n}if(t){y[t[0]]=function(){return zeroFill(n.apply(this,arguments),t[1],t[2])}}if(r){y[r]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)}}}function removeFormattingTokens(e){if(e.match(/\[[\s\S]/)){return e.replace(/^\[|\]$/g,"")}return e.replace(/\\/g,"")}function makeFormatFunction(e){var t=e.match(m),r,i;for(r=0,i=t.length;r<i;r++){if(y[t[r]]){t[r]=y[t[r]]}else{t[r]=removeFormattingTokens(t[r])}}return function(r){var n="",s;for(s=0;s<i;s++){n+=isFunction(t[s])?t[s].call(r,e):t[s]}return n}}function formatMoment(e,t){if(!e.isValid()){return e.localeData().invalidDate()}t=expandFormat(t,e.localeData());v[t]=v[t]||makeFormatFunction(t);return v[t](e)}function expandFormat(e,t){var r=5;function replaceLongDateFormatTokens(e){return t.longDateFormat(e)||e}g.lastIndex=0;while(r>=0&&g.test(e)){e=e.replace(g,replaceLongDateFormatTokens);g.lastIndex=0;r-=1}return e}var O=/\d/;var P=/\d\d/;var _=/\d{3}/;var b=/\d{4}/;var S=/[+-]?\d{6}/;var k=/\d\d?/;var w=/\d\d\d\d?/;var T=/\d\d\d\d\d\d?/;var E=/\d{1,3}/;var x=/\d{1,4}/;var D=/[+-]?\d{1,6}/;var j=/\d+/;var M=/[+-]?\d+/;var A=/Z|[+-]\d\d:?\d\d/gi;var C=/Z|[+-]\d\d(?::?\d\d)?/gi;var Y=/[+-]?\d+(\.\d{1,3})?/;var R=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var F={};function addRegexToken(e,t,r){F[e]=isFunction(t)?t:function(e,i){return e&&r?r:t}}function getParseRegexForToken(e,t){if(!hasOwnProp(F,e)){return new RegExp(unescapeFormat(e))}return F[e](t._strict,t._locale)}function unescapeFormat(e){return regexEscape(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,r,i,n){return t||r||i||n})))}function regexEscape(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var I={};function addParseToken(e,t){var r,i=t;if(typeof e==="string"){e=[e]}if(isNumber(t)){i=function(e,r){r[t]=toInt(e)}}for(r=0;r<e.length;r++){I[e[r]]=i}}function addWeekParseToken(e,t){addParseToken(e,(function(e,r,i,n){i._w=i._w||{};t(e,i._w,i,n)}))}function addTimeToArrayFromToken(e,t,r){if(t!=null&&hasOwnProp(I,e)){I[e](t,r._a,r,e)}}var N=0;var W=1;var L=2;var U=3;var q=4;var $=5;var V=6;var H=7;var z=8;addFormatToken("Y",0,0,(function(){var e=this.year();return e<=9999?""+e:"+"+e}));addFormatToken(0,["YY",2],0,(function(){return this.year()%100}));addFormatToken(0,["YYYY",4],0,"year");addFormatToken(0,["YYYYY",5],0,"year");addFormatToken(0,["YYYYYY",6,true],0,"year");addUnitAlias("year","y");addUnitPriority("year",1);addRegexToken("Y",M);addRegexToken("YY",k,P);addRegexToken("YYYY",x,b);addRegexToken("YYYYY",D,S);addRegexToken("YYYYYY",D,S);addParseToken(["YYYYY","YYYYYY"],N);addParseToken("YYYY",(function(e,t){t[N]=e.length===2?hooks.parseTwoDigitYear(e):toInt(e)}));addParseToken("YY",(function(e,t){t[N]=hooks.parseTwoDigitYear(e)}));addParseToken("Y",(function(e,t){t[N]=parseInt(e,10)}));function daysInYear(e){return isLeapYear(e)?366:365}function isLeapYear(e){return e%4===0&&e%100!==0||e%400===0}hooks.parseTwoDigitYear=function(e){return toInt(e)+(toInt(e)>68?1900:2e3)};var B=makeGetSet("FullYear",true);function getIsLeapYear(){return isLeapYear(this.year())}function makeGetSet(e,t){return function(r){if(r!=null){set$1(this,e,r);hooks.updateOffset(this,t);return this}else{return get(this,e)}}}function get(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function set$1(e,t,r){if(e.isValid()&&!isNaN(r)){if(t==="FullYear"&&isLeapYear(e.year())&&e.month()===1&&e.date()===29){e._d["set"+(e._isUTC?"UTC":"")+t](r,e.month(),daysInMonth(r,e.month()))}else{e._d["set"+(e._isUTC?"UTC":"")+t](r)}}}function stringGet(e){e=normalizeUnits(e);if(isFunction(this[e])){return this[e]()}return this}function stringSet(e,t){if(typeof e==="object"){e=normalizeObjectUnits(e);var r=getPrioritizedUnits(e);for(var i=0;i<r.length;i++){this[r[i].unit](e[r[i].unit])}}else{e=normalizeUnits(e);if(isFunction(this[e])){return this[e](t)}}return this}function mod(e,t){return(e%t+t)%t}var G;if(Array.prototype.indexOf){G=Array.prototype.indexOf}else{G=function(e){var t;for(t=0;t<this.length;++t){if(this[t]===e){return t}}return-1}}function daysInMonth(e,t){if(isNaN(e)||isNaN(t)){return NaN}var r=mod(t,12);e+=(t-r)/12;return r===1?isLeapYear(e)?29:28:31-r%7%2}addFormatToken("M",["MM",2],"Mo",(function(){return this.month()+1}));addFormatToken("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)}));addFormatToken("MMMM",0,0,(function(e){return this.localeData().months(this,e)}));addUnitAlias("month","M");addUnitPriority("month",8);addRegexToken("M",k);addRegexToken("MM",k,P);addRegexToken("MMM",(function(e,t){return t.monthsShortRegex(e)}));addRegexToken("MMMM",(function(e,t){return t.monthsRegex(e)}));addParseToken(["M","MM"],(function(e,t){t[W]=toInt(e)-1}));addParseToken(["MMM","MMMM"],(function(e,t,r,i){var n=r._locale.monthsParse(e,i,r._strict);if(n!=null){t[W]=n}else{getParsingFlags(r).invalidMonth=e}}));var J=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var Z="January_February_March_April_May_June_July_August_September_October_November_December".split("_");function localeMonths(e,t){if(!e){return isArray(this._months)?this._months:this._months["standalone"]}return isArray(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||J).test(t)?"format":"standalone"][e.month()]}var Q="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function localeMonthsShort(e,t){if(!e){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort["standalone"]}return isArray(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[J.test(t)?"format":"standalone"][e.month()]}function handleStrictParse(e,t,r){var i,n,s,a=e.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){s=createUTC([2e3,i]);this._shortMonthsParse[i]=this.monthsShort(s,"").toLocaleLowerCase();this._longMonthsParse[i]=this.months(s,"").toLocaleLowerCase()}}if(r){if(t==="MMM"){n=G.call(this._shortMonthsParse,a);return n!==-1?n:null}else{n=G.call(this._longMonthsParse,a);return n!==-1?n:null}}else{if(t==="MMM"){n=G.call(this._shortMonthsParse,a);if(n!==-1){return n}n=G.call(this._longMonthsParse,a);return n!==-1?n:null}else{n=G.call(this._longMonthsParse,a);if(n!==-1){return n}n=G.call(this._shortMonthsParse,a);return n!==-1?n:null}}}function localeMonthsParse(e,t,r){var i,n,s;if(this._monthsParseExact){return handleStrictParse.call(this,e,t,r)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){n=createUTC([2e3,i]);if(r&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i");this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")}if(!r&&!this._monthsParse[i]){s="^"+this.months(n,"")+"|^"+this.monthsShort(n,"");this._monthsParse[i]=new RegExp(s.replace(".",""),"i")}if(r&&t==="MMMM"&&this._longMonthsParse[i].test(e)){return i}else if(r&&t==="MMM"&&this._shortMonthsParse[i].test(e)){return i}else if(!r&&this._monthsParse[i].test(e)){return i}}}function setMonth(e,t){var r;if(!e.isValid()){return e}if(typeof t==="string"){if(/^\d+$/.test(t)){t=toInt(t)}else{t=e.localeData().monthsParse(t);if(!isNumber(t)){return e}}}r=Math.min(e.date(),daysInMonth(e.year(),t));e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,r);return e}function getSetMonth(e){if(e!=null){setMonth(this,e);hooks.updateOffset(this,true);return this}else{return get(this,"Month")}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var X=R;function monthsShortRegex(e){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(e){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,"_monthsShortRegex")){this._monthsShortRegex=X}return this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex}}var K=R;function monthsRegex(e){if(this._monthsParseExact){if(!hasOwnProp(this,"_monthsRegex")){computeMonthsParse.call(this)}if(e){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,"_monthsRegex")){this._monthsRegex=K}return this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(e,t){return t.length-e.length}var e=[],t=[],r=[],i,n;for(i=0;i<12;i++){n=createUTC([2e3,i]);e.push(this.monthsShort(n,""));t.push(this.months(n,""));r.push(this.months(n,""));r.push(this.monthsShort(n,""))}e.sort(cmpLenRev);t.sort(cmpLenRev);r.sort(cmpLenRev);for(i=0;i<12;i++){e[i]=regexEscape(e[i]);t[i]=regexEscape(t[i])}for(i=0;i<24;i++){r[i]=regexEscape(r[i])}this._monthsRegex=new RegExp("^("+r.join("|")+")","i");this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp("^("+t.join("|")+")","i");this._monthsShortStrictRegex=new RegExp("^("+e.join("|")+")","i")}function createDate(e,t,r,i,n,s,a){var o;if(e<100&&e>=0){o=new Date(e+400,t,r,i,n,s,a);if(isFinite(o.getFullYear())){o.setFullYear(e)}}else{o=new Date(e,t,r,i,n,s,a)}return o}function createUTCDate(e){var t;if(e<100&&e>=0){var r=Array.prototype.slice.call(arguments);r[0]=e+400;t=new Date(Date.UTC.apply(null,r));if(isFinite(t.getUTCFullYear())){t.setUTCFullYear(e)}}else{t=new Date(Date.UTC.apply(null,arguments))}return t}function firstWeekOffset(e,t,r){var i=7+t-r,n=(7+createUTCDate(e,0,i).getUTCDay()-t)%7;return-n+i-1}function dayOfYearFromWeeks(e,t,r,i,n){var s=(7+r-i)%7,a=firstWeekOffset(e,i,n),o=1+7*(t-1)+s+a,u,c;if(o<=0){u=e-1;c=daysInYear(u)+o}else if(o>daysInYear(e)){u=e+1;c=o-daysInYear(e)}else{u=e;c=o}return{year:u,dayOfYear:c}}function weekOfYear(e,t,r){var i=firstWeekOffset(e.year(),t,r),n=Math.floor((e.dayOfYear()-i-1)/7)+1,s,a;if(n<1){a=e.year()-1;s=n+weeksInYear(a,t,r)}else if(n>weeksInYear(e.year(),t,r)){s=n-weeksInYear(e.year(),t,r);a=e.year()+1}else{a=e.year();s=n}return{week:s,year:a}}function weeksInYear(e,t,r){var i=firstWeekOffset(e,t,r),n=firstWeekOffset(e+1,t,r);return(daysInYear(e)-i+n)/7}addFormatToken("w",["ww",2],"wo","week");addFormatToken("W",["WW",2],"Wo","isoWeek");addUnitAlias("week","w");addUnitAlias("isoWeek","W");addUnitPriority("week",5);addUnitPriority("isoWeek",5);addRegexToken("w",k);addRegexToken("ww",k,P);addRegexToken("W",k);addRegexToken("WW",k,P);addWeekParseToken(["w","ww","W","WW"],(function(e,t,r,i){t[i.substr(0,1)]=toInt(e)}));function localeWeek(e){return weekOfYear(e,this._week.dow,this._week.doy).week}var ee={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(e){var t=this.localeData().week(this);return e==null?t:this.add((e-t)*7,"d")}function getSetISOWeek(e){var t=weekOfYear(this,1,4).week;return e==null?t:this.add((e-t)*7,"d")}addFormatToken("d",0,"do","day");addFormatToken("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)}));addFormatToken("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)}));addFormatToken("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)}));addFormatToken("e",0,0,"weekday");addFormatToken("E",0,0,"isoWeekday");addUnitAlias("day","d");addUnitAlias("weekday","e");addUnitAlias("isoWeekday","E");addUnitPriority("day",11);addUnitPriority("weekday",11);addUnitPriority("isoWeekday",11);addRegexToken("d",k);addRegexToken("e",k);addRegexToken("E",k);addRegexToken("dd",(function(e,t){return t.weekdaysMinRegex(e)}));addRegexToken("ddd",(function(e,t){return t.weekdaysShortRegex(e)}));addRegexToken("dddd",(function(e,t){return t.weekdaysRegex(e)}));addWeekParseToken(["dd","ddd","dddd"],(function(e,t,r,i){var n=r._locale.weekdaysParse(e,i,r._strict);if(n!=null){t.d=n}else{getParsingFlags(r).invalidWeekday=e}}));addWeekParseToken(["d","e","E"],(function(e,t,r,i){t[i]=toInt(e)}));function parseWeekday(e,t){if(typeof e!=="string"){return e}if(!isNaN(e)){return parseInt(e,10)}e=t.weekdaysParse(e);if(typeof e==="number"){return e}return null}function parseIsoWeekday(e,t){if(typeof e==="string"){return t.weekdaysParse(e)%7||7}return isNaN(e)?null:e}function shiftWeekdays(e,t){return e.slice(t,7).concat(e.slice(0,t))}var te="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_");function localeWeekdays(e,t){var r=isArray(this._weekdays)?this._weekdays:this._weekdays[e&&e!==true&&this._weekdays.isFormat.test(t)?"format":"standalone"];return e===true?shiftWeekdays(r,this._week.dow):e?r[e.day()]:r}var re="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_");function localeWeekdaysShort(e){return e===true?shiftWeekdays(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort}var ie="Su_Mo_Tu_We_Th_Fr_Sa".split("_");function localeWeekdaysMin(e){return e===true?shiftWeekdays(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin}function handleStrictParse$1(e,t,r){var i,n,s,a=e.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){s=createUTC([2e3,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(s,"").toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(s,"").toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(s,"").toLocaleLowerCase()}}if(r){if(t==="dddd"){n=G.call(this._weekdaysParse,a);return n!==-1?n:null}else if(t==="ddd"){n=G.call(this._shortWeekdaysParse,a);return n!==-1?n:null}else{n=G.call(this._minWeekdaysParse,a);return n!==-1?n:null}}else{if(t==="dddd"){n=G.call(this._weekdaysParse,a);if(n!==-1){return n}n=G.call(this._shortWeekdaysParse,a);if(n!==-1){return n}n=G.call(this._minWeekdaysParse,a);return n!==-1?n:null}else if(t==="ddd"){n=G.call(this._shortWeekdaysParse,a);if(n!==-1){return n}n=G.call(this._weekdaysParse,a);if(n!==-1){return n}n=G.call(this._minWeekdaysParse,a);return n!==-1?n:null}else{n=G.call(this._minWeekdaysParse,a);if(n!==-1){return n}n=G.call(this._weekdaysParse,a);if(n!==-1){return n}n=G.call(this._shortWeekdaysParse,a);return n!==-1?n:null}}}function localeWeekdaysParse(e,t,r){var i,n,s;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,e,t,r)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){n=createUTC([2e3,1]).day(i);if(r&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i");this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i");this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")}if(!this._weekdaysParse[i]){s="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,"");this._weekdaysParse[i]=new RegExp(s.replace(".",""),"i")}if(r&&t==="dddd"&&this._fullWeekdaysParse[i].test(e)){return i}else if(r&&t==="ddd"&&this._shortWeekdaysParse[i].test(e)){return i}else if(r&&t==="dd"&&this._minWeekdaysParse[i].test(e)){return i}else if(!r&&this._weekdaysParse[i].test(e)){return i}}}function getSetDayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}var t=this._isUTC?this._d.getUTCDay():this._d.getDay();if(e!=null){e=parseWeekday(e,this.localeData());return this.add(e-t,"d")}else{return t}}function getSetLocaleDayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}var t=(this.day()+7-this.localeData()._week.dow)%7;return e==null?t:this.add(e-t,"d")}function getSetISODayOfWeek(e){if(!this.isValid()){return e!=null?this:NaN}if(e!=null){var t=parseIsoWeekday(e,this.localeData());return this.day(this.day()%7?t:t-7)}else{return this.day()||7}}var ne=R;function weekdaysRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,"_weekdaysRegex")){this._weekdaysRegex=ne}return this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex}}var se=R;function weekdaysShortRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,"_weekdaysShortRegex")){this._weekdaysShortRegex=se}return this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var ae=R;function weekdaysMinRegex(e){if(this._weekdaysParseExact){if(!hasOwnProp(this,"_weekdaysRegex")){computeWeekdaysParse.call(this)}if(e){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,"_weekdaysMinRegex")){this._weekdaysMinRegex=ae}return this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(e,t){return t.length-e.length}var e=[],t=[],r=[],i=[],n,s,a,o,u;for(n=0;n<7;n++){s=createUTC([2e3,1]).day(n);a=this.weekdaysMin(s,"");o=this.weekdaysShort(s,"");u=this.weekdays(s,"");e.push(a);t.push(o);r.push(u);i.push(a);i.push(o);i.push(u)}e.sort(cmpLenRev);t.sort(cmpLenRev);r.sort(cmpLenRev);i.sort(cmpLenRev);for(n=0;n<7;n++){t[n]=regexEscape(t[n]);r[n]=regexEscape(r[n]);i[n]=regexEscape(i[n])}this._weekdaysRegex=new RegExp("^("+i.join("|")+")","i");this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp("^("+r.join("|")+")","i");this._weekdaysShortStrictRegex=new RegExp("^("+t.join("|")+")","i");this._weekdaysMinStrictRegex=new RegExp("^("+e.join("|")+")","i")}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken("H",["HH",2],0,"hour");addFormatToken("h",["hh",2],0,hFormat);addFormatToken("k",["kk",2],0,kFormat);addFormatToken("hmm",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)}));addFormatToken("hmmss",0,0,(function(){return""+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)}));addFormatToken("Hmm",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)}));addFormatToken("Hmmss",0,0,(function(){return""+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)}));function meridiem(e,t){addFormatToken(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}meridiem("a",true);meridiem("A",false);addUnitAlias("hour","h");addUnitPriority("hour",13);function matchMeridiem(e,t){return t._meridiemParse}addRegexToken("a",matchMeridiem);addRegexToken("A",matchMeridiem);addRegexToken("H",k);addRegexToken("h",k);addRegexToken("k",k);addRegexToken("HH",k,P);addRegexToken("hh",k,P);addRegexToken("kk",k,P);addRegexToken("hmm",w);addRegexToken("hmmss",T);addRegexToken("Hmm",w);addRegexToken("Hmmss",T);addParseToken(["H","HH"],U);addParseToken(["k","kk"],(function(e,t,r){var i=toInt(e);t[U]=i===24?0:i}));addParseToken(["a","A"],(function(e,t,r){r._isPm=r._locale.isPM(e);r._meridiem=e}));addParseToken(["h","hh"],(function(e,t,r){t[U]=toInt(e);getParsingFlags(r).bigHour=true}));addParseToken("hmm",(function(e,t,r){var i=e.length-2;t[U]=toInt(e.substr(0,i));t[q]=toInt(e.substr(i));getParsingFlags(r).bigHour=true}));addParseToken("hmmss",(function(e,t,r){var i=e.length-4;var n=e.length-2;t[U]=toInt(e.substr(0,i));t[q]=toInt(e.substr(i,2));t[$]=toInt(e.substr(n));getParsingFlags(r).bigHour=true}));addParseToken("Hmm",(function(e,t,r){var i=e.length-2;t[U]=toInt(e.substr(0,i));t[q]=toInt(e.substr(i))}));addParseToken("Hmmss",(function(e,t,r){var i=e.length-4;var n=e.length-2;t[U]=toInt(e.substr(0,i));t[q]=toInt(e.substr(i,2));t[$]=toInt(e.substr(n))}));function localeIsPM(e){return(e+"").toLowerCase().charAt(0)==="p"}var oe=/[ap]\.?m?\.?/i;function localeMeridiem(e,t,r){if(e>11){return r?"pm":"PM"}else{return r?"am":"AM"}}var ue=makeGetSet("Hours",true);var ce={calendar:o,longDateFormat:u,invalidDate:c,ordinal:f,dayOfMonthOrdinalParse:l,relativeTime:h,months:Z,monthsShort:Q,week:ee,weekdays:te,weekdaysMin:ie,weekdaysShort:re,meridiemParse:oe};var fe={};var le={};var he;function normalizeLocale(e){return e?e.toLowerCase().replace("_","-"):e}function chooseLocale(e){var t=0,r,i,n,s;while(t<e.length){s=normalizeLocale(e[t]).split("-");r=s.length;i=normalizeLocale(e[t+1]);i=i?i.split("-"):null;while(r>0){n=loadLocale(s.slice(0,r).join("-"));if(n){return n}if(i&&i.length>=r&&compareArrays(s,i,true)>=r-1){break}r--}t++}return he}function loadLocale(t){var r=null;if(!fe[t]&&"object"!=="undefined"&&e&&e.exports){try{r=he._abbr;var i=require;i("./locale/"+t);getSetGlobalLocale(r)}catch(e){}}return fe[t]}function getSetGlobalLocale(e,t){var r;if(e){if(isUndefined(t)){r=getLocale(e)}else{r=defineLocale(e,t)}if(r){he=r}else{if(typeof console!=="undefined"&&console.warn){console.warn("Locale "+e+" not found. Did you forget to load it?")}}}return he._abbr}function defineLocale(e,t){if(t!==null){var r,i=ce;t.abbr=e;if(fe[e]!=null){deprecateSimple("defineLocaleOverride","use moment.updateLocale(localeName, config) to change "+"an existing locale. moment.defineLocale(localeName, "+"config) should only be used for creating a new locale "+"See http://momentjs.com/guides/#/warnings/define-locale/ for more info.");i=fe[e]._config}else if(t.parentLocale!=null){if(fe[t.parentLocale]!=null){i=fe[t.parentLocale]._config}else{r=loadLocale(t.parentLocale);if(r!=null){i=r._config}else{if(!le[t.parentLocale]){le[t.parentLocale]=[]}le[t.parentLocale].push({name:e,config:t});return null}}}fe[e]=new Locale(mergeConfigs(i,t));if(le[e]){le[e].forEach((function(e){defineLocale(e.name,e.config)}))}getSetGlobalLocale(e);return fe[e]}else{delete fe[e];return null}}function updateLocale(e,t){if(t!=null){var r,i,n=ce;i=loadLocale(e);if(i!=null){n=i._config}t=mergeConfigs(n,t);r=new Locale(t);r.parentLocale=fe[e];fe[e]=r;getSetGlobalLocale(e)}else{if(fe[e]!=null){if(fe[e].parentLocale!=null){fe[e]=fe[e].parentLocale}else if(fe[e]!=null){delete fe[e]}}}return fe[e]}function getLocale(e){var t;if(e&&e._locale&&e._locale._abbr){e=e._locale._abbr}if(!e){return he}if(!isArray(e)){t=loadLocale(e);if(t){return t}e=[e]}return chooseLocale(e)}function listLocales(){return a(fe)}function checkOverflow(e){var t;var r=e._a;if(r&&getParsingFlags(e).overflow===-2){t=r[W]<0||r[W]>11?W:r[L]<1||r[L]>daysInMonth(r[N],r[W])?L:r[U]<0||r[U]>24||r[U]===24&&(r[q]!==0||r[$]!==0||r[V]!==0)?U:r[q]<0||r[q]>59?q:r[$]<0||r[$]>59?$:r[V]<0||r[V]>999?V:-1;if(getParsingFlags(e)._overflowDayOfYear&&(t<N||t>L)){t=L}if(getParsingFlags(e)._overflowWeeks&&t===-1){t=H}if(getParsingFlags(e)._overflowWeekday&&t===-1){t=z}getParsingFlags(e).overflow=t}return e}function defaults(e,t,r){if(e!=null){return e}if(t!=null){return t}return r}function currentDateArray(e){var t=new Date(hooks.now());if(e._useUTC){return[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]}return[t.getFullYear(),t.getMonth(),t.getDate()]}function configFromArray(e){var t,r,i=[],n,s,a;if(e._d){return}n=currentDateArray(e);if(e._w&&e._a[L]==null&&e._a[W]==null){dayOfYearFromWeekInfo(e)}if(e._dayOfYear!=null){a=defaults(e._a[N],n[N]);if(e._dayOfYear>daysInYear(a)||e._dayOfYear===0){getParsingFlags(e)._overflowDayOfYear=true}r=createUTCDate(a,0,e._dayOfYear);e._a[W]=r.getUTCMonth();e._a[L]=r.getUTCDate()}for(t=0;t<3&&e._a[t]==null;++t){e._a[t]=i[t]=n[t]}for(;t<7;t++){e._a[t]=i[t]=e._a[t]==null?t===2?1:0:e._a[t]}if(e._a[U]===24&&e._a[q]===0&&e._a[$]===0&&e._a[V]===0){e._nextDay=true;e._a[U]=0}e._d=(e._useUTC?createUTCDate:createDate).apply(null,i);s=e._useUTC?e._d.getUTCDay():e._d.getDay();if(e._tzm!=null){e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm)}if(e._nextDay){e._a[U]=24}if(e._w&&typeof e._w.d!=="undefined"&&e._w.d!==s){getParsingFlags(e).weekdayMismatch=true}}function dayOfYearFromWeekInfo(e){var t,r,i,n,s,a,o,u;t=e._w;if(t.GG!=null||t.W!=null||t.E!=null){s=1;a=4;r=defaults(t.GG,e._a[N],weekOfYear(createLocal(),1,4).year);i=defaults(t.W,1);n=defaults(t.E,1);if(n<1||n>7){u=true}}else{s=e._locale._week.dow;a=e._locale._week.doy;var c=weekOfYear(createLocal(),s,a);r=defaults(t.gg,e._a[N],c.year);i=defaults(t.w,c.week);if(t.d!=null){n=t.d;if(n<0||n>6){u=true}}else if(t.e!=null){n=t.e+s;if(t.e<0||t.e>6){u=true}}else{n=s}}if(i<1||i>weeksInYear(r,s,a)){getParsingFlags(e)._overflowWeeks=true}else if(u!=null){getParsingFlags(e)._overflowWeekday=true}else{o=dayOfYearFromWeeks(r,i,n,s,a);e._a[N]=o.year;e._dayOfYear=o.dayOfYear}}var de=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var pe=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var me=/Z|[+-]\d\d(?::?\d\d)?/;var ge=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/]];var ve=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]];var ye=/^\/?Date\((\-?\d+)/i;function configFromISO(e){var t,r,i=e._i,n=de.exec(i)||pe.exec(i),s,a,o,u;if(n){getParsingFlags(e).iso=true;for(t=0,r=ge.length;t<r;t++){if(ge[t][1].exec(n[1])){a=ge[t][0];s=ge[t][2]!==false;break}}if(a==null){e._isValid=false;return}if(n[3]){for(t=0,r=ve.length;t<r;t++){if(ve[t][1].exec(n[3])){o=(n[2]||" ")+ve[t][0];break}}if(o==null){e._isValid=false;return}}if(!s&&o!=null){e._isValid=false;return}if(n[4]){if(me.exec(n[4])){u="Z"}else{e._isValid=false;return}}e._f=a+(o||"")+(u||"");configFromStringAndFormat(e)}else{e._isValid=false}}var Oe=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(e,t,r,i,n,s){var a=[untruncateYear(e),Q.indexOf(t),parseInt(r,10),parseInt(i,10),parseInt(n,10)];if(s){a.push(parseInt(s,10))}return a}function untruncateYear(e){var t=parseInt(e,10);if(t<=49){return 2e3+t}else if(t<=999){return 1900+t}return t}function preprocessRFC2822(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function checkWeekday(e,t,r){if(e){var i=re.indexOf(e),n=new Date(t[0],t[1],t[2]).getDay();if(i!==n){getParsingFlags(r).weekdayMismatch=true;r._isValid=false;return false}}return true}var Pe={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(e,t,r){if(e){return Pe[e]}else if(t){return 0}else{var i=parseInt(r,10);var n=i%100,s=(i-n)/100;return s*60+n}}function configFromRFC2822(e){var t=Oe.exec(preprocessRFC2822(e._i));if(t){var r=extractFromRFC2822Strings(t[4],t[3],t[2],t[5],t[6],t[7]);if(!checkWeekday(t[1],r,e)){return}e._a=r;e._tzm=calculateOffset(t[8],t[9],t[10]);e._d=createUTCDate.apply(null,e._a);e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm);getParsingFlags(e).rfc2822=true}else{e._isValid=false}}function configFromString(e){var t=ye.exec(e._i);if(t!==null){e._d=new Date(+t[1]);return}configFromISO(e);if(e._isValid===false){delete e._isValid}else{return}configFromRFC2822(e);if(e._isValid===false){delete e._isValid}else{return}hooks.createFromInputFallback(e)}hooks.createFromInputFallback=deprecate("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), "+"which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are "+"discouraged and will be removed in an upcoming major release. Please refer to "+"http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}));hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(e){if(e._f===hooks.ISO_8601){configFromISO(e);return}if(e._f===hooks.RFC_2822){configFromRFC2822(e);return}e._a=[];getParsingFlags(e).empty=true;var t=""+e._i,r,i,n,s,a,o=t.length,u=0;n=expandFormat(e._f,e._locale).match(m)||[];for(r=0;r<n.length;r++){s=n[r];i=(t.match(getParseRegexForToken(s,e))||[])[0];if(i){a=t.substr(0,t.indexOf(i));if(a.length>0){getParsingFlags(e).unusedInput.push(a)}t=t.slice(t.indexOf(i)+i.length);u+=i.length}if(y[s]){if(i){getParsingFlags(e).empty=false}else{getParsingFlags(e).unusedTokens.push(s)}addTimeToArrayFromToken(s,i,e)}else if(e._strict&&!i){getParsingFlags(e).unusedTokens.push(s)}}getParsingFlags(e).charsLeftOver=o-u;if(t.length>0){getParsingFlags(e).unusedInput.push(t)}if(e._a[U]<=12&&getParsingFlags(e).bigHour===true&&e._a[U]>0){getParsingFlags(e).bigHour=undefined}getParsingFlags(e).parsedDateParts=e._a.slice(0);getParsingFlags(e).meridiem=e._meridiem;e._a[U]=meridiemFixWrap(e._locale,e._a[U],e._meridiem);configFromArray(e);checkOverflow(e)}function meridiemFixWrap(e,t,r){var i;if(r==null){return t}if(e.meridiemHour!=null){return e.meridiemHour(t,r)}else if(e.isPM!=null){i=e.isPM(r);if(i&&t<12){t+=12}if(!i&&t===12){t=0}return t}else{return t}}function configFromStringAndArray(e){var t,r,i,n,s;if(e._f.length===0){getParsingFlags(e).invalidFormat=true;e._d=new Date(NaN);return}for(n=0;n<e._f.length;n++){s=0;t=copyConfig({},e);if(e._useUTC!=null){t._useUTC=e._useUTC}t._f=e._f[n];configFromStringAndFormat(t);if(!isValid(t)){continue}s+=getParsingFlags(t).charsLeftOver;s+=getParsingFlags(t).unusedTokens.length*10;getParsingFlags(t).score=s;if(i==null||s<i){i=s;r=t}}extend(e,r||t)}function configFromObject(e){if(e._d){return}var t=normalizeObjectUnits(e._i);e._a=map([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],(function(e){return e&&parseInt(e,10)}));configFromArray(e)}function createFromConfig(e){var t=new Moment(checkOverflow(prepareConfig(e)));if(t._nextDay){t.add(1,"d");t._nextDay=undefined}return t}function prepareConfig(e){var t=e._i,r=e._f;e._locale=e._locale||getLocale(e._l);if(t===null||r===undefined&&t===""){return createInvalid({nullInput:true})}if(typeof t==="string"){e._i=t=e._locale.preparse(t)}if(isMoment(t)){return new Moment(checkOverflow(t))}else if(isDate(t)){e._d=t}else if(isArray(r)){configFromStringAndArray(e)}else if(r){configFromStringAndFormat(e)}else{configFromInput(e)}if(!isValid(e)){e._d=null}return e}function configFromInput(e){var t=e._i;if(isUndefined(t)){e._d=new Date(hooks.now())}else if(isDate(t)){e._d=new Date(t.valueOf())}else if(typeof t==="string"){configFromString(e)}else if(isArray(t)){e._a=map(t.slice(0),(function(e){return parseInt(e,10)}));configFromArray(e)}else if(isObject(t)){configFromObject(e)}else if(isNumber(t)){e._d=new Date(t)}else{hooks.createFromInputFallback(e)}}function createLocalOrUTC(e,t,r,i,n){var s={};if(r===true||r===false){i=r;r=undefined}if(isObject(e)&&isObjectEmpty(e)||isArray(e)&&e.length===0){e=undefined}s._isAMomentObject=true;s._useUTC=s._isUTC=n;s._l=r;s._i=e;s._f=t;s._strict=i;return createFromConfig(s)}function createLocal(e,t,r,i){return createLocalOrUTC(e,t,r,i,false)}var _e=deprecate("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=createLocal.apply(null,arguments);if(this.isValid()&&e.isValid()){return e<this?this:e}else{return createInvalid()}}));var be=deprecate("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=createLocal.apply(null,arguments);if(this.isValid()&&e.isValid()){return e>this?this:e}else{return createInvalid()}}));function pickBy(e,t){var r,i;if(t.length===1&&isArray(t[0])){t=t[0]}if(!t.length){return createLocal()}r=t[0];for(i=1;i<t.length;++i){if(!t[i].isValid()||t[i][e](r)){r=t[i]}}return r}function min(){var e=[].slice.call(arguments,0);return pickBy("isBefore",e)}function max(){var e=[].slice.call(arguments,0);return pickBy("isAfter",e)}var now=function(){return Date.now?Date.now():+new Date};var Se=["year","quarter","month","week","day","hour","minute","second","millisecond"];function isDurationValid(e){for(var t in e){if(!(G.call(Se,t)!==-1&&(e[t]==null||!isNaN(e[t])))){return false}}var r=false;for(var i=0;i<Se.length;++i){if(e[Se[i]]){if(r){return false}if(parseFloat(e[Se[i]])!==toInt(e[Se[i]])){r=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(e){var t=normalizeObjectUnits(e),r=t.year||0,i=t.quarter||0,n=t.month||0,s=t.week||t.isoWeek||0,a=t.day||0,o=t.hour||0,u=t.minute||0,c=t.second||0,f=t.millisecond||0;this._isValid=isDurationValid(t);this._milliseconds=+f+c*1e3+u*6e4+o*1e3*60*60;this._days=+a+s*7;this._months=+n+i*3+r*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(e){return e instanceof Duration}function absRound(e){if(e<0){return Math.round(-1*e)*-1}else{return Math.round(e)}}function offset(e,t){addFormatToken(e,0,0,(function(){var e=this.utcOffset();var r="+";if(e<0){e=-e;r="-"}return r+zeroFill(~~(e/60),2)+t+zeroFill(~~e%60,2)}))}offset("Z",":");offset("ZZ","");addRegexToken("Z",C);addRegexToken("ZZ",C);addParseToken(["Z","ZZ"],(function(e,t,r){r._useUTC=true;r._tzm=offsetFromString(C,e)}));var ke=/([\+\-]|\d\d)/gi;function offsetFromString(e,t){var r=(t||"").match(e);if(r===null){return null}var i=r[r.length-1]||[];var n=(i+"").match(ke)||["-",0,0];var s=+(n[1]*60)+toInt(n[2]);return s===0?0:n[0]==="+"?s:-s}function cloneWithOffset(e,t){var r,i;if(t._isUTC){r=t.clone();i=(isMoment(e)||isDate(e)?e.valueOf():createLocal(e).valueOf())-r.valueOf();r._d.setTime(r._d.valueOf()+i);hooks.updateOffset(r,false);return r}else{return createLocal(e).local()}}function getDateOffset(e){return-Math.round(e._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(e,t,r){var i=this._offset||0,n;if(!this.isValid()){return e!=null?this:NaN}if(e!=null){if(typeof e==="string"){e=offsetFromString(C,e);if(e===null){return this}}else if(Math.abs(e)<16&&!r){e=e*60}if(!this._isUTC&&t){n=getDateOffset(this)}this._offset=e;this._isUTC=true;if(n!=null){this.add(n,"m")}if(i!==e){if(!t||this._changeInProgress){addSubtract(this,createDuration(e-i,"m"),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?i:getDateOffset(this)}}function getSetZone(e,t){if(e!=null){if(typeof e!=="string"){e=-e}this.utcOffset(e,t);return this}else{return-this.utcOffset()}}function setOffsetToUTC(e){return this.utcOffset(0,e)}function setOffsetToLocal(e){if(this._isUTC){this.utcOffset(0,e);this._isUTC=false;if(e){this.subtract(getDateOffset(this),"m")}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==="string"){var e=offsetFromString(A,this._i);if(e!=null){this.utcOffset(e)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(e){if(!this.isValid()){return false}e=e?createLocal(e).utcOffset():0;return(this.utcOffset()-e)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var e={};copyConfig(e,this);e=prepareConfig(e);if(e._a){var t=e._isUTC?createUTC(e._a):createLocal(e._a);this._isDSTShifted=this.isValid()&&compareArrays(e._a,t.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var we=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var Te=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(e,t){var r=e,i=null,n,s,a;if(isDuration(e)){r={ms:e._milliseconds,d:e._days,M:e._months}}else if(isNumber(e)){r={};if(t){r[t]=e}else{r.milliseconds=e}}else if(!!(i=we.exec(e))){n=i[1]==="-"?-1:1;r={y:0,d:toInt(i[L])*n,h:toInt(i[U])*n,m:toInt(i[q])*n,s:toInt(i[$])*n,ms:toInt(absRound(i[V]*1e3))*n}}else if(!!(i=Te.exec(e))){n=i[1]==="-"?-1:1;r={y:parseIso(i[2],n),M:parseIso(i[3],n),w:parseIso(i[4],n),d:parseIso(i[5],n),h:parseIso(i[6],n),m:parseIso(i[7],n),s:parseIso(i[8],n)}}else if(r==null){r={}}else if(typeof r==="object"&&("from"in r||"to"in r)){a=momentsDifference(createLocal(r.from),createLocal(r.to));r={};r.ms=a.milliseconds;r.M=a.months}s=new Duration(r);if(isDuration(e)&&hasOwnProp(e,"_locale")){s._locale=e._locale}return s}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(e,t){var r=e&&parseFloat(e.replace(",","."));return(isNaN(r)?0:r)*t}function positiveMomentsDifference(e,t){var r={};r.months=t.month()-e.month()+(t.year()-e.year())*12;if(e.clone().add(r.months,"M").isAfter(t)){--r.months}r.milliseconds=+t-+e.clone().add(r.months,"M");return r}function momentsDifference(e,t){var r;if(!(e.isValid()&&t.isValid())){return{milliseconds:0,months:0}}t=cloneWithOffset(t,e);if(e.isBefore(t)){r=positiveMomentsDifference(e,t)}else{r=positiveMomentsDifference(t,e);r.milliseconds=-r.milliseconds;r.months=-r.months}return r}function createAdder(e,t){return function(r,i){var n,s;if(i!==null&&!isNaN(+i)){deprecateSimple(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). "+"See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.");s=r;r=i;i=s}r=typeof r==="string"?+r:r;n=createDuration(r,i);addSubtract(this,n,e);return this}}function addSubtract(e,t,r,i){var n=t._milliseconds,s=absRound(t._days),a=absRound(t._months);if(!e.isValid()){return}i=i==null?true:i;if(a){setMonth(e,get(e,"Month")+a*r)}if(s){set$1(e,"Date",get(e,"Date")+s*r)}if(n){e._d.setTime(e._d.valueOf()+n*r)}if(i){hooks.updateOffset(e,s||a)}}var Ee=createAdder(1,"add");var xe=createAdder(-1,"subtract");function getCalendarFormat(e,t){var r=e.diff(t,"days",true);return r<-6?"sameElse":r<-1?"lastWeek":r<0?"lastDay":r<1?"sameDay":r<2?"nextDay":r<7?"nextWeek":"sameElse"}function calendar$1(e,t){var r=e||createLocal(),i=cloneWithOffset(r,this).startOf("day"),n=hooks.calendarFormat(this,i)||"sameElse";var s=t&&(isFunction(t[n])?t[n].call(this,r):t[n]);return this.format(s||this.localeData().calendar(n,this,createLocal(r)))}function clone(){return new Moment(this)}function isAfter(e,t){var r=isMoment(e)?e:createLocal(e);if(!(this.isValid()&&r.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()>r.valueOf()}else{return r.valueOf()<this.clone().startOf(t).valueOf()}}function isBefore(e,t){var r=isMoment(e)?e:createLocal(e);if(!(this.isValid()&&r.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()<r.valueOf()}else{return this.clone().endOf(t).valueOf()<r.valueOf()}}function isBetween(e,t,r,i){var n=isMoment(e)?e:createLocal(e),s=isMoment(t)?t:createLocal(t);if(!(this.isValid()&&n.isValid()&&s.isValid())){return false}i=i||"()";return(i[0]==="("?this.isAfter(n,r):!this.isBefore(n,r))&&(i[1]===")"?this.isBefore(s,r):!this.isAfter(s,r))}function isSame(e,t){var r=isMoment(e)?e:createLocal(e),i;if(!(this.isValid()&&r.isValid())){return false}t=normalizeUnits(t)||"millisecond";if(t==="millisecond"){return this.valueOf()===r.valueOf()}else{i=r.valueOf();return this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()}}function isSameOrAfter(e,t){return this.isSame(e,t)||this.isAfter(e,t)}function isSameOrBefore(e,t){return this.isSame(e,t)||this.isBefore(e,t)}function diff(e,t,r){var i,n,s;if(!this.isValid()){return NaN}i=cloneWithOffset(e,this);if(!i.isValid()){return NaN}n=(i.utcOffset()-this.utcOffset())*6e4;t=normalizeUnits(t);switch(t){case"year":s=monthDiff(this,i)/12;break;case"month":s=monthDiff(this,i);break;case"quarter":s=monthDiff(this,i)/3;break;case"second":s=(this-i)/1e3;break;case"minute":s=(this-i)/6e4;break;case"hour":s=(this-i)/36e5;break;case"day":s=(this-i-n)/864e5;break;case"week":s=(this-i-n)/6048e5;break;default:s=this-i}return r?s:absFloor(s)}function monthDiff(e,t){var r=(t.year()-e.year())*12+(t.month()-e.month()),i=e.clone().add(r,"months"),n,s;if(t-i<0){n=e.clone().add(r-1,"months");s=(t-i)/(i-n)}else{n=e.clone().add(r+1,"months");s=(t-i)/(n-i)}return-(r+s)||0}hooks.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";hooks.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function toString(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function toISOString(e){if(!this.isValid()){return null}var t=e!==true;var r=t?this.clone().utc():this;if(r.year()<0||r.year()>9999){return formatMoment(r,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ")}if(isFunction(Date.prototype.toISOString)){if(t){return this.toDate().toISOString()}else{return new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",formatMoment(r,"Z"))}}return formatMoment(r,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function inspect(){if(!this.isValid()){return"moment.invalid(/* "+this._i+" */)"}var e="moment";var t="";if(!this.isLocal()){e=this.utcOffset()===0?"moment.utc":"moment.parseZone";t="Z"}var r="["+e+'("]';var i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY";var n="-MM-DD[T]HH:mm:ss.SSS";var s=t+'[")]';return this.format(r+i+n+s)}function format(e){if(!e){e=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var t=formatMoment(this,e);return this.localeData().postformat(t)}function from(e,t){if(this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())){return createDuration({to:this,from:e}).locale(this.locale()).humanize(!t)}else{return this.localeData().invalidDate()}}function fromNow(e){return this.from(createLocal(),e)}function to(e,t){if(this.isValid()&&(isMoment(e)&&e.isValid()||createLocal(e).isValid())){return createDuration({from:this,to:e}).locale(this.locale()).humanize(!t)}else{return this.localeData().invalidDate()}}function toNow(e){return this.to(createLocal(),e)}function locale(e){var t;if(e===undefined){return this._locale._abbr}else{t=getLocale(e);if(t!=null){this._locale=t}return this}}var De=deprecate("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){if(e===undefined){return this.localeData()}else{return this.locale(e)}}));function localeData(){return this._locale}var je=1e3;var Me=60*je;var Ae=60*Me;var Ce=(365*400+97)*24*Ae;function mod$1(e,t){return(e%t+t)%t}function localStartOfDate(e,t,r){if(e<100&&e>=0){return new Date(e+400,t,r)-Ce}else{return new Date(e,t,r).valueOf()}}function utcStartOfDate(e,t,r){if(e<100&&e>=0){return Date.UTC(e+400,t,r)-Ce}else{return Date.UTC(e,t,r)}}function startOf(e){var t;e=normalizeUnits(e);if(e===undefined||e==="millisecond"||!this.isValid()){return this}var r=this._isUTC?utcStartOfDate:localStartOfDate;switch(e){case"year":t=r(this.year(),0,1);break;case"quarter":t=r(this.year(),this.month()-this.month()%3,1);break;case"month":t=r(this.year(),this.month(),1);break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=r(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf();t-=mod$1(t+(this._isUTC?0:this.utcOffset()*Me),Ae);break;case"minute":t=this._d.valueOf();t-=mod$1(t,Me);break;case"second":t=this._d.valueOf();t-=mod$1(t,je);break}this._d.setTime(t);hooks.updateOffset(this,true);return this}function endOf(e){var t;e=normalizeUnits(e);if(e===undefined||e==="millisecond"||!this.isValid()){return this}var r=this._isUTC?utcStartOfDate:localStartOfDate;switch(e){case"year":t=r(this.year()+1,0,1)-1;break;case"quarter":t=r(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=r(this.year(),this.month()+1,1)-1;break;case"week":t=r(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=r(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=r(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf();t+=Ae-mod$1(t+(this._isUTC?0:this.utcOffset()*Me),Ae)-1;break;case"minute":t=this._d.valueOf();t+=Me-mod$1(t,Me)-1;break;case"second":t=this._d.valueOf();t+=je-mod$1(t,je)-1;break}this._d.setTime(t);hooks.updateOffset(this,true);return this}function valueOf(){return this._d.valueOf()-(this._offset||0)*6e4}function unix(){return Math.floor(this.valueOf()/1e3)}function toDate(){return new Date(this.valueOf())}function toArray(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]}function toObject(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,["gg",2],0,(function(){return this.weekYear()%100}));addFormatToken(0,["GG",2],0,(function(){return this.isoWeekYear()%100}));function addWeekYearFormatToken(e,t){addFormatToken(0,[e,e.length],0,t)}addWeekYearFormatToken("gggg","weekYear");addWeekYearFormatToken("ggggg","weekYear");addWeekYearFormatToken("GGGG","isoWeekYear");addWeekYearFormatToken("GGGGG","isoWeekYear");addUnitAlias("weekYear","gg");addUnitAlias("isoWeekYear","GG");addUnitPriority("weekYear",1);addUnitPriority("isoWeekYear",1);addRegexToken("G",M);addRegexToken("g",M);addRegexToken("GG",k,P);addRegexToken("gg",k,P);addRegexToken("GGGG",x,b);addRegexToken("gggg",x,b);addRegexToken("GGGGG",D,S);addRegexToken("ggggg",D,S);addWeekParseToken(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,r,i){t[i.substr(0,2)]=toInt(e)}));addWeekParseToken(["gg","GG"],(function(e,t,r,i){t[i]=hooks.parseTwoDigitYear(e)}));function getSetWeekYear(e){return getSetWeekYearHelper.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(e){return getSetWeekYearHelper.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var e=this.localeData()._week;return weeksInYear(this.year(),e.dow,e.doy)}function getSetWeekYearHelper(e,t,r,i,n){var s;if(e==null){return weekOfYear(this,i,n).year}else{s=weeksInYear(e,i,n);if(t>s){t=s}return setWeekAll.call(this,e,t,r,i,n)}}function setWeekAll(e,t,r,i,n){var s=dayOfYearFromWeeks(e,t,r,i,n),a=createUTCDate(s.year,0,s.dayOfYear);this.year(a.getUTCFullYear());this.month(a.getUTCMonth());this.date(a.getUTCDate());return this}addFormatToken("Q",0,"Qo","quarter");addUnitAlias("quarter","Q");addUnitPriority("quarter",7);addRegexToken("Q",O);addParseToken("Q",(function(e,t){t[W]=(toInt(e)-1)*3}));function getSetQuarter(e){return e==null?Math.ceil((this.month()+1)/3):this.month((e-1)*3+this.month()%3)}addFormatToken("D",["DD",2],"Do","date");addUnitAlias("date","D");addUnitPriority("date",9);addRegexToken("D",k);addRegexToken("DD",k,P);addRegexToken("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}));addParseToken(["D","DD"],L);addParseToken("Do",(function(e,t){t[L]=toInt(e.match(k)[0])}));var Ye=makeGetSet("Date",true);addFormatToken("DDD",["DDDD",3],"DDDo","dayOfYear");addUnitAlias("dayOfYear","DDD");addUnitPriority("dayOfYear",4);addRegexToken("DDD",E);addRegexToken("DDDD",_);addParseToken(["DDD","DDDD"],(function(e,t,r){r._dayOfYear=toInt(e)}));function getSetDayOfYear(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return e==null?t:this.add(e-t,"d")}addFormatToken("m",["mm",2],0,"minute");addUnitAlias("minute","m");addUnitPriority("minute",14);addRegexToken("m",k);addRegexToken("mm",k,P);addParseToken(["m","mm"],q);var Re=makeGetSet("Minutes",false);addFormatToken("s",["ss",2],0,"second");addUnitAlias("second","s");addUnitPriority("second",15);addRegexToken("s",k);addRegexToken("ss",k,P);addParseToken(["s","ss"],$);var Fe=makeGetSet("Seconds",false);addFormatToken("S",0,0,(function(){return~~(this.millisecond()/100)}));addFormatToken(0,["SS",2],0,(function(){return~~(this.millisecond()/10)}));addFormatToken(0,["SSS",3],0,"millisecond");addFormatToken(0,["SSSS",4],0,(function(){return this.millisecond()*10}));addFormatToken(0,["SSSSS",5],0,(function(){return this.millisecond()*100}));addFormatToken(0,["SSSSSS",6],0,(function(){return this.millisecond()*1e3}));addFormatToken(0,["SSSSSSS",7],0,(function(){return this.millisecond()*1e4}));addFormatToken(0,["SSSSSSSS",8],0,(function(){return this.millisecond()*1e5}));addFormatToken(0,["SSSSSSSSS",9],0,(function(){return this.millisecond()*1e6}));addUnitAlias("millisecond","ms");addUnitPriority("millisecond",16);addRegexToken("S",E,O);addRegexToken("SS",E,P);addRegexToken("SSS",E,_);var Ie;for(Ie="SSSS";Ie.length<=9;Ie+="S"){addRegexToken(Ie,j)}function parseMs(e,t){t[V]=toInt(("0."+e)*1e3)}for(Ie="S";Ie.length<=9;Ie+="S"){addParseToken(Ie,parseMs)}var Ne=makeGetSet("Milliseconds",false);addFormatToken("z",0,0,"zoneAbbr");addFormatToken("zz",0,0,"zoneName");function getZoneAbbr(){return this._isUTC?"UTC":""}function getZoneName(){return this._isUTC?"Coordinated Universal Time":""}var We=Moment.prototype;We.add=Ee;We.calendar=calendar$1;We.clone=clone;We.diff=diff;We.endOf=endOf;We.format=format;We.from=from;We.fromNow=fromNow;We.to=to;We.toNow=toNow;We.get=stringGet;We.invalidAt=invalidAt;We.isAfter=isAfter;We.isBefore=isBefore;We.isBetween=isBetween;We.isSame=isSame;We.isSameOrAfter=isSameOrAfter;We.isSameOrBefore=isSameOrBefore;We.isValid=isValid$2;We.lang=De;We.locale=locale;We.localeData=localeData;We.max=be;We.min=_e;We.parsingFlags=parsingFlags;We.set=stringSet;We.startOf=startOf;We.subtract=xe;We.toArray=toArray;We.toObject=toObject;We.toDate=toDate;We.toISOString=toISOString;We.inspect=inspect;We.toJSON=toJSON;We.toString=toString;We.unix=unix;We.valueOf=valueOf;We.creationData=creationData;We.year=B;We.isLeapYear=getIsLeapYear;We.weekYear=getSetWeekYear;We.isoWeekYear=getSetISOWeekYear;We.quarter=We.quarters=getSetQuarter;We.month=getSetMonth;We.daysInMonth=getDaysInMonth;We.week=We.weeks=getSetWeek;We.isoWeek=We.isoWeeks=getSetISOWeek;We.weeksInYear=getWeeksInYear;We.isoWeeksInYear=getISOWeeksInYear;We.date=Ye;We.day=We.days=getSetDayOfWeek;We.weekday=getSetLocaleDayOfWeek;We.isoWeekday=getSetISODayOfWeek;We.dayOfYear=getSetDayOfYear;We.hour=We.hours=ue;We.minute=We.minutes=Re;We.second=We.seconds=Fe;We.millisecond=We.milliseconds=Ne;We.utcOffset=getSetOffset;We.utc=setOffsetToUTC;We.local=setOffsetToLocal;We.parseZone=setOffsetToParsedOffset;We.hasAlignedHourOffset=hasAlignedHourOffset;We.isDST=isDaylightSavingTime;We.isLocal=isLocal;We.isUtcOffset=isUtcOffset;We.isUtc=isUtc;We.isUTC=isUtc;We.zoneAbbr=getZoneAbbr;We.zoneName=getZoneName;We.dates=deprecate("dates accessor is deprecated. Use date instead.",Ye);We.months=deprecate("months accessor is deprecated. Use month instead",getSetMonth);We.years=deprecate("years accessor is deprecated. Use year instead",B);We.zone=deprecate("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",getSetZone);We.isDSTShifted=deprecate("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",isDaylightSavingTimeShifted);function createUnix(e){return createLocal(e*1e3)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(e){return e}var Le=Locale.prototype;Le.calendar=calendar;Le.longDateFormat=longDateFormat;Le.invalidDate=invalidDate;Le.ordinal=ordinal;Le.preparse=preParsePostFormat;Le.postformat=preParsePostFormat;Le.relativeTime=relativeTime;Le.pastFuture=pastFuture;Le.set=set;Le.months=localeMonths;Le.monthsShort=localeMonthsShort;Le.monthsParse=localeMonthsParse;Le.monthsRegex=monthsRegex;Le.monthsShortRegex=monthsShortRegex;Le.week=localeWeek;Le.firstDayOfYear=localeFirstDayOfYear;Le.firstDayOfWeek=localeFirstDayOfWeek;Le.weekdays=localeWeekdays;Le.weekdaysMin=localeWeekdaysMin;Le.weekdaysShort=localeWeekdaysShort;Le.weekdaysParse=localeWeekdaysParse;Le.weekdaysRegex=weekdaysRegex;Le.weekdaysShortRegex=weekdaysShortRegex;Le.weekdaysMinRegex=weekdaysMinRegex;Le.isPM=localeIsPM;Le.meridiem=localeMeridiem;function get$1(e,t,r,i){var n=getLocale();var s=createUTC().set(i,t);return n[r](s,e)}function listMonthsImpl(e,t,r){if(isNumber(e)){t=e;e=undefined}e=e||"";if(t!=null){return get$1(e,t,r,"month")}var i;var n=[];for(i=0;i<12;i++){n[i]=get$1(e,i,r,"month")}return n}function listWeekdaysImpl(e,t,r,i){if(typeof e==="boolean"){if(isNumber(t)){r=t;t=undefined}t=t||""}else{t=e;r=t;e=false;if(isNumber(t)){r=t;t=undefined}t=t||""}var n=getLocale(),s=e?n._week.dow:0;if(r!=null){return get$1(t,(r+s)%7,i,"day")}var a;var o=[];for(a=0;a<7;a++){o[a]=get$1(t,(a+s)%7,i,"day")}return o}function listMonths(e,t){return listMonthsImpl(e,t,"months")}function listMonthsShort(e,t){return listMonthsImpl(e,t,"monthsShort")}function listWeekdays(e,t,r){return listWeekdaysImpl(e,t,r,"weekdays")}function listWeekdaysShort(e,t,r){return listWeekdaysImpl(e,t,r,"weekdaysShort")}function listWeekdaysMin(e,t,r){return listWeekdaysImpl(e,t,r,"weekdaysMin")}getSetGlobalLocale("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,r=toInt(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+r}});hooks.lang=deprecate("moment.lang is deprecated. Use moment.locale instead.",getSetGlobalLocale);hooks.langData=deprecate("moment.langData is deprecated. Use moment.localeData instead.",getLocale);var Ue=Math.abs;function abs(){var e=this._data;this._milliseconds=Ue(this._milliseconds);this._days=Ue(this._days);this._months=Ue(this._months);e.milliseconds=Ue(e.milliseconds);e.seconds=Ue(e.seconds);e.minutes=Ue(e.minutes);e.hours=Ue(e.hours);e.months=Ue(e.months);e.years=Ue(e.years);return this}function addSubtract$1(e,t,r,i){var n=createDuration(t,r);e._milliseconds+=i*n._milliseconds;e._days+=i*n._days;e._months+=i*n._months;return e._bubble()}function add$1(e,t){return addSubtract$1(this,e,t,1)}function subtract$1(e,t){return addSubtract$1(this,e,t,-1)}function absCeil(e){if(e<0){return Math.floor(e)}else{return Math.ceil(e)}}function bubble(){var e=this._milliseconds;var t=this._days;var r=this._months;var i=this._data;var n,s,a,o,u;if(!(e>=0&&t>=0&&r>=0||e<=0&&t<=0&&r<=0)){e+=absCeil(monthsToDays(r)+t)*864e5;t=0;r=0}i.milliseconds=e%1e3;n=absFloor(e/1e3);i.seconds=n%60;s=absFloor(n/60);i.minutes=s%60;a=absFloor(s/60);i.hours=a%24;t+=absFloor(a/24);u=absFloor(daysToMonths(t));r+=u;t-=absCeil(monthsToDays(u));o=absFloor(r/12);r%=12;i.days=t;i.months=r;i.years=o;return this}function daysToMonths(e){return e*4800/146097}function monthsToDays(e){return e*146097/4800}function as(e){if(!this.isValid()){return NaN}var t;var r;var i=this._milliseconds;e=normalizeUnits(e);if(e==="month"||e==="quarter"||e==="year"){t=this._days+i/864e5;r=this._months+daysToMonths(t);switch(e){case"month":return r;case"quarter":return r/3;case"year":return r/12}}else{t=this._days+Math.round(monthsToDays(this._months));switch(e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return t*24+i/36e5;case"minute":return t*1440+i/6e4;case"second":return t*86400+i/1e3;case"millisecond":return Math.floor(t*864e5)+i;default:throw new Error("Unknown unit "+e)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*864e5+this._months%12*2592e6+toInt(this._months/12)*31536e6}function makeAs(e){return function(){return this.as(e)}}var qe=makeAs("ms");var $e=makeAs("s");var Ve=makeAs("m");var He=makeAs("h");var ze=makeAs("d");var Be=makeAs("w");var Ge=makeAs("M");var Je=makeAs("Q");var Ze=makeAs("y");function clone$1(){return createDuration(this)}function get$2(e){e=normalizeUnits(e);return this.isValid()?this[e+"s"]():NaN}function makeGetter(e){return function(){return this.isValid()?this._data[e]:NaN}}var Qe=makeGetter("milliseconds");var Xe=makeGetter("seconds");var Ke=makeGetter("minutes");var et=makeGetter("hours");var tt=makeGetter("days");var rt=makeGetter("months");var it=makeGetter("years");function weeks(){return absFloor(this.days()/7)}var nt=Math.round;var st={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(e,t,r,i,n){return n.relativeTime(t||1,!!r,e,i)}function relativeTime$1(e,t,r){var i=createDuration(e).abs();var n=nt(i.as("s"));var s=nt(i.as("m"));var a=nt(i.as("h"));var o=nt(i.as("d"));var u=nt(i.as("M"));var c=nt(i.as("y"));var f=n<=st.ss&&["s",n]||n<st.s&&["ss",n]||s<=1&&["m"]||s<st.m&&["mm",s]||a<=1&&["h"]||a<st.h&&["hh",a]||o<=1&&["d"]||o<st.d&&["dd",o]||u<=1&&["M"]||u<st.M&&["MM",u]||c<=1&&["y"]||["yy",c];f[2]=t;f[3]=+e>0;f[4]=r;return substituteTimeAgo.apply(null,f)}function getSetRelativeTimeRounding(e){if(e===undefined){return nt}if(typeof e==="function"){nt=e;return true}return false}function getSetRelativeTimeThreshold(e,t){if(st[e]===undefined){return false}if(t===undefined){return st[e]}st[e]=t;if(e==="s"){st.ss=t-1}return true}function humanize(e){if(!this.isValid()){return this.localeData().invalidDate()}var t=this.localeData();var r=relativeTime$1(this,!e,t);if(e){r=t.pastFuture(+this,r)}return t.postformat(r)}var at=Math.abs;function sign(e){return(e>0)-(e<0)||+e}function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var e=at(this._milliseconds)/1e3;var t=at(this._days);var r=at(this._months);var i,n,s;i=absFloor(e/60);n=absFloor(i/60);e%=60;i%=60;s=absFloor(r/12);r%=12;var a=s;var o=r;var u=t;var c=n;var f=i;var l=e?e.toFixed(3).replace(/\.?0+$/,""):"";var h=this.asSeconds();if(!h){return"P0D"}var d=h<0?"-":"";var p=sign(this._months)!==sign(h)?"-":"";var m=sign(this._days)!==sign(h)?"-":"";var g=sign(this._milliseconds)!==sign(h)?"-":"";return d+"P"+(a?p+a+"Y":"")+(o?p+o+"M":"")+(u?m+u+"D":"")+(c||f||l?"T":"")+(c?g+c+"H":"")+(f?g+f+"M":"")+(l?g+l+"S":"")}var ot=Duration.prototype;ot.isValid=isValid$1;ot.abs=abs;ot.add=add$1;ot.subtract=subtract$1;ot.as=as;ot.asMilliseconds=qe;ot.asSeconds=$e;ot.asMinutes=Ve;ot.asHours=He;ot.asDays=ze;ot.asWeeks=Be;ot.asMonths=Ge;ot.asQuarters=Je;ot.asYears=Ze;ot.valueOf=valueOf$1;ot._bubble=bubble;ot.clone=clone$1;ot.get=get$2;ot.milliseconds=Qe;ot.seconds=Xe;ot.minutes=Ke;ot.hours=et;ot.days=tt;ot.weeks=weeks;ot.months=rt;ot.years=it;ot.humanize=humanize;ot.toISOString=toISOString$1;ot.toString=toISOString$1;ot.toJSON=toISOString$1;ot.locale=locale;ot.localeData=localeData;ot.toIsoString=deprecate("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",toISOString$1);ot.lang=De;addFormatToken("X",0,0,"unix");addFormatToken("x",0,0,"valueOf");addRegexToken("x",M);addRegexToken("X",Y);addParseToken("X",(function(e,t,r){r._d=new Date(parseFloat(e,10)*1e3)}));addParseToken("x",(function(e,t,r){r._d=new Date(toInt(e))}));hooks.version="2.24.0";setHookCallback(createLocal);hooks.fn=We;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=We;hooks.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"};return hooks}))},968:e=>{e.exports=function(e,t,r){var i=(2<<31-Math.clz32(t.length-1|1))-1;var n=Math.ceil(1.6*i*r/t.length);var s="";while(true){var a=e(n);var o=n;while(o--){s+=t[a[o]&i]||"";if(s.length===+r)return s}}}},393:(e,t,r)=>{var i=r(113);if(i.randomFillSync){var n={};e.exports=function(e){var t=n[e];if(!t){t=Buffer.allocUnsafe(e);if(e<=255)n[e]=t}return i.randomFillSync(t)}}else{e.exports=i.randomBytes}},889:(e,t,r)=>{"use strict";e.exports=r(520)},539:(e,t,r)=>{"use strict";var i=r(761);var n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";var s;var a;var o;function reset(){o=false}function setCharacters(e){if(!e){if(s!==n){s=n;reset()}return}if(e===s){return}if(e.length!==n.length){throw new Error("Custom alphabet for shortid must be "+n.length+" unique characters. You submitted "+e.length+" characters: "+e)}var t=e.split("").filter((function(e,t,r){return t!==r.lastIndexOf(e)}));if(t.length){throw new Error("Custom alphabet for shortid must be "+n.length+" unique characters. These characters were not unique: "+t.join(", "))}s=e;reset()}function characters(e){setCharacters(e);return s}function setSeed(e){i.seed(e);if(a!==e){reset();a=e}}function shuffle(){if(!s){setCharacters(n)}var e=s.split("");var t=[];var r=i.nextValue();var a;while(e.length>0){r=i.nextValue();a=Math.floor(r*e.length);t.push(e.splice(a,1)[0])}return t.join("")}function getShuffled(){if(o){return o}o=shuffle();return o}function lookup(e){var t=getShuffled();return t[e]}function get(){return s||n}e.exports={get:get,characters:characters,seed:setSeed,lookup:lookup,shuffled:getShuffled}},959:(e,t,r)=>{"use strict";var i=r(387);var n=r(539);var s=1567752802062;var a=7;var o;var u;function build(e){var t="";var r=Math.floor((Date.now()-s)*.001);if(r===u){o++}else{o=0;u=r}t=t+i(a);t=t+i(e);if(o>0){t=t+i(o)}t=t+i(r);return t}e.exports=build},387:(e,t,r)=>{"use strict";var i=r(539);var n=r(251);var s=r(968);function generate(e){var t=0;var r;var a="";while(!r){a=a+s(n,i.get(),1);r=e<Math.pow(16,t+1);t++}return a}e.exports=generate},520:(e,t,r)=>{"use strict";var i=r(539);var n=r(959);var s=r(327);var a=r(874)||0;function seed(t){i.seed(t);return e.exports}function worker(t){a=t;return e.exports}function characters(e){if(e!==undefined){i.characters(e)}return i.shuffled()}function generate(){return n(a)}e.exports=generate;e.exports.generate=generate;e.exports.seed=seed;e.exports.worker=worker;e.exports.characters=characters;e.exports.isValid=s},327:(e,t,r)=>{"use strict";var i=r(539);function isShortId(e){if(!e||typeof e!=="string"||e.length<6){return false}var t=new RegExp("[^"+i.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!t.test(e)}e.exports=isShortId},251:(e,t,r)=>{e.exports=r(393)},761:e=>{"use strict";var t=1;function getNextValue(){t=(t*9301+49297)%233280;return t/233280}function setSeed(e){t=e}e.exports={nextValue:getNextValue,seed:setSeed}},874:(e,t,r)=>{"use strict";var i=r(1);var n=0;if(!i.isMaster&&i.worker){n=i.worker.id}e.exports=parseInt(process.env.NODE_UNIQUE_ID||n,10)},935:(e,t,r)=>{"use strict";r.r(t);r.d(t,{default:()=>g});e=r.hmd(e);var i=typeof process!=="undefined"&&process.versions&&process.versions.node;if(i){i={version:process.versions.node}}var n={};var isObject=function(e){return!!e&&e.constructor===Object};var s=r(34)(n);var a=r(731)(n);var o=r(845)(n);var u=r(338)(n);var c=r(842)(n);var f=r(686)(n);var l=r(883)(n);var h=r(135)(n);var d=r(602)(n);var p=r(658)(n);Object.assign(n,{...s,...a,...o,...u,...c,...f,...l,...h,...d,...p,hello:function(){n.Logger.log("Hello from OBJY!")}});var m=null&&n;if(i)e.exports=n;else if(typeof window!=="undefined"){window.OBJY=n}if(false){}const g=n},1:e=>{"use strict";e.exports=require("cluster")},113:e=>{"use strict";e.exports=require("crypto")}};var __webpack_module_cache__={};function __nccwpck_require__(e){var t=__webpack_module_cache__[e];if(t!==undefined){return t.exports}var r=__webpack_module_cache__[e]={id:e,loaded:false,exports:{}};var i=true;try{__webpack_modules__[e].call(r.exports,r,r.exports,__nccwpck_require__);i=false}finally{if(i)delete __webpack_module_cache__[e]}r.loaded=true;return r.exports}(()=>{__nccwpck_require__.d=(e,t)=>{for(var r in t){if(__nccwpck_require__.o(t,r)&&!__nccwpck_require__.o(e,r)){Object.defineProperty(e,r,{enumerable:true,get:t[r]})}}}})();(()=>{__nccwpck_require__.hmd=e=>{e=Object.create(e);if(!e.children)e.children=[];Object.defineProperty(e,"exports",{enumerable:true,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}});return e}})();(()=>{__nccwpck_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{__nccwpck_require__.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();(()=>{__nccwpck_require__.nmd=e=>{e.paths=[];if(!e.children)e.children=[];return e}})();if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var __webpack_exports__=__nccwpck_require__(935);module.exports=__webpack_exports__})();